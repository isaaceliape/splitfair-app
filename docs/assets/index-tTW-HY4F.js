(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class Rn extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.showOptions=!1}connectedCallback(){this.render()}onClickAboutBtn(r){r.preventDefault(),this.showOptions=!this.showOptions,this.render(),this.dispatchEvent(new CustomEvent("is-menun-open",{detail:this.showOptions}))}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
        }

        .AboutSection {
          position: absolute;
          width: 0;
          height: 0;
          z-index: 1;
          right: 0;
          bottom: 0;
          z-index: 2;
        }

        .AboutSection.showOptions {
          z-index: 4;
        }

        .overlay {
          transform: translateX(-100vw);
        }

        .about {
          position: absolute;
          text-decoration: none;
        }

        .left-content {
          left: 0;
          width: 50vw;
          height: 100%;
          cursor: pointer;
        }

        .right-content {
          color: var(--black);
        }
      </style>
      <section class="AboutSection ${this.showOptions?"showOptions":""}">
        <a href="#" class="about"> about </a>
        <div class="overlay">
          <div class="left-content"></div>
          <div class="right-content">
            <h1 class="title">About</h1>
          </div>
        </div>
      </section>
    `,this.shadowRoot.querySelector(".about").addEventListener("click",this.onClickAboutBtn),this.shadowRoot.querySelector(".left-content").addEventListener("click",this.onClickAboutBtn)}}customElements.define("about-section",Rn);class Ln extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.showOptions=!1}connectedCallback(){this.render()}onClickDownloadApp(r){r.preventDefault(),this.showOptions=!this.showOptions,this.render(),this.dispatchEvent(new CustomEvent("is-menu-open",{detail:this.showOptions}))}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
        }

        .DownloadAppSection {
          position: absolute;
          width: 0;
          height: 0;
          z-index: 2;
          right: 0;
          top: 0;
        }

        .DownloadAppSection.showOptions {
          z-index: 4;
        }

        .DownloadAppSection.showOptions .overlay {
          transform: translateX(-100vw);
        }

        .download-app {
          position: absolute;
          text-decoration: none;
          color: var(--black);
          font-size: 28px;
          top: 4vw;
          right: 5vw;
          z-index: 0;
          white-space: nowrap;
        }

        .download-app:hover {
          color: var(--red);
        }

        .overlay {
          position: absolute;
          left: 0;
          top: 0;
          width: 100vw;
          height: 100vh;
          transition: 500ms ease;
          transform: translateX(0vw);
          background: url(/desktop_bg.png) 76% center no-repeat;
          background-size: cover;
        }

        .left-content {
          position: absolute;
          left: 0;
          width: 50vw;
          height: 100%;
          cursor: pointer;
          cursor: url(/cursor-cross-red.png), auto;
        }

        .right-content {
          width: 50vw;
          position: absolute;
          right: 0;
          height: 100%;
          background-color: var(--red);
          text-align: left;
          padding: 2vw 7vw;
          box-sizing: border-box;
          cursor: url(/cursor-black.png), auto;
        }

        .link {
          font-size: 128px;
          text-decoration: none;
          display: block;
          color: var(--black);
          position: absolute;
        }

        .link:hover {
          color: var(--white);
          cursor: url(/cursor-black.png), auto;
        }

        .link.desktop {
          left: 7vw;
          top: 3vw;
        }

        .link.mobile {
          left: 7vw;
          bottom: 3vw;
        }
      </style>
      <section class="DownloadAppSection ${this.showOptions?"showOptions":""}">
        <a href="#" class="download-app"> download app </a>
        <div class="overlay">
          <div class="left-content"></div>
          <div class="right-content">
            <a href="#" class="link desktop"> Desktop </a>
            <a href="#" class="link mobile"> Mobile </a>
          </div>
        </div>
      </section>
    `,this.shadowRoot.querySelector(".download-app").addEventListener("click",this.onClickDownloadApp),this.shadowRoot.querySelector(".left-content").addEventListener("click",this.onClickDownloadApp)}}customElements.define("download-app-section",Ln);class Dn extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.timeout=null}connectedCallback(){this.render(),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyup)}disconnectedCallback(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyup)}onTap(r){const t=r.currentTarget;clearTimeout(this.timeout),t.classList.add("pressed"),this.timeout=setTimeout(()=>{t.classList.remove("pressed")},200),this.dispatchEvent(new CustomEvent("tapped-button",{detail:t.innerText.trim()}))}onKeyup(r){const t=r.key==="Backspace",e=r.key==="Enter",i=this.isNumberKey(r.key);if(i&&this.dispatchEvent(new CustomEvent("tapped-button",{detail:r.key})),t&&this.dispatchEvent(new CustomEvent("tapped-button",{detail:"<"})),e&&this.dispatchEvent(new CustomEvent("tapped-button",{detail:"Enter"})),i||t||e){const n=t?"Backspace":e?"Enter":r.key,o=this.shadowRoot.querySelector(`.button-${n}`);o&&(o.classList.add("pressed"),setTimeout(()=>{o.classList.remove("pressed")},200))}}onKeyDown(r){}isNumberKey(r){var t=new RegExp("^[0-9]+$");return t.test(r)}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
        }

        .NumberPad {
          display: flex;
          flex-direction: column;
        }

        .button-row {
          display: grid;
          width: 100%;
          grid-gap: 3px;
          grid-template-columns: 1fr 1fr 1fr;
          margin-bottom: 3px;
          font-family: helvetica;
        }

        .button {
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          background-color: white;
          border-radius: 9px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 200ms ease;
          backface-visibility: hidden;
          user-select: none;
        }

        .button:hover {
          background-color: #ecf8ff;
        }

        .button.pressed {
          transform: scale(0.98);
          opacity: 0.9;
        }

        .button.clear {
          color: var(--red);
        }

        .button.enter {
          color: var(--black);
          background-color: var(--red);
        }

        .button.enter:hover {
          background-color: #fb7755;
        }
      </style>
      <div class="NumberPad">
        <div class="button-row">
          <div class="button button-7">7</div>
          <div class="button button-8">8</div>
          <div class="button button-9">9</div>
        </div>
        <div class="button-row">
          <div class="button button-4">4</div>
          <div class="button button-5">5</div>
          <div class="button button-6">6</div>
        </div>
        <div class="button-row">
          <div class="button button-1">1</div>
          <div class="button button-2">2</div>
          <div class="button button-3">3</div>
        </div>
        <div class="button-row">
          <div class="button clear button-Backspace">&lt;</div>
          <div class="button button-0">0</div>
          <div class="button enter button-Enter">Enter</div>
        </div>
      </div>
    `,this.shadowRoot.querySelectorAll(".button").forEach(r=>{r.addEventListener("click",this.onTap)})}}customElements.define("number-pad",Dn);var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function In(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var nr={exports:{}},ur={},fr={},X={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=Math.PI/180;function t(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}var e=function(i){var n=i.indexOf("msie ");if(n>0)return parseInt(i.substring(n+5,i.indexOf(".",n)),10);var o=i.indexOf("trident/");if(o>0){var s=i.indexOf("rv:");return parseInt(i.substring(s+3,i.indexOf(".",s)),10)}var h=i.indexOf("edge/");return h>0?parseInt(i.substring(h+5,i.indexOf(".",h)),10):!1};a._parseUA=function(i){var n=i.toLowerCase(),o=/(chrome)[ /]([\w.]+)/.exec(n)||/(webkit)[ /]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[],s=!!i.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),h=!!i.match(/IEMobile/i);return{browser:o[1]||"",version:o[2]||"0",isIE:e(n),mobile:s,ieMobile:h}},a.glob=typeof V<"u"?V:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},a.Konva={_global:a.glob,version:"6.0.0",isBrowser:t(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle:function(i){return a.Konva.angleDeg?i*r:i},enableTrace:!1,_pointerEventsEnabled:!1,hitOnDragEnabled:!1,captureTouchEventsEnabled:!1,listenClickTap:!1,inDblClickWindow:!1,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return a.Konva.DD.isDragging},isDragReady:function(){return!!a.Konva.DD.node},UA:a._parseUA(a.glob.navigator&&a.glob.navigator.userAgent||""),document:a.glob.document,_injectGlobal:function(i){a.glob.Konva=i},_parseUA:a._parseUA},a._NODES_REGISTRY={},a._registerNode=function(i){a._NODES_REGISTRY[i.prototype.getClassName()]=i,a.Konva[i.prototype.getClassName()]=i}})(X);var J={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=X,t=function(){function c(){}return c.toCollection=function(v){var m=new c,T=v.length,F;for(F=0;F<T;F++)m.push(v[F]);return m},c._mapMethod=function(v){c.prototype[v]=function(){var m=this.length,T,F=[].slice.call(arguments);for(T=0;T<m;T++)this[T][v].apply(this[T],F);return this}},c.mapMethods=function(v){var m=v.prototype;for(var T in m)c._mapMethod(T)},c}();a.Collection=t,t.prototype=[],t.prototype.each=function(c){for(var v=0;v<this.length;v++)c(this[v],v)},t.prototype.toArray=function(){var c=[],v=this.length,m;for(m=0;m<v;m++)c.push(this[m]);return c};var e=function(){function c(v){v===void 0&&(v=[1,0,0,1,0,0]),this.m=v&&v.slice()||[1,0,0,1,0,0]}return c.prototype.copy=function(){return new c(this.m)},c.prototype.point=function(v){var m=this.m;return{x:m[0]*v.x+m[2]*v.y+m[4],y:m[1]*v.x+m[3]*v.y+m[5]}},c.prototype.translate=function(v,m){return this.m[4]+=this.m[0]*v+this.m[2]*m,this.m[5]+=this.m[1]*v+this.m[3]*m,this},c.prototype.scale=function(v,m){return this.m[0]*=v,this.m[1]*=v,this.m[2]*=m,this.m[3]*=m,this},c.prototype.rotate=function(v){var m=Math.cos(v),T=Math.sin(v),F=this.m[0]*m+this.m[2]*T,P=this.m[1]*m+this.m[3]*T,N=this.m[0]*-T+this.m[2]*m,E=this.m[1]*-T+this.m[3]*m;return this.m[0]=F,this.m[1]=P,this.m[2]=N,this.m[3]=E,this},c.prototype.getTranslation=function(){return{x:this.m[4],y:this.m[5]}},c.prototype.skew=function(v,m){var T=this.m[0]+this.m[2]*m,F=this.m[1]+this.m[3]*m,P=this.m[2]+this.m[0]*v,N=this.m[3]+this.m[1]*v;return this.m[0]=T,this.m[1]=F,this.m[2]=P,this.m[3]=N,this},c.prototype.multiply=function(v){var m=this.m[0]*v.m[0]+this.m[2]*v.m[1],T=this.m[1]*v.m[0]+this.m[3]*v.m[1],F=this.m[0]*v.m[2]+this.m[2]*v.m[3],P=this.m[1]*v.m[2]+this.m[3]*v.m[3],N=this.m[0]*v.m[4]+this.m[2]*v.m[5]+this.m[4],E=this.m[1]*v.m[4]+this.m[3]*v.m[5]+this.m[5];return this.m[0]=m,this.m[1]=T,this.m[2]=F,this.m[3]=P,this.m[4]=N,this.m[5]=E,this},c.prototype.invert=function(){var v=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),m=this.m[3]*v,T=-this.m[1]*v,F=-this.m[2]*v,P=this.m[0]*v,N=v*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),E=v*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=m,this.m[1]=T,this.m[2]=F,this.m[3]=P,this.m[4]=N,this.m[5]=E,this},c.prototype.getMatrix=function(){return this.m},c.prototype.setAbsolutePosition=function(v,m){var T=this.m[0],F=this.m[1],P=this.m[2],N=this.m[3],E=this.m[4],A=this.m[5],D=(T*(m-A)-F*(v-E))/(T*N-F*P),R=(v-E-P*D)/T;return this.translate(R,D)},c.prototype.decompose=function(){var v=this.m[0],m=this.m[1],T=this.m[2],F=this.m[3],P=this.m[4],N=this.m[5],E=v*F-m*T,A={x:P,y:N,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(v!=0||m!=0){var D=Math.sqrt(v*v+m*m);A.rotation=m>0?Math.acos(v/D):-Math.acos(v/D),A.scaleX=D,A.scaleY=E/D,A.skewX=(v*T+m*F)/E,A.skewY=0}else if(T!=0||F!=0){var R=Math.sqrt(T*T+F*F);A.rotation=Math.PI/2-(F>0?Math.acos(-T/R):-Math.acos(T/R)),A.scaleX=E/R,A.scaleY=R,A.skewX=0,A.skewY=(v*T+m*F)/E}return A.rotation=a.Util._getRotation(A.rotation),A},c}();a.Transform=e;var i="[object Array]",n="[object Number]",o="[object String]",s="[object Boolean]",h=Math.PI/180,l=180/Math.PI,u="#",C="",k="0",f="Konva warning: ",y="Konva error: ",g="rgb(",x={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},S=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,G=[];a.Util={_isElement:function(c){return!!(c&&c.nodeType==1)},_isFunction:function(c){return!!(c&&c.constructor&&c.call&&c.apply)},_isPlainObject:function(c){return!!c&&c.constructor===Object},_isArray:function(c){return Object.prototype.toString.call(c)===i},_isNumber:function(c){return Object.prototype.toString.call(c)===n&&!isNaN(c)&&isFinite(c)},_isString:function(c){return Object.prototype.toString.call(c)===o},_isBoolean:function(c){return Object.prototype.toString.call(c)===s},isObject:function(c){return c instanceof Object},isValidSelector:function(c){if(typeof c!="string")return!1;var v=c[0];return v==="#"||v==="."||v===v.toUpperCase()},_sign:function(c){return c===0?0:c>0?1:-1},requestAnimFrame:function(c){G.push(c),G.length===1&&requestAnimationFrame(function(){var v=G;G=[],v.forEach(function(m){m()})})},createCanvasElement:function(){var c=document.createElement("canvas");try{c.style=c.style||{}}catch{}return c},createImageElement:function(){return document.createElement("img")},_isInDocument:function(c){for(;c=c.parentNode;)if(c==document)return!0;return!1},_simplifyArray:function(c){var v=[],m=c.length,T=a.Util,F,P;for(F=0;F<m;F++)P=c[F],T._isNumber(P)?P=Math.round(P*1e3)/1e3:T._isString(P)||(P=P.toString()),v.push(P);return v},_urlToImage:function(c,v){var m=new r.glob.Image;m.onload=function(){v(m)},m.src=c},_rgbToHex:function(c,v,m){return((1<<24)+(c<<16)+(v<<8)+m).toString(16).slice(1)},_hexToRgb:function(c){c=c.replace(u,C);var v=parseInt(c,16);return{r:v>>16&255,g:v>>8&255,b:v&255}},getRandomColor:function(){for(var c=(Math.random()*16777215<<0).toString(16);c.length<6;)c=k+c;return u+c},get:function(c,v){return c===void 0?v:c},getRGB:function(c){var v;return c in x?(v=x[c],{r:v[0],g:v[1],b:v[2]}):c[0]===u?this._hexToRgb(c.substring(1)):c.substr(0,4)===g?(v=S.exec(c.replace(/ /g,"")),{r:parseInt(v[1],10),g:parseInt(v[2],10),b:parseInt(v[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(c){return c=c||"black",a.Util._namedColorToRBA(c)||a.Util._hex3ColorToRGBA(c)||a.Util._hex6ColorToRGBA(c)||a.Util._rgbColorToRGBA(c)||a.Util._rgbaColorToRGBA(c)||a.Util._hslColorToRGBA(c)},_namedColorToRBA:function(c){var v=x[c.toLowerCase()];return v?{r:v[0],g:v[1],b:v[2],a:1}:null},_rgbColorToRGBA:function(c){if(c.indexOf("rgb(")===0){c=c.match(/rgb\(([^)]+)\)/)[1];var v=c.split(/ *, */).map(Number);return{r:v[0],g:v[1],b:v[2],a:1}}},_rgbaColorToRGBA:function(c){if(c.indexOf("rgba(")===0){c=c.match(/rgba\(([^)]+)\)/)[1];var v=c.split(/ *, */).map(Number);return{r:v[0],g:v[1],b:v[2],a:v[3]}}},_hex6ColorToRGBA:function(c){if(c[0]==="#"&&c.length===7)return{r:parseInt(c.slice(1,3),16),g:parseInt(c.slice(3,5),16),b:parseInt(c.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(c){if(c[0]==="#"&&c.length===4)return{r:parseInt(c[1]+c[1],16),g:parseInt(c[2]+c[2],16),b:parseInt(c[3]+c[3],16),a:1}},_hslColorToRGBA:function(c){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(c)){var v=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(c);v[0];var m=v.slice(1),T=Number(m[0])/360,F=Number(m[1])/100,P=Number(m[2])/100,N=void 0,E=void 0,A=void 0;if(F===0)return A=P*255,{r:Math.round(A),g:Math.round(A),b:Math.round(A),a:1};P<.5?N=P*(1+F):N=P+F-P*F;for(var D=2*P-N,R=[0,0,0],b=0;b<3;b++)E=T+1/3*-(b-1),E<0&&E++,E>1&&E--,6*E<1?A=D+(N-D)*6*E:2*E<1?A=N:3*E<2?A=D+(N-D)*(2/3-E)*6:A=D,R[b]=A*255;return{r:Math.round(R[0]),g:Math.round(R[1]),b:Math.round(R[2]),a:1}}},haveIntersection:function(c,v){return!(v.x>c.x+c.width||v.x+v.width<c.x||v.y>c.y+c.height||v.y+v.height<c.y)},cloneObject:function(c){var v={};for(var m in c)this._isPlainObject(c[m])?v[m]=this.cloneObject(c[m]):this._isArray(c[m])?v[m]=this.cloneArray(c[m]):v[m]=c[m];return v},cloneArray:function(c){return c.slice(0)},_degToRad:function(c){return c*h},_radToDeg:function(c){return c*l},_getRotation:function(c){return r.Konva.angleDeg?a.Util._radToDeg(c):c},_capitalize:function(c){return c.charAt(0).toUpperCase()+c.slice(1)},throw:function(c){throw new Error(y+c)},error:function(c){console.error(y+c)},warn:function(c){r.Konva.showWarnings&&console.warn(f+c)},extend:function(c,v){function m(){this.constructor=c}m.prototype=v.prototype;var T=c.prototype;c.prototype=new m;for(var F in T)T.hasOwnProperty(F)&&(c.prototype[F]=T[F]);c.__super__=v.prototype,c.super=v},_getControlPoints:function(c,v,m,T,F,P,N){var E=Math.sqrt(Math.pow(m-c,2)+Math.pow(T-v,2)),A=Math.sqrt(Math.pow(F-m,2)+Math.pow(P-T,2)),D=N*E/(E+A),R=N*A/(E+A),b=m-D*(F-c),d=T-D*(P-v),p=m+R*(F-c),_=T+R*(P-v);return[b,d,p,_]},_expandPoints:function(c,v){var m=c.length,T=[],F,P;for(F=2;F<m-2;F+=2)P=a.Util._getControlPoints(c[F-2],c[F-1],c[F],c[F+1],c[F+2],c[F+3],v),T.push(P[0]),T.push(P[1]),T.push(c[F]),T.push(c[F+1]),T.push(P[2]),T.push(P[3]);return T},each:function(c,v){for(var m in c)v(m,c[m])},_inRange:function(c,v,m){return v<=c&&c<m},_getProjectionToSegment:function(c,v,m,T,F,P){var N,E,A,D=(c-m)*(c-m)+(v-T)*(v-T);if(D==0)N=c,E=v,A=(F-m)*(F-m)+(P-T)*(P-T);else{var R=((F-c)*(m-c)+(P-v)*(T-v))/D;R<0?(N=c,E=v,A=(c-F)*(c-F)+(v-P)*(v-P)):R>1?(N=m,E=T,A=(m-F)*(m-F)+(T-P)*(T-P)):(N=c+R*(m-c),E=v+R*(T-v),A=(N-F)*(N-F)+(E-P)*(E-P))}return[N,E,A]},_getProjectionToLine:function(c,v,m){var T=a.Util.cloneObject(c),F=Number.MAX_VALUE;return v.forEach(function(P,N){if(!(!m&&N===v.length-1)){var E=v[(N+1)%v.length],A=a.Util._getProjectionToSegment(P.x,P.y,E.x,E.y,c.x,c.y),D=A[0],R=A[1],b=A[2];b<F&&(T.x=D,T.y=R,F=b)}}),T},_prepareArrayForTween:function(c,v,m){var T,F=[],P=[];if(c.length>v.length){var N=v;v=c,c=N}for(T=0;T<c.length;T+=2)F.push({x:c[T],y:c[T+1]});for(T=0;T<v.length;T+=2)P.push({x:v[T],y:v[T+1]});var E=[];return P.forEach(function(A){var D=a.Util._getProjectionToLine(A,F,m);E.push(D.x),E.push(D.y)}),E},_prepareToStringify:function(c){var v;c.visitedByCircularReferenceRemoval=!0;for(var m in c)if(c.hasOwnProperty(m)&&c[m]&&typeof c[m]=="object"){if(v=Object.getOwnPropertyDescriptor(c,m),c[m].visitedByCircularReferenceRemoval||a.Util._isElement(c[m]))if(v.configurable)delete c[m];else return null;else if(a.Util._prepareToStringify(c[m])===null)if(v.configurable)delete c[m];else return null}return delete c.visitedByCircularReferenceRemoval,c},_assign:function(c,v){for(var m in v)c[m]=v[m];return c},_getFirstPointerId:function(c){return c.touches?c.changedTouches[0].identifier:999}}})(J);var rt={},Y={},j={};Object.defineProperty(j,"__esModule",{value:!0});var Dt=X,ct=J;function It(a){return ct.Util._isString(a)?'"'+a+'"':Object.prototype.toString.call(a)==="[object Number]"||ct.Util._isBoolean(a)?a:Object.prototype.toString.call(a)}function Un(a){return a>255?255:a<0?0:Math.round(a)}j.RGBComponent=Un;function $n(a){return a>1?1:a<1e-4?1e-4:a}j.alphaComponent=$n;function Bn(){if(Dt.Konva.isUnminified)return function(a,r){return ct.Util._isNumber(a)||ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a number.'),a}}j.getNumberValidator=Bn;function Vn(){if(Dt.Konva.isUnminified)return function(a,r){var t=ct.Util._isNumber(a),e=a==="auto";return t||e||ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a number or "auto".'),a}}j.getNumberOrAutoValidator=Vn;function Hn(){if(Dt.Konva.isUnminified)return function(a,r){return ct.Util._isString(a)||ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a string.'),a}}j.getStringValidator=Hn;function zn(){if(Dt.Konva.isUnminified)return function(a,r){return ct.Util._isFunction(a)||ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a function.'),a}}j.getFunctionValidator=zn;function jn(){if(Dt.Konva.isUnminified)return function(a,r){return ct.Util._isArray(a)?a.forEach(function(t){ct.Util._isNumber(t)||ct.Util.warn('"'+r+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a array of numbers.'),a}}j.getNumberArrayValidator=jn;function Wn(){if(Dt.Konva.isUnminified)return function(a,r){var t=a===!0||a===!1;return t||ct.Util.warn(It(a)+' is a not valid value for "'+r+'" attribute. The value should be a boolean.'),a}}j.getBooleanValidator=Wn;function Kn(a){if(Dt.Konva.isUnminified)return function(r,t){return ct.Util.isObject(r)||ct.Util.warn(It(r)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+a),r}}j.getComponentValidator=Kn;(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=J,t=j,e="get",i="set";a.Factory={addGetterSetter:function(n,o,s,h,l){this.addGetter(n,o,s),this.addSetter(n,o,h,l),this.addOverloadedGetterSetter(n,o)},addGetter:function(n,o,s){var h=e+r.Util._capitalize(o);n.prototype[h]=n.prototype[h]||function(){var l=this.attrs[o];return l===void 0?s:l}},addSetter:function(n,o,s,h){var l=i+r.Util._capitalize(o);n.prototype[l]||a.Factory.overWriteSetter(n,o,s,h)},overWriteSetter:function(n,o,s,h){var l=i+r.Util._capitalize(o);n.prototype[l]=function(u){return s&&u!==void 0&&u!==null&&(u=s.call(this,u,o)),this._setAttr(o,u),h&&h.call(this),this}},addComponentsGetterSetter:function(n,o,s,h,l){var u=s.length,C=r.Util._capitalize,k=e+C(o),f=i+C(o),y,g;n.prototype[k]=function(){var S={};for(y=0;y<u;y++)g=s[y],S[g]=this.getAttr(o+C(g));return S};var x=t.getComponentValidator(s);n.prototype[f]=function(S){var G=this.attrs[o],c;h&&(S=h.call(this,S)),x&&x.call(this,S,o);for(c in S)S.hasOwnProperty(c)&&this._setAttr(o+C(c),S[c]);return this._fireChangeEvent(o,G,S),l&&l.call(this),this},this.addOverloadedGetterSetter(n,o)},addOverloadedGetterSetter:function(n,o){var s=r.Util._capitalize(o),h=i+s,l=e+s;n.prototype[o]=function(){return arguments.length?(this[h](arguments[0]),this):this[l]()}},addDeprecatedGetterSetter:function(n,o,s,h){r.Util.error("Adding deprecated "+o);var l=e+r.Util._capitalize(o),u=o+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[l]=function(){r.Util.error(u);var C=this.attrs[o];return C===void 0?s:C},this.addSetter(n,o,h,function(){r.Util.error(u)}),this.addOverloadedGetterSetter(n,o)},backCompat:function(n,o){r.Util.each(o,function(s,h){var l=n.prototype[h],u=e+r.Util._capitalize(s),C=i+r.Util._capitalize(s);function k(){l.apply(this,arguments),r.Util.error('"'+s+'" method is deprecated and will be removed soon. Use ""'+h+'" instead.')}n.prototype[s]=k,n.prototype[u]=k,n.prototype[C]=k})},afterSetFilter:function(){this._filterUpToDate=!1}}})(Y);var Pt={},Xt={},Di=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Xt,"__esModule",{value:!0});var ar=J,Ii=X,oi=",",Yn="(",Xn=")",qn="([",Jn="])",Qn=";",Zn="()",ta="=",si=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],ea=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],ra=100,Fe=function(){function a(r){this.canvas=r,this._context=r._canvas.getContext("2d"),Ii.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}return a.prototype.fillShape=function(r){r.fillEnabled()&&this._fill(r)},a.prototype._fill=function(r){},a.prototype.strokeShape=function(r){r.hasStroke()&&this._stroke(r)},a.prototype._stroke=function(r){},a.prototype.fillStrokeShape=function(r){this.fillShape(r),this.strokeShape(r)},a.prototype.getTrace=function(r){var t=this.traceArr,e=t.length,i="",n,o,s,h;for(n=0;n<e;n++)o=t[n],s=o.method,s?(h=o.args,i+=s,r?i+=Zn:ar.Util._isArray(h[0])?i+=qn+h.join(oi)+Jn:i+=Yn+h.join(oi)+Xn):(i+=o.property,r||(i+=ta+o.val)),i+=Qn;return i},a.prototype.clearTrace=function(){this.traceArr=[]},a.prototype._trace=function(r){var t=this.traceArr,e;t.push(r),e=t.length,e>=ra&&t.shift()},a.prototype.reset=function(){var r=this.getCanvas().getPixelRatio();this.setTransform(1*r,0,0,1*r,0,0)},a.prototype.getCanvas=function(){return this.canvas},a.prototype.clear=function(r){var t=this.getCanvas();r?this.clearRect(r.x||0,r.y||0,r.width||0,r.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)},a.prototype._applyLineCap=function(r){var t=r.getLineCap();t&&this.setAttr("lineCap",t)},a.prototype._applyOpacity=function(r){var t=r.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)},a.prototype._applyLineJoin=function(r){var t=r.getLineJoin();t&&this.setAttr("lineJoin",t)},a.prototype.setAttr=function(r,t){this._context[r]=t},a.prototype.arc=function(r,t,e,i,n,o){this._context.arc(r,t,e,i,n,o)},a.prototype.arcTo=function(r,t,e,i,n){this._context.arcTo(r,t,e,i,n)},a.prototype.beginPath=function(){this._context.beginPath()},a.prototype.bezierCurveTo=function(r,t,e,i,n,o){this._context.bezierCurveTo(r,t,e,i,n,o)},a.prototype.clearRect=function(r,t,e,i){this._context.clearRect(r,t,e,i)},a.prototype.clip=function(){this._context.clip()},a.prototype.closePath=function(){this._context.closePath()},a.prototype.createImageData=function(r,t){var e=arguments;if(e.length===2)return this._context.createImageData(r,t);if(e.length===1)return this._context.createImageData(r)},a.prototype.createLinearGradient=function(r,t,e,i){return this._context.createLinearGradient(r,t,e,i)},a.prototype.createPattern=function(r,t){return this._context.createPattern(r,t)},a.prototype.createRadialGradient=function(r,t,e,i,n,o){return this._context.createRadialGradient(r,t,e,i,n,o)},a.prototype.drawImage=function(r,t,e,i,n,o,s,h,l){var u=arguments,C=this._context;u.length===3?C.drawImage(r,t,e):u.length===5?C.drawImage(r,t,e,i,n):u.length===9&&C.drawImage(r,t,e,i,n,o,s,h,l)},a.prototype.ellipse=function(r,t,e,i,n,o,s,h){this._context.ellipse(r,t,e,i,n,o,s,h)},a.prototype.isPointInPath=function(r,t){return this._context.isPointInPath(r,t)},a.prototype.fill=function(){this._context.fill()},a.prototype.fillRect=function(r,t,e,i){this._context.fillRect(r,t,e,i)},a.prototype.strokeRect=function(r,t,e,i){this._context.strokeRect(r,t,e,i)},a.prototype.fillText=function(r,t,e){this._context.fillText(r,t,e)},a.prototype.measureText=function(r){return this._context.measureText(r)},a.prototype.getImageData=function(r,t,e,i){return this._context.getImageData(r,t,e,i)},a.prototype.lineTo=function(r,t){this._context.lineTo(r,t)},a.prototype.moveTo=function(r,t){this._context.moveTo(r,t)},a.prototype.rect=function(r,t,e,i){this._context.rect(r,t,e,i)},a.prototype.putImageData=function(r,t,e){this._context.putImageData(r,t,e)},a.prototype.quadraticCurveTo=function(r,t,e,i){this._context.quadraticCurveTo(r,t,e,i)},a.prototype.restore=function(){this._context.restore()},a.prototype.rotate=function(r){this._context.rotate(r)},a.prototype.save=function(){this._context.save()},a.prototype.scale=function(r,t){this._context.scale(r,t)},a.prototype.setLineDash=function(r){this._context.setLineDash?this._context.setLineDash(r):"mozDash"in this._context?this._context.mozDash=r:"webkitLineDash"in this._context&&(this._context.webkitLineDash=r)},a.prototype.getLineDash=function(){return this._context.getLineDash()},a.prototype.setTransform=function(r,t,e,i,n,o){this._context.setTransform(r,t,e,i,n,o)},a.prototype.stroke=function(){this._context.stroke()},a.prototype.strokeText=function(r,t,e,i){this._context.strokeText(r,t,e,i)},a.prototype.transform=function(r,t,e,i,n,o){this._context.transform(r,t,e,i,n,o)},a.prototype.translate=function(r,t){this._context.translate(r,t)},a.prototype._enableTrace=function(){var r=this,t=si.length,e=ar.Util._simplifyArray,i=this.setAttr,n,o,s=function(h){var l=r[h],u;r[h]=function(){return o=e(Array.prototype.slice.call(arguments,0)),u=l.apply(r,arguments),r._trace({method:h,args:o}),u}};for(n=0;n<t;n++)s(si[n]);r.setAttr=function(){i.apply(r,arguments);var h=arguments[0],l=arguments[1];(h==="shadowOffsetX"||h==="shadowOffsetY"||h==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),r._trace({property:h,val:l})}},a.prototype._applyGlobalCompositeOperation=function(r){var t=r.getGlobalCompositeOperation();t!=="source-over"&&this.setAttr("globalCompositeOperation",t)},a}();Xt.Context=Fe;ea.forEach(function(a){Object.defineProperty(Fe.prototype,a,{get:function(){return this._context[a]},set:function(r){this._context[a]=r}})});var ia=function(a){Di(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._fillColor=function(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)},r.prototype._fillPattern=function(t){var e=t.getFillPatternX(),i=t.getFillPatternY(),n=Ii.Konva.getAngle(t.getFillPatternRotation()),o=t.getFillPatternOffsetX(),s=t.getFillPatternOffsetY(),h=t.getFillPatternScaleX(),l=t.getFillPatternScaleY();(e||i)&&this.translate(e||0,i||0),n&&this.rotate(n),(h||l)&&this.scale(h,l),(o||s)&&this.translate(-1*o,-1*s),this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)},r.prototype._fillLinearGradient=function(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},r.prototype._fillRadialGradient=function(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},r.prototype._fill=function(t){var e=t.fill(),i=t.getFillPriority();if(e&&i==="color"){this._fillColor(t);return}var n=t.getFillPatternImage();if(n&&i==="pattern"){this._fillPattern(t);return}var o=t.getFillLinearGradientColorStops();if(o&&i==="linear-gradient"){this._fillLinearGradient(t);return}var s=t.getFillRadialGradientColorStops();if(s&&i==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):n?this._fillPattern(t):o?this._fillLinearGradient(t):s&&this._fillRadialGradient(t)},r.prototype._strokeLinearGradient=function(t){var e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),o=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(var s=0;s<n.length;s+=2)o.addColorStop(n[s],n[s+1]);this.setAttr("strokeStyle",o)}},r.prototype._stroke=function(t){var e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var o=t.getStrokeLinearGradientColorStops();o?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}},r.prototype._applyShadow=function(t){var e=ar.Util,i=e.get(t.getShadowRGBA(),"black"),n=e.get(t.getShadowBlur(),5),o=e.get(t.getShadowOffset(),{x:0,y:0}),s=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=s.x*h,u=s.y*h;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",n*Math.min(Math.abs(l),Math.abs(u))),this.setAttr("shadowOffsetX",o.x*l),this.setAttr("shadowOffsetY",o.y*u)},r}(Fe);Xt.SceneContext=ia;var na=function(a){Di(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._fill=function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},r.prototype.strokeShape=function(t){t.hasHitStroke()&&this._stroke(t)},r.prototype._stroke=function(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(t);var n=t.hitStrokeWidth(),o=n==="auto"?t.strokeWidth():n;this.setAttr("lineWidth",o),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}},r}(Fe);Xt.HitContext=na;var Ui=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Pt,"__esModule",{value:!0});var or=J,$i=Xt,Bi=X,aa=Y,oa=j,ge;function sa(){if(ge)return ge;var a=or.Util.createCanvasElement(),r=a.getContext("2d");return ge=function(){var t=Bi.Konva._global.devicePixelRatio||1,e=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1;return t/e}(),ge}var Ee=function(){function a(r){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var t=r||{},e=t.pixelRatio||Bi.Konva.pixelRatio||sa();this.pixelRatio=e,this._canvas=or.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return a.prototype.getContext=function(){return this.context},a.prototype.getPixelRatio=function(){return this.pixelRatio},a.prototype.setPixelRatio=function(r){var t=this.pixelRatio;this.pixelRatio=r,this.setSize(this.getWidth()/t,this.getHeight()/t)},a.prototype.setWidth=function(r){this.width=this._canvas.width=r*this.pixelRatio,this._canvas.style.width=r+"px";var t=this.pixelRatio,e=this.getContext()._context;e.scale(t,t)},a.prototype.setHeight=function(r){this.height=this._canvas.height=r*this.pixelRatio,this._canvas.style.height=r+"px";var t=this.pixelRatio,e=this.getContext()._context;e.scale(t,t)},a.prototype.getWidth=function(){return this.width},a.prototype.getHeight=function(){return this.height},a.prototype.setSize=function(r,t){this.setWidth(r||0),this.setHeight(t||0)},a.prototype.toDataURL=function(r,t){try{return this._canvas.toDataURL(r,t)}catch{try{return this._canvas.toDataURL()}catch(i){return or.Util.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}},a}();Pt.Canvas=Ee;aa.Factory.addGetterSetter(Ee,"pixelRatio",void 0,oa.getNumberValidator());var ha=function(a){Ui(r,a);function r(t){t===void 0&&(t={width:0,height:0});var e=a.call(this,t)||this;return e.context=new $i.SceneContext(e),e.setSize(t.width,t.height),e}return r}(Ee);Pt.SceneCanvas=ha;var la=function(a){Ui(r,a);function r(t){t===void 0&&(t={width:0,height:0});var e=a.call(this,t)||this;return e.hitCanvas=!0,e.context=new $i.HitContext(e),e.setSize(t.width,t.height),e}return r}(Ee);Pt.HitCanvas=la;var he={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=X,t=J;a.DD={get isDragging(){var e=!1;return a.DD._dragElements.forEach(function(i){i.dragStatus==="dragging"&&(e=!0)}),e},justDragged:!1,get node(){var e;return a.DD._dragElements.forEach(function(i){e=i.node}),e},_dragElements:new Map,_drag:function(e){a.DD._dragElements.forEach(function(i,n){var o=i.node,s=o.getStage();s.setPointersPositions(e),i.pointerId===void 0&&(i.pointerId=t.Util._getFirstPointerId(e));var h=s._changedPointerPositions.find(function(C){return C.id===i.pointerId});if(h){if(i.dragStatus!=="dragging"){var l=o.dragDistance(),u=Math.max(Math.abs(h.x-i.startPointerPos.x),Math.abs(h.y-i.startPointerPos.y));if(u<l||(o.startDrag({evt:e}),!o.isDragging()))return}o._setDragPosition(e,i),o.fire("dragmove",{type:"dragmove",target:o,evt:e},!0)}})},_endDragBefore:function(e){a.DD._dragElements.forEach(function(i,n){var o=i.node,s=o.getStage();e&&s.setPointersPositions(e);var h=s._changedPointerPositions.find(function(u){return u.id===i.pointerId});if(h){(i.dragStatus==="dragging"||i.dragStatus==="stopped")&&(a.DD.justDragged=!0,r.Konva.listenClickTap=!1,i.dragStatus="stopped");var l=i.node.getLayer()||i.node instanceof r.Konva.Stage&&i.node;l&&l.draw()}})},_endDragAfter:function(e){a.DD._dragElements.forEach(function(i,n){i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:e},!0),i.dragStatus!=="dragging"&&a.DD._dragElements.delete(n)})}},r.Konva.isBrowser&&(window.addEventListener("mouseup",a.DD._endDragBefore,!0),window.addEventListener("touchend",a.DD._endDragBefore,!0),window.addEventListener("mousemove",a.DD._drag),window.addEventListener("touchmove",a.DD._drag),window.addEventListener("mouseup",a.DD._endDragAfter,!1),window.addEventListener("touchend",a.DD._endDragAfter,!1))})(he);(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=J,t=Y,e=Pt,i=X,n=he,o=j;a.ids={},a.names={};var s=function(b,d){d&&(a.ids[d]=b)};a._removeId=function(b,d){b&&a.ids[b]===d&&delete a.ids[b]},a._addName=function(b,d){d&&(a.names[d]||(a.names[d]=[]),a.names[d].push(b))},a._removeName=function(b,d){if(b){var p=a.names[b];if(p){for(var _=0;_<p.length;_++){var O=p[_];O._id===d&&p.splice(_,1)}p.length===0&&delete a.names[b]}}};var h="absoluteOpacity",l="absoluteTransform",u="absoluteScale",C="canvas",k="Change",f="children",y="konva",g="listening",x="mouseenter",S="mouseleave",G="name",c="set",v="Shape",m=" ",T="stage",F="transform",P="Stage",N="visible",E=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(m),A=new r.Collection,D=1,R=function(){function b(d){var p=this;this._id=D++,this.eventListeners={},this.attrs={},this.index=0,this.parent=null,this._cache=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this.children=A,this._dragEventId=null,this.setAttrs(d),this.on(E,function(){if(p._batchingTransformChange){p._needClearTransformCache=!0;return}p._clearCache(F),p._clearSelfAndDescendantCache(l)}),this.on("visibleChange.konva",function(){p._clearSelfAndDescendantCache(N)}),this.on("listeningChange.konva",function(){p._clearSelfAndDescendantCache(g)}),this.on("opacityChange.konva",function(){p._clearSelfAndDescendantCache(h)})}return b.prototype.hasChildren=function(){return!1},b.prototype.getChildren=function(){return A},b.prototype._clearCache=function(d){d?this._cache.delete(d):this._cache.clear()},b.prototype._getCache=function(d,p){var _=this._cache.get(d);return _===void 0&&(_=p.call(this),this._cache.set(d,_)),_},b.prototype._getCanvasCache=function(){return this._cache.get(C)},b.prototype._clearSelfAndDescendantCache=function(d,p){this._clearCache(d),p&&d===l&&this.fire("_clearTransformCache"),!this.isCached()&&this.children&&this.children.each(function(_){_._clearSelfAndDescendantCache(d,!0)})},b.prototype.clearCache=function(){return this._cache.delete(C),this._clearSelfAndDescendantCache(),this},b.prototype.cache=function(d){var p=d||{},_={};(p.x===void 0||p.y===void 0||p.width===void 0||p.height===void 0)&&(_=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var O=Math.ceil(p.width||_.width),M=Math.ceil(p.height||_.height),L=p.pixelRatio,U=p.x===void 0?_.x:p.x,B=p.y===void 0?_.y:p.y,z=p.offset||0,K=p.drawBorder||!1;if(!O||!M){r.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}O+=z*2,M+=z*2,U-=z,B-=z;var ht=new e.SceneCanvas({pixelRatio:L,width:O,height:M}),gt=new e.SceneCanvas({pixelRatio:L,width:0,height:0}),lt=new e.HitCanvas({pixelRatio:1,width:O,height:M}),dt=ht.getContext(),Zt=lt.getContext();return lt.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,p.imageSmoothingEnabled===!1&&(ht.getContext()._context.imageSmoothingEnabled=!1,gt.getContext()._context.imageSmoothingEnabled=!1),dt.save(),Zt.save(),dt.translate(-U,-B),Zt.translate(-U,-B),this._isUnderCache=!0,this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(u),this.drawScene(ht,this,!0),this.drawHit(lt,this,!0),this._isUnderCache=!1,dt.restore(),Zt.restore(),K&&(dt.save(),dt.beginPath(),dt.rect(0,0,O,M),dt.closePath(),dt.setAttr("strokeStyle","red"),dt.setAttr("lineWidth",5),dt.stroke(),dt.restore()),this._cache.set(C,{scene:ht,filter:gt,hit:lt,x:U,y:B}),this},b.prototype.isCached=function(){return this._cache.has("canvas")},b.prototype.getClientRect=function(d){throw new Error('abstract "getClientRect" method call')},b.prototype._transformedRect=function(d,p){var _=[{x:d.x,y:d.y},{x:d.x+d.width,y:d.y},{x:d.x+d.width,y:d.y+d.height},{x:d.x,y:d.y+d.height}],O,M,L,U,B=this.getAbsoluteTransform(p);return _.forEach(function(z){var K=B.point(z);O===void 0&&(O=L=K.x,M=U=K.y),O=Math.min(O,K.x),M=Math.min(M,K.y),L=Math.max(L,K.x),U=Math.max(U,K.y)}),{x:O,y:M,width:L-O,height:U-M}},b.prototype._drawCachedSceneCanvas=function(d){d.save(),d._applyOpacity(this),d._applyGlobalCompositeOperation(this);var p=this._getCanvasCache();d.translate(p.x,p.y);var _=this._getCachedSceneCanvas(),O=_.pixelRatio;d.drawImage(_._canvas,0,0,_.width/O,_.height/O),d.restore()},b.prototype._drawCachedHitCanvas=function(d){var p=this._getCanvasCache(),_=p.hit;d.save(),d.translate(p.x,p.y),d.drawImage(_._canvas,0,0),d.restore()},b.prototype._getCachedSceneCanvas=function(){var d=this.filters(),p=this._getCanvasCache(),_=p.scene,O=p.filter,M=O.getContext(),L,U,B,z;if(d){if(!this._filterUpToDate){var K=_.pixelRatio;O.setSize(_.width/_.pixelRatio,_.height/_.pixelRatio);try{for(L=d.length,M.clear(),M.drawImage(_._canvas,0,0,_.getWidth()/K,_.getHeight()/K),U=M.getImageData(0,0,O.getWidth(),O.getHeight()),B=0;B<L;B++){if(z=d[B],typeof z!="function"){r.Util.error("Filter should be type of function, but got "+typeof z+" instead. Please check correct filters");continue}z.call(this,U),M.putImageData(U,0,0)}}catch(ht){r.Util.error("Unable to apply filter. "+ht.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return O}return _},b.prototype.on=function(d,p){if(arguments.length===3)return this._delegate.apply(this,arguments);var _=d.split(m),O=_.length,M,L,U,B,z;for(M=0;M<O;M++)L=_[M],U=L.split("."),B=U[0],z=U[1]||"",this.eventListeners[B]||(this.eventListeners[B]=[]),this.eventListeners[B].push({name:z,handler:p});return this},b.prototype.off=function(d,p){var _=(d||"").split(m),O=_.length,M,L,U,B,z,K;if(!d)for(L in this.eventListeners)this._off(L);for(M=0;M<O;M++)if(U=_[M],B=U.split("."),z=B[0],K=B[1],z)this.eventListeners[z]&&this._off(z,K,p);else for(L in this.eventListeners)this._off(L,K,p);return this},b.prototype.dispatchEvent=function(d){var p={target:this,type:d.type,evt:d};return this.fire(d.type,p),this},b.prototype.addEventListener=function(d,p){return this.on(d,function(_){p.call(this,_.evt)}),this},b.prototype.removeEventListener=function(d){return this.off(d),this},b.prototype._delegate=function(d,p,_){var O=this;this.on(d,function(M){for(var L=M.target.findAncestors(p,!0,O),U=0;U<L.length;U++)M=r.Util.cloneObject(M),M.currentTarget=L[U],_.call(L[U],M)})},b.prototype.remove=function(){return this.isDragging()&&this.stopDrag(),n.DD._dragElements.delete(this._id),this._remove(),this},b.prototype._clearCaches=function(){this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(T),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(g)},b.prototype._remove=function(){this._clearCaches();var d=this.getParent();d&&d.children&&(d.children.splice(this.index,1),d._setChildrenIndices(),this.parent=null)},b.prototype.destroy=function(){a._removeId(this.id(),this);for(var d=(this.name()||"").split(/\s/g),p=0;p<d.length;p++){var _=d[p];a._removeName(_,this._id)}return this.remove(),this},b.prototype.getAttr=function(d){var p="get"+r.Util._capitalize(d);return r.Util._isFunction(this[p])?this[p]():this.attrs[d]},b.prototype.getAncestors=function(){for(var d=this.getParent(),p=new r.Collection;d;)p.push(d),d=d.getParent();return p},b.prototype.getAttrs=function(){return this.attrs||{}},b.prototype.setAttrs=function(d){var p,_;if(!d)return this;for(p in d)p!==f&&(_=c+r.Util._capitalize(p),r.Util._isFunction(this[_])?this[_](d[p]):this._setAttr(p,d[p]));return this},b.prototype.isListening=function(){return this._getCache(g,this._isListening)},b.prototype._isListening=function(){var d=this.listening(),p=this.getParent();return d==="inherit"?p?p.isListening():!0:d},b.prototype.isVisible=function(){return this._getCache(N,this._isVisible)},b.prototype._isVisible=function(d){var p=this.visible(),_=this.getParent();return p==="inherit"?_&&_!==d?_._isVisible(d):!0:d&&d!==_?p&&_._isVisible(d):p},b.prototype.shouldDrawHit=function(){var d=this.getLayer();return!d&&this.isListening()&&this.isVisible()||d&&d.hitGraphEnabled()&&this.isListening()&&this.isVisible()},b.prototype.show=function(){return this.visible(!0),this},b.prototype.hide=function(){return this.visible(!1),this},b.prototype.getZIndex=function(){return this.index||0},b.prototype.getAbsoluteZIndex=function(){var d=this.getDepth(),p=this,_=0,O,M,L,U;function B(z){for(O=[],M=z.length,L=0;L<M;L++)U=z[L],_++,U.nodeType!==v&&(O=O.concat(U.getChildren().toArray())),U._id===p._id&&(L=M);O.length>0&&O[0].getDepth()<=d&&B(O)}return p.nodeType!==P&&B(p.getStage().getChildren()),_},b.prototype.getDepth=function(){for(var d=0,p=this.parent;p;)d++,p=p.parent;return d},b.prototype._batchTransformChanges=function(d){this._batchingTransformChange=!0,d(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(F),this._clearSelfAndDescendantCache(l,!0)),this._needClearTransformCache=!1},b.prototype.setPosition=function(d){var p=this;return this._batchTransformChanges(function(){p.x(d.x),p.y(d.y)}),this},b.prototype.getPosition=function(){return{x:this.x(),y:this.y()}},b.prototype.getAbsolutePosition=function(d){for(var p=!1,_=this.parent;_;){if(_.isCached()){p=!0;break}_=_.parent}p&&!d&&(d=!0);var O=this.getAbsoluteTransform(d).getMatrix(),M=new r.Transform,L=this.offset();return M.m=O.slice(),M.translate(L.x,L.y),M.getTranslation()},b.prototype.setAbsolutePosition=function(d){var p=this._clearTransform(),_;return this.attrs.x=p.x,this.attrs.y=p.y,delete p.x,delete p.y,this._clearCache(F),_=this._getAbsoluteTransform(),_.invert(),_.translate(d.x,d.y),d={x:this.attrs.x+_.getTranslation().x,y:this.attrs.y+_.getTranslation().y},this._setTransform(p),this.setPosition({x:d.x,y:d.y}),this},b.prototype._setTransform=function(d){var p;for(p in d)this.attrs[p]=d[p]},b.prototype._clearTransform=function(){var d={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,d},b.prototype.move=function(d){var p=d.x,_=d.y,O=this.x(),M=this.y();return p!==void 0&&(O+=p),_!==void 0&&(M+=_),this.setPosition({x:O,y:M}),this},b.prototype._eachAncestorReverse=function(d,p){var _=[],O=this.getParent(),M,L;if(p&&p._id===this._id){d(this);return}for(_.unshift(this);O&&(!p||O._id!==p._id);)_.unshift(O),O=O.parent;for(M=_.length,L=0;L<M;L++)d(_[L])},b.prototype.rotate=function(d){return this.rotation(this.rotation()+d),this},b.prototype.moveToTop=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var d=this.index;return this.parent.children.splice(d,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},b.prototype.moveUp=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveUp function is ignored."),!1;var d=this.index,p=this.parent.getChildren().length;return d<p-1?(this.parent.children.splice(d,1),this.parent.children.splice(d+1,0,this),this.parent._setChildrenIndices(),!0):!1},b.prototype.moveDown=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveDown function is ignored."),!1;var d=this.index;return d>0?(this.parent.children.splice(d,1),this.parent.children.splice(d-1,0,this),this.parent._setChildrenIndices(),!0):!1},b.prototype.moveToBottom=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var d=this.index;return d>0?(this.parent.children.splice(d,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},b.prototype.setZIndex=function(d){if(!this.parent)return r.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(d<0||d>=this.parent.children.length)&&r.Util.warn("Unexpected value "+d+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var p=this.index;return this.parent.children.splice(p,1),this.parent.children.splice(d,0,this),this.parent._setChildrenIndices(),this},b.prototype.getAbsoluteOpacity=function(){return this._getCache(h,this._getAbsoluteOpacity)},b.prototype._getAbsoluteOpacity=function(){var d=this.opacity(),p=this.getParent();return p&&!p._isUnderCache&&(d*=p.getAbsoluteOpacity()),d},b.prototype.moveTo=function(d){return this.getParent()!==d&&(this._remove(),d.add(this)),this},b.prototype.toObject=function(){var d={},p=this.getAttrs(),_,O,M,L,U;d.attrs={};for(_ in p)O=p[_],U=r.Util.isObject(O)&&!r.Util._isPlainObject(O)&&!r.Util._isArray(O),!U&&(M=typeof this[_]=="function"&&this[_],delete p[_],L=M?M.call(this):null,p[_]=O,L!==O&&(d.attrs[_]=O));return d.className=this.getClassName(),r.Util._prepareToStringify(d)},b.prototype.toJSON=function(){return JSON.stringify(this.toObject())},b.prototype.getParent=function(){return this.parent},b.prototype.findAncestors=function(d,p,_){var O=[];p&&this._isMatch(d)&&O.push(this);for(var M=this.parent;M;){if(M===_)return O;M._isMatch(d)&&O.push(M),M=M.parent}return O},b.prototype.isAncestorOf=function(d){return!1},b.prototype.findAncestor=function(d,p,_){return this.findAncestors(d,p,_)[0]},b.prototype._isMatch=function(d){if(!d)return!1;if(typeof d=="function")return d(this);var p=d.replace(/ /g,"").split(","),_=p.length,O,M;for(O=0;O<_;O++)if(M=p[O],r.Util.isValidSelector(M)||(r.Util.warn('Selector "'+M+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),r.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),r.Util.warn("Konva is awesome, right?")),M.charAt(0)==="#"){if(this.id()===M.slice(1))return!0}else if(M.charAt(0)==="."){if(this.hasName(M.slice(1)))return!0}else if(this.className===M||this.nodeType===M)return!0;return!1},b.prototype.getLayer=function(){var d=this.getParent();return d?d.getLayer():null},b.prototype.getStage=function(){return this._getCache(T,this._getStage)},b.prototype._getStage=function(){var d=this.getParent();if(d)return d.getStage()},b.prototype.fire=function(d,p,_){return p===void 0&&(p={}),p.target=p.target||this,_?this._fireAndBubble(d,p):this._fire(d,p),this},b.prototype.getAbsoluteTransform=function(d){return d?this._getAbsoluteTransform(d):this._getCache(l,this._getAbsoluteTransform)},b.prototype._getAbsoluteTransform=function(d){var p;if(d)return p=new r.Transform,this._eachAncestorReverse(function(O){var M=O.transformsEnabled();M==="all"?p.multiply(O.getTransform()):M==="position"&&p.translate(O.x()-O.offsetX(),O.y()-O.offsetY())},d),p;this.parent?p=this.parent.getAbsoluteTransform().copy():p=new r.Transform;var _=this.transformsEnabled();return _==="all"?p.multiply(this.getTransform()):_==="position"&&p.translate(this.x()-this.offsetX(),this.y()-this.offsetY()),p},b.prototype.getAbsoluteScale=function(d){for(var p=this;p;)p._isUnderCache&&(d=p),p=p.getParent();var _=this.getAbsoluteTransform(d),O=_.decompose();return{x:O.scaleX,y:O.scaleY}},b.prototype.getAbsoluteRotation=function(){return this.getAbsoluteTransform().decompose().rotation},b.prototype.getTransform=function(){return this._getCache(F,this._getTransform)},b.prototype._getTransform=function(){var d=new r.Transform,p=this.x(),_=this.y(),O=i.Konva.getAngle(this.rotation()),M=this.scaleX(),L=this.scaleY(),U=this.skewX(),B=this.skewY(),z=this.offsetX(),K=this.offsetY();return(p!==0||_!==0)&&d.translate(p,_),O!==0&&d.rotate(O),(U!==0||B!==0)&&d.skew(U,B),(M!==1||L!==1)&&d.scale(M,L),(z!==0||K!==0)&&d.translate(-1*z,-1*K),d},b.prototype.clone=function(d){var p=r.Util.cloneObject(this.attrs),_,O,M,L,U;for(_ in d)p[_]=d[_];var B=new this.constructor(p);for(_ in this.eventListeners)for(O=this.eventListeners[_],M=O.length,L=0;L<M;L++)U=O[L],U.name.indexOf(y)<0&&(B.eventListeners[_]||(B.eventListeners[_]=[]),B.eventListeners[_].push(U));return B},b.prototype._toKonvaCanvas=function(d){d=d||{};var p=this.getClientRect(),_=this.getStage(),O=d.x!==void 0?d.x:p.x,M=d.y!==void 0?d.y:p.y,L=d.pixelRatio||1,U=new e.SceneCanvas({width:d.width||p.width||(_?_.width():0),height:d.height||p.height||(_?_.height():0),pixelRatio:L}),B=U.getContext();return B.save(),(O||M)&&B.translate(-1*O,-1*M),this.drawScene(U),B.restore(),U},b.prototype.toCanvas=function(d){return this._toKonvaCanvas(d)._canvas},b.prototype.toDataURL=function(d){d=d||{};var p=d.mimeType||null,_=d.quality||null,O=this._toKonvaCanvas(d).toDataURL(p,_);return d.callback&&d.callback(O),O},b.prototype.toImage=function(d){if(!d||!d.callback)throw"callback required for toImage method config argument";var p=d.callback;delete d.callback,r.Util._urlToImage(this.toDataURL(d),function(_){p(_)})},b.prototype.setSize=function(d){return this.width(d.width),this.height(d.height),this},b.prototype.getSize=function(){return{width:this.width(),height:this.height()}},b.prototype.getClassName=function(){return this.className||this.nodeType},b.prototype.getType=function(){return this.nodeType},b.prototype.getDragDistance=function(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():i.Konva.dragDistance},b.prototype._off=function(d,p,_){var O=this.eventListeners[d],M,L,U;for(M=0;M<O.length;M++)if(L=O[M].name,U=O[M].handler,(L!=="konva"||p==="konva")&&(!p||L===p)&&(!_||_===U)){if(O.splice(M,1),O.length===0){delete this.eventListeners[d];break}M--}},b.prototype._fireChangeEvent=function(d,p,_){this._fire(d+k,{oldVal:p,newVal:_})},b.prototype.setId=function(d){var p=this.id();return a._removeId(p,this),s(this,d),this._setAttr("id",d),this},b.prototype.setName=function(d){var p=(this.name()||"").split(/\s/g),_=(d||"").split(/\s/g),O,M;for(M=0;M<p.length;M++)O=p[M],_.indexOf(O)===-1&&O&&a._removeName(O,this._id);for(M=0;M<_.length;M++)O=_[M],p.indexOf(O)===-1&&O&&a._addName(this,O);return this._setAttr(G,d),this},b.prototype.addName=function(d){if(!this.hasName(d)){var p=this.name(),_=p?p+" "+d:d;this.setName(_)}return this},b.prototype.hasName=function(d){if(!d)return!1;var p=this.name();if(!p)return!1;var _=(p||"").split(/\s/g);return _.indexOf(d)!==-1},b.prototype.removeName=function(d){var p=(this.name()||"").split(/\s/g),_=p.indexOf(d);return _!==-1&&(p.splice(_,1),this.setName(p.join(" "))),this},b.prototype.setAttr=function(d,p){var _=this[c+r.Util._capitalize(d)];return r.Util._isFunction(_)?_.call(this,p):this._setAttr(d,p),this},b.prototype._setAttr=function(d,p){var _=this.attrs[d];_===p&&!r.Util.isObject(p)||(p==null?delete this.attrs[d]:this.attrs[d]=p,this._fireChangeEvent(d,_,p))},b.prototype._setComponentAttr=function(d,p,_){var O;_!==void 0&&(O=this.attrs[d],O||(this.attrs[d]=this.getAttr(d)),this.attrs[d][p]=_,this._fireChangeEvent(d,O,_))},b.prototype._fireAndBubble=function(d,p,_){p&&this.nodeType===v&&(p.target=this);var O=(d===x||d===S)&&(_&&(this===_||this.isAncestorOf&&this.isAncestorOf(_))||this.nodeType==="Stage"&&!_);if(!O){this._fire(d,p);var M=(d===x||d===S)&&_&&_.isAncestorOf&&_.isAncestorOf(this)&&!_.isAncestorOf(this.parent);(p&&!p.cancelBubble||!p)&&this.parent&&this.parent.isListening()&&!M&&(_&&_.parent?this._fireAndBubble.call(this.parent,d,p,_):this._fireAndBubble.call(this.parent,d,p))}},b.prototype._fire=function(d,p){var _=this.eventListeners[d],O;if(_)for(p=p||{},p.currentTarget=this,p.type=d,O=0;O<_.length;O++)_[O].handler.call(this,p)},b.prototype.draw=function(){return this.drawScene(),this.drawHit(),this},b.prototype._createDragElement=function(d){var p=d?d.pointerId:void 0,_=this.getStage(),O=this.getAbsolutePosition(),M=_._getPointerById(p)||_._changedPointerPositions[0]||O;n.DD._dragElements.set(this._id,{node:this,startPointerPos:M,offset:{x:M.x-O.x,y:M.y-O.y},dragStatus:"ready",pointerId:p})},b.prototype.startDrag=function(d){n.DD._dragElements.has(this._id)||this._createDragElement(d);var p=n.DD._dragElements.get(this._id);p.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:d&&d.evt},!0)},b.prototype._setDragPosition=function(d,p){var _=this.getStage()._getPointerById(p.pointerId);if(_){var O={x:_.x-p.offset.x,y:_.y-p.offset.y},M=this.dragBoundFunc();if(M!==void 0){var L=M.call(this,O,d);L?O=L:r.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==O.x||this._lastPos.y!==O.y)&&(this.setAbsolutePosition(O),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=O}},b.prototype.stopDrag=function(d){var p=n.DD._dragElements.get(this._id);p&&(p.dragStatus="stopped"),n.DD._endDragBefore(d),n.DD._endDragAfter(d)},b.prototype.setDraggable=function(d){this._setAttr("draggable",d),this._dragChange()},b.prototype.isDragging=function(){var d=n.DD._dragElements.get(this._id);return d?d.dragStatus==="dragging":!1},b.prototype._listenDrag=function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(d){var p=this,_=d.evt.button!==void 0,O=!_||i.Konva.dragButtons.indexOf(d.evt.button)>=0;if(O&&!this.isDragging()){var M=!1;n.DD._dragElements.forEach(function(L){p.isAncestorOf(L.node)&&(M=!0)}),M||this._createDragElement(d)}})},b.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var d=this.getStage();d&&n.DD._dragElements.has(this._id)&&this.stopDrag()}},b.prototype._dragCleanup=function(){this.off("mousedown.konva"),this.off("touchstart.konva")},b.create=function(d,p){return r.Util._isString(d)&&(d=JSON.parse(d)),this._createNode(d,p)},b._createNode=function(d,p){var _=b.prototype.getClassName.call(d),O=d.children,M,L,U;p&&(d.attrs.container=p),i._NODES_REGISTRY[_]||(r.Util.warn('Can not find a node with class name "'+_+'". Fallback to "Shape".'),_="Shape");var B=i._NODES_REGISTRY[_];if(M=new B(d.attrs),O)for(L=O.length,U=0;U<L;U++)M.add(b._createNode(O[U]));return M},b}();a.Node=R,R.prototype.nodeType="Node",R.prototype._attrsAffectingSize=[],t.Factory.addGetterSetter(R,"zIndex"),t.Factory.addGetterSetter(R,"absolutePosition"),t.Factory.addGetterSetter(R,"position"),t.Factory.addGetterSetter(R,"x",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"y",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"globalCompositeOperation","source-over",o.getStringValidator()),t.Factory.addGetterSetter(R,"opacity",1,o.getNumberValidator()),t.Factory.addGetterSetter(R,"name","",o.getStringValidator()),t.Factory.addGetterSetter(R,"id","",o.getStringValidator()),t.Factory.addGetterSetter(R,"rotation",0,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(R,"scale",["x","y"]),t.Factory.addGetterSetter(R,"scaleX",1,o.getNumberValidator()),t.Factory.addGetterSetter(R,"scaleY",1,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(R,"skew",["x","y"]),t.Factory.addGetterSetter(R,"skewX",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"skewY",0,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(R,"offset",["x","y"]),t.Factory.addGetterSetter(R,"offsetX",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"offsetY",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"dragDistance",null,o.getNumberValidator()),t.Factory.addGetterSetter(R,"width",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"height",0,o.getNumberValidator()),t.Factory.addGetterSetter(R,"listening","inherit",function(b){var d=b===!0||b===!1||b==="inherit";return d||r.Util.warn(b+' is a not valid value for "listening" attribute. The value may be true, false or "inherit".'),b}),t.Factory.addGetterSetter(R,"preventDefault",!0,o.getBooleanValidator()),t.Factory.addGetterSetter(R,"filters",null,function(b){return this._filterUpToDate=!1,b}),t.Factory.addGetterSetter(R,"visible","inherit",function(b){var d=b===!0||b===!1||b==="inherit";return d||r.Util.warn(b+' is a not valid value for "visible" attribute. The value may be true, false or "inherit".'),b}),t.Factory.addGetterSetter(R,"transformsEnabled","all",o.getStringValidator()),t.Factory.addGetterSetter(R,"size"),t.Factory.addGetterSetter(R,"dragBoundFunc"),t.Factory.addGetterSetter(R,"draggable",!1,o.getBooleanValidator()),t.Factory.backCompat(R,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),r.Collection.mapMethods(R)})(rt);var Ft={},ca=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ft,"__esModule",{value:!0});var Lt=J,qt=Y,Je=rt,da=he,Me=j,ua=X,Et=function(a){ca(r,a);function r(){var t=a!==null&&a.apply(this,arguments)||this;return t.children=new Lt.Collection,t}return r.prototype.getChildren=function(t){if(!t)return this.children;var e=new Lt.Collection;return this.children.each(function(i){t(i)&&e.push(i)}),e},r.prototype.hasChildren=function(){return this.getChildren().length>0},r.prototype.removeChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.remove();return this.children=new Lt.Collection,this},r.prototype.destroyChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.destroy();return this.children=new Lt.Collection,this},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}var n=t[0];if(n.getParent())return n.moveTo(this),this;var o=this.children;return this._validateAdd(n),n._clearCaches(),n.index=o.length,n.parent=this,o.push(n),this._fire("add",{child:n}),this},r.prototype.destroy=function(){return this.hasChildren()&&this.destroyChildren(),a.prototype.destroy.call(this),this},r.prototype.find=function(t){return this._generalFind(t,!1)},r.prototype.get=function(t){return Lt.Util.warn("collection.get() method is deprecated. Please use collection.find() instead."),this.find(t)},r.prototype.findOne=function(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0},r.prototype._generalFind=function(t,e){var i=[];return this._descendants(function(n){var o=n._isMatch(t);return o&&i.push(n),!!(o&&e)}),Lt.Collection.toCollection(i)},r.prototype._descendants=function(t){for(var e=!1,i=0;i<this.children.length;i++){var n=this.children[i];if(e=t(n),e)return!0;if(n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1},r.prototype.toObject=function(){var t=Je.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,n=0;n<i;n++){var o=e[n];t.children.push(o.toObject())}return t},r.prototype.isAncestorOf=function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},r.prototype.clone=function(t){var e=Je.Node.prototype.clone.call(this,t);return this.getChildren().each(function(i){e.add(i.clone())}),e},r.prototype.getAllIntersections=function(t){var e=[];return this.find("Shape").each(function(i){i.isVisible()&&i.intersects(t)&&e.push(i)}),e},r.prototype._setChildrenIndices=function(){this.children.each(function(t,e){t.index=e})},r.prototype.drawScene=function(t,e,i){var n=this.getLayer(),o=t||n&&n.getCanvas(),s=o&&o.getContext(),h=this._getCanvasCache(),l=h&&h.scene;return(this.isVisible()||i)&&(!i&&l?(s.save(),n._applyTransform(this,s,e),this._drawCachedSceneCanvas(s),s.restore()):this._drawChildren(o,"drawScene",e,!1,i,i)),this},r.prototype.drawHit=function(t,e,i){var n=this.getLayer(),o=t||n&&n.hitCanvas,s=o&&o.getContext(),h=this._getCanvasCache(),l=h&&h.hit;return(this.shouldDrawHit(o)||i)&&(!i&&l?(s.save(),n._applyTransform(this,s,e),this._drawCachedHitCanvas(s),s.restore()):this._drawChildren(o,"drawHit",e,!1,i,i)),this},r.prototype._drawChildren=function(t,e,i,n,o,s){var h=this.getLayer(),l=t&&t.getContext(),u=this.clipWidth(),C=this.clipHeight(),k=this.clipFunc(),f=u&&C||k,y,g;if(f&&h){l.save();var x=this.getAbsoluteTransform(i),S=x.getMatrix();l.transform(S[0],S[1],S[2],S[3],S[4],S[5]),l.beginPath(),k?k.call(this,l,this):(y=this.clipX(),g=this.clipY(),l.rect(y,g,u,C)),l.clip(),S=x.copy().invert().getMatrix(),l.transform(S[0],S[1],S[2],S[3],S[4],S[5])}var G=this.globalCompositeOperation()!=="source-over"&&!s&&e==="drawScene";G&&h&&(l.save(),l._applyGlobalCompositeOperation(this)),this.children.each(function(c){c[e](t,i,n,o)}),G&&h&&l.restore(),f&&h&&l.restore()},r.prototype.shouldDrawHit=function(t){if(t&&t.isCache)return!0;var e=this.getLayer(),i=!1;da.DD._dragElements.forEach(function(o){o.dragStatus==="dragging"&&o.node.getLayer()===e&&(i=!0)});var n=!ua.Konva.hitOnDragEnabled&&i;return e&&e.hitGraphEnabled()&&this.isVisible()&&!n},r.prototype.getClientRect=function(t){t=t||{};var e=t.skipTransform,i=t.relativeTo,n,o,s,h,l={x:1/0,y:1/0,width:0,height:0},u=this;this.children.each(function(g){if(g.visible()){var x=g.getClientRect({relativeTo:u,skipShadow:t.skipShadow,skipStroke:t.skipStroke});x.width===0&&x.height===0||(n===void 0?(n=x.x,o=x.y,s=x.x+x.width,h=x.y+x.height):(n=Math.min(n,x.x),o=Math.min(o,x.y),s=Math.max(s,x.x+x.width),h=Math.max(h,x.y+x.height)))}});for(var C=this.find("Shape"),k=!1,f=0;f<C.length;f++){var y=C[f];if(y._isVisible(this)){k=!0;break}}return k&&n!==void 0?l={x:n,y:o,width:s-n,height:h-o}:l={x:0,y:0,width:0,height:0},e?l:this._transformedRect(l,i)},r}(Je.Node);Ft.Container=Et;qt.Factory.addComponentsGetterSetter(Et,"clip",["x","y","width","height"]);qt.Factory.addGetterSetter(Et,"clipX",void 0,Me.getNumberValidator());qt.Factory.addGetterSetter(Et,"clipY",void 0,Me.getNumberValidator());qt.Factory.addGetterSetter(Et,"clipWidth",void 0,Me.getNumberValidator());qt.Factory.addGetterSetter(Et,"clipHeight",void 0,Me.getNumberValidator());qt.Factory.addGetterSetter(Et,"clipFunc");Lt.Collection.mapMethods(Et);var Vi={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});var fa=X,oe=new Map,Hi=fa.Konva._global.PointerEvent!==void 0;function pa(a){return oe.get(a)}Mt.getCapturedShape=pa;function pr(a){return{evt:a,pointerId:a.pointerId}}Mt.createEvent=pr;function ga(a,r){return oe.get(a)===r}Mt.hasPointerCapture=ga;function va(a,r){zi(a);var t=r.getStage();t&&(oe.set(a,r),Hi&&r._fire("gotpointercapture",pr(new PointerEvent("gotpointercapture"))))}Mt.setPointerCapture=va;function zi(a,r){var t=oe.get(a);if(t){var e=t.getStage();e&&e.content,oe.delete(a),Hi&&t._fire("lostpointercapture",pr(new PointerEvent("lostpointercapture")))}}Mt.releaseCapture=zi;(function(a){var r=V&&V.__extends||function(){var st=function(H,w){return st=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,$){I.__proto__=$}||function(I,$){for(var W in $)$.hasOwnProperty(W)&&(I[W]=$[W])},st(H,w)};return function(H,w){st(H,w);function I(){this.constructor=H}H.prototype=w===null?Object.create(w):(I.prototype=w.prototype,new I)}}();Object.defineProperty(a,"__esModule",{value:!0});var t=J,e=Y,i=Ft,n=X,o=Pt,s=he,h=X,l=Mt,u="Stage",C="string",k="px",f="mouseout",y="mouseleave",g="mouseover",x="mouseenter",S="mousemove",G="mousedown",c="mouseup",v="pointermove",m="pointerdown",T="pointerup",F="pointercancel",P="lostpointercapture",N="contextmenu",E="click",A="dblclick",D="touchstart",R="touchend",b="tap",d="dbltap",p="touchmove",_="wheel",O="contentMouseout",M="contentMouseover",L="contentMousemove",U="contentMousedown",B="contentMouseup",z="contentContextmenu",K="contentClick",ht="contentDblclick",gt="contentTouchstart",lt="contentTouchend",dt="contentDbltap",Zt="contentTap",Cn="contentTouchmove",xn="contentWheel",Pn="relative",Tn="konvajs-content",kn="_",An="container",On=5,Fn="",ni=[x,G,S,c,f,D,p,R,g,_,N,m,v,T,F,P],En=ni.length;function Mn(st,H){st.content.addEventListener(H,function(w){st[kn+H](w)},!1)}var Gn="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";a.stages=[];function ai(st){return st===void 0&&(st={}),(st.clipFunc||st.clipWidth||st.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),st}var pe=function(st){r(H,st);function H(w){var I=st.call(this,ai(w))||this;return I._pointerPositions=[],I._changedPointerPositions=[],I._buildDOM(),I._bindContentEvents(),a.stages.push(I),I.on("widthChange.konva heightChange.konva",I._resizeDOM),I.on("visibleChange.konva",I._checkVisibility),I.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",function(){ai(I.attrs)}),I._checkVisibility(),I}return H.prototype._validateAdd=function(w){var I=w.getType()==="Layer",$=w.getType()==="FastLayer",W=I||$;W||t.Util.throw("You may only add layers to the stage.")},H.prototype._checkVisibility=function(){if(this.content){var w=this.visible()?"":"none";this.content.style.display=w}},H.prototype.setContainer=function(w){if(typeof w===C){if(w.charAt(0)==="."){var I=w.slice(1);w=document.getElementsByClassName(I)[0]}else{var $;w.charAt(0)!=="#"?$=w:$=w.slice(1),w=document.getElementById($)}if(!w)throw"Can not find container in document with id "+$}return this._setAttr(An,w),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),w.appendChild(this.content)),this},H.prototype.shouldDrawHit=function(){return!0},H.prototype.clear=function(){var w=this.children,I=w.length,$;for($=0;$<I;$++)w[$].clear();return this},H.prototype.clone=function(w){return w||(w={}),w.container=document.createElement("div"),i.Container.prototype.clone.call(this,w)},H.prototype.destroy=function(){st.prototype.destroy.call(this);var w=this.content;w&&t.Util._isInDocument(w)&&this.container().removeChild(w);var I=a.stages.indexOf(this);return I>-1&&a.stages.splice(I,1),this},H.prototype.getPointerPosition=function(){var w=this._pointerPositions[0]||this._changedPointerPositions[0];return w?{x:w.x,y:w.y}:(t.Util.warn(Gn),null)},H.prototype._getPointerById=function(w){return this._pointerPositions.find(function(I){return I.id===w})},H.prototype.getPointersPositions=function(){return this._pointerPositions},H.prototype.getStage=function(){return this},H.prototype.getContent=function(){return this.content},H.prototype._toKonvaCanvas=function(w){w=w||{};var I=w.x||0,$=w.y||0,W=new o.SceneCanvas({width:w.width||this.width(),height:w.height||this.height(),pixelRatio:w.pixelRatio||1}),q=W.getContext()._context,Q=this.children;return(I||$)&&q.translate(-1*I,-1*$),Q.each(function(at){if(at.isVisible()){var mt=at._toKonvaCanvas(w);q.drawImage(mt._canvas,I,$,mt.getWidth()/mt.getPixelRatio(),mt.getHeight()/mt.getPixelRatio())}}),W},H.prototype.getIntersection=function(w,I){if(!w)return null;var $=this.children,W=$.length,q=W-1,Q,at;for(Q=q;Q>=0;Q--)if(at=$[Q].getIntersection(w,I),at)return at;return null},H.prototype._resizeDOM=function(){var w=this.width(),I=this.height();this.content&&(this.content.style.width=w+k,this.content.style.height=I+k),this.bufferCanvas.setSize(w,I),this.bufferHitCanvas.setSize(w,I),this.children.each(function($){$.setSize({width:w,height:I}),$.draw()})},H.prototype.add=function(w){if(arguments.length>1){for(var I=0;I<arguments.length;I++)this.add(arguments[I]);return this}st.prototype.add.call(this,w);var $=this.children.length;return $>On&&t.Util.warn("The stage has "+$+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),w.setSize({width:this.width(),height:this.height()}),w.draw(),n.Konva.isBrowser&&this.content.appendChild(w.canvas._canvas),this},H.prototype.getParent=function(){return null},H.prototype.getLayer=function(){return null},H.prototype.hasPointerCapture=function(w){return l.hasPointerCapture(w,this)},H.prototype.setPointerCapture=function(w){l.setPointerCapture(w,this)},H.prototype.releaseCapture=function(w){l.releaseCapture(w,this)},H.prototype.getLayers=function(){return this.getChildren()},H.prototype._bindContentEvents=function(){if(n.Konva.isBrowser)for(var w=0;w<En;w++)Mn(this,ni[w])},H.prototype._mouseenter=function(w){this.setPointersPositions(w),this._fire(x,{evt:w,target:this,currentTarget:this})},H.prototype._mouseover=function(w){this.setPointersPositions(w),this._fire(M,{evt:w}),this._fire(g,{evt:w,target:this,currentTarget:this})},H.prototype._mouseout=function(w){var I;this.setPointersPositions(w);var $=!((I=this.targetShape)===null||I===void 0)&&I.getStage()?this.targetShape:null,W=!s.DD.isDragging||n.Konva.hitOnDragEnabled;$&&W?($._fireAndBubble(f,{evt:w}),$._fireAndBubble(y,{evt:w}),this._fire(y,{evt:w,target:this,currentTarget:this}),this.targetShape=null):W&&(this._fire(y,{evt:w,target:this,currentTarget:this}),this._fire(f,{evt:w,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[],this._fire(O,{evt:w})},H.prototype._mousemove=function(w){var I;if(n.Konva.UA.ieMobile)return this._touchmove(w);this.setPointersPositions(w);var $=t.Util._getFirstPointerId(w),W,q=!((I=this.targetShape)===null||I===void 0)&&I.getStage()?this.targetShape:null,Q=!s.DD.isDragging||n.Konva.hitOnDragEnabled;if(Q){if(W=this.getIntersection(this.getPointerPosition()),W&&W.isListening()){var at=q!==W;Q&&at?(q&&(q._fireAndBubble(f,{evt:w,pointerId:$},W),q._fireAndBubble(y,{evt:w,pointerId:$},W)),W._fireAndBubble(g,{evt:w,pointerId:$},q),W._fireAndBubble(x,{evt:w,pointerId:$},q),W._fireAndBubble(S,{evt:w,pointerId:$}),this.targetShape=W):W._fireAndBubble(S,{evt:w,pointerId:$})}else q&&Q&&(q._fireAndBubble(f,{evt:w,pointerId:$}),q._fireAndBubble(y,{evt:w,pointerId:$}),this._fire(g,{evt:w,target:this,currentTarget:this,pointerId:$}),this.targetShape=null),this._fire(S,{evt:w,target:this,currentTarget:this,pointerId:$});this._fire(L,{evt:w})}w.cancelable&&w.preventDefault()},H.prototype._mousedown=function(w){if(n.Konva.UA.ieMobile)return this._touchstart(w);this.setPointersPositions(w);var I=t.Util._getFirstPointerId(w),$=this.getIntersection(this.getPointerPosition());s.DD.justDragged=!1,n.Konva.listenClickTap=!0,$&&$.isListening()?(this.clickStartShape=$,$._fireAndBubble(G,{evt:w,pointerId:I})):this._fire(G,{evt:w,target:this,currentTarget:this,pointerId:I}),this._fire(U,{evt:w})},H.prototype._mouseup=function(w){if(n.Konva.UA.ieMobile)return this._touchend(w);this.setPointersPositions(w);var I=t.Util._getFirstPointerId(w),$=this.getIntersection(this.getPointerPosition()),W=this.clickStartShape,q=this.clickEndShape,Q=!1;n.Konva.inDblClickWindow?(Q=!0,clearTimeout(this.dblTimeout)):s.DD.justDragged||(n.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){n.Konva.inDblClickWindow=!1},n.Konva.dblClickWindow),$&&$.isListening()?(this.clickEndShape=$,$._fireAndBubble(c,{evt:w,pointerId:I}),n.Konva.listenClickTap&&W&&W._id===$._id&&($._fireAndBubble(E,{evt:w,pointerId:I}),Q&&q&&q===$&&$._fireAndBubble(A,{evt:w,pointerId:I}))):(this._fire(c,{evt:w,target:this,currentTarget:this,pointerId:I}),n.Konva.listenClickTap&&this._fire(E,{evt:w,target:this,currentTarget:this,pointerId:I}),Q&&this._fire(A,{evt:w,target:this,currentTarget:this,pointerId:I})),this._fire(B,{evt:w}),n.Konva.listenClickTap&&(this._fire(K,{evt:w}),Q&&this._fire(ht,{evt:w})),n.Konva.listenClickTap=!1,w.cancelable&&w.preventDefault()},H.prototype._contextmenu=function(w){this.setPointersPositions(w);var I=this.getIntersection(this.getPointerPosition());I&&I.isListening()?I._fireAndBubble(N,{evt:w}):this._fire(N,{evt:w,target:this,currentTarget:this}),this._fire(z,{evt:w})},H.prototype._touchstart=function(w){var I=this;this.setPointersPositions(w);var $=!1;this._changedPointerPositions.forEach(function(W){var q=I.getIntersection(W);n.Konva.listenClickTap=!0,s.DD.justDragged=!1;var Q=q&&q.isListening();Q&&(n.Konva.captureTouchEventsEnabled&&q.setPointerCapture(W.id),I.tapStartShape=q,q._fireAndBubble(D,{evt:w,pointerId:W.id},I),$=!0,q.isListening()&&q.preventDefault()&&w.cancelable&&w.preventDefault())}),$||this._fire(D,{evt:w,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(gt,{evt:w})},H.prototype._touchmove=function(w){var I=this;this.setPointersPositions(w);var $=!s.DD.isDragging||n.Konva.hitOnDragEnabled;if($){var W=!1,q={};this._changedPointerPositions.forEach(function(Q){var at=l.getCapturedShape(Q.id)||I.getIntersection(Q),mt=at&&at.isListening();mt&&(q[at._id]||(q[at._id]=!0,at._fireAndBubble(p,{evt:w,pointerId:Q.id}),W=!0,at.isListening()&&at.preventDefault()&&w.cancelable&&w.preventDefault()))}),W||this._fire(p,{evt:w,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(Cn,{evt:w})}s.DD.isDragging&&s.DD.node.preventDefault()&&w.cancelable&&w.preventDefault()},H.prototype._touchend=function(w){var I=this;this.setPointersPositions(w);var $=this.clickEndShape,W=!1;n.Konva.inDblClickWindow?(W=!0,clearTimeout(this.dblTimeout)):s.DD.justDragged||(n.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){n.Konva.inDblClickWindow=!1},n.Konva.dblClickWindow);var q=!1,Q={},at=!1,mt=!1;this._changedPointerPositions.forEach(function(zt){var pt=l.getCapturedShape(zt.id)||I.getIntersection(zt);pt&&pt.releaseCapture(zt.id);var Nn=pt&&pt.isListening();Nn&&(Q[pt._id]||(Q[pt._id]=!0,I.clickEndShape=pt,pt._fireAndBubble(R,{evt:w,pointerId:zt.id}),q=!0,n.Konva.listenClickTap&&pt===I.tapStartShape&&(at=!0,pt._fireAndBubble(b,{evt:w,pointerId:zt.id}),W&&$&&$===pt&&(mt=!0,pt._fireAndBubble(d,{evt:w,pointerId:zt.id}))),pt.isListening()&&pt.preventDefault()&&w.cancelable&&w.preventDefault()))}),q||this._fire(R,{evt:w,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),n.Konva.listenClickTap&&!at&&this._fire(b,{evt:w,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),W&&!mt&&this._fire(d,{evt:w,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(lt,{evt:w}),n.Konva.listenClickTap&&(this._fire(Zt,{evt:w}),W&&this._fire(dt,{evt:w})),n.Konva.listenClickTap=!1},H.prototype._wheel=function(w){this.setPointersPositions(w);var I=this.getIntersection(this.getPointerPosition());I&&I.isListening()?I._fireAndBubble(_,{evt:w}):this._fire(_,{evt:w,target:this,currentTarget:this}),this._fire(xn,{evt:w})},H.prototype._pointerdown=function(w){if(n.Konva._pointerEventsEnabled){this.setPointersPositions(w);var I=l.getCapturedShape(w.pointerId)||this.getIntersection(this.getPointerPosition());I&&I._fireAndBubble(m,l.createEvent(w))}},H.prototype._pointermove=function(w){if(n.Konva._pointerEventsEnabled){this.setPointersPositions(w);var I=l.getCapturedShape(w.pointerId)||this.getIntersection(this.getPointerPosition());I&&I._fireAndBubble(v,l.createEvent(w))}},H.prototype._pointerup=function(w){if(n.Konva._pointerEventsEnabled){this.setPointersPositions(w);var I=l.getCapturedShape(w.pointerId)||this.getIntersection(this.getPointerPosition());I&&I._fireAndBubble(T,l.createEvent(w)),l.releaseCapture(w.pointerId)}},H.prototype._pointercancel=function(w){if(n.Konva._pointerEventsEnabled){this.setPointersPositions(w);var I=l.getCapturedShape(w.pointerId)||this.getIntersection(this.getPointerPosition());I&&I._fireAndBubble(T,l.createEvent(w)),l.releaseCapture(w.pointerId)}},H.prototype._lostpointercapture=function(w){l.releaseCapture(w.pointerId)},H.prototype.setPointersPositions=function(w){var I=this,$=this._getContentPosition(),W=null,q=null;w=w||window.event,w.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],t.Collection.prototype.each.call(w.touches,function(Q){I._pointerPositions.push({id:Q.identifier,x:(Q.clientX-$.left)/$.scaleX,y:(Q.clientY-$.top)/$.scaleY})}),t.Collection.prototype.each.call(w.changedTouches||w.touches,function(Q){I._changedPointerPositions.push({id:Q.identifier,x:(Q.clientX-$.left)/$.scaleX,y:(Q.clientY-$.top)/$.scaleY})})):(W=(w.clientX-$.left)/$.scaleX,q=(w.clientY-$.top)/$.scaleY,this.pointerPos={x:W,y:q},this._pointerPositions=[{x:W,y:q,id:t.Util._getFirstPointerId(w)}],this._changedPointerPositions=[{x:W,y:q,id:t.Util._getFirstPointerId(w)}])},H.prototype._setPointerPosition=function(w){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(w)},H.prototype._getContentPosition=function(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var w=this.content.getBoundingClientRect();return{top:w.top,left:w.left,scaleX:w.width/this.content.clientWidth||1,scaleY:w.height/this.content.clientHeight||1}},H.prototype._buildDOM=function(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!n.Konva.isBrowser){var w=this.container();if(!w)throw"Stage has no container. A container is required.";w.innerHTML=Fn,this.content=document.createElement("div"),this.content.style.position=Pn,this.content.style.userSelect="none",this.content.className=Tn,this.content.setAttribute("role","presentation"),w.appendChild(this.content),this._resizeDOM()}},H.prototype.cache=function(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this},H.prototype.clearCache=function(){return this},H.prototype.batchDraw=function(){return this.children.each(function(w){w.batchDraw()}),this},H}(i.Container);a.Stage=pe,pe.prototype.nodeType=u,h._registerNode(pe),e.Factory.addGetterSetter(pe,"container")})(Vi);var gr={},Ge={},ya=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ge,"__esModule",{value:!0});var ie=J,_a=Ft,jt=rt,ji=Y,ma=Pt,le=function(a){ya(r,a);function r(t){var e=a.call(this,t)||this;return e.canvas=new ma.SceneCanvas,e._waitingForDraw=!1,e.on("visibleChange",e._checkVisibility),e._checkVisibility(),e.on("imageSmoothingEnabledChange",e._setSmoothEnabled),e._setSmoothEnabled(),e}return r.prototype.createPNGStream=function(){var t=this.canvas._canvas;return t.createPNGStream()},r.prototype.getCanvas=function(){return this.canvas},r.prototype.getHitCanvas=function(){return this.hitCanvas},r.prototype.getContext=function(){return this.getCanvas().getContext()},r.prototype.clear=function(t){return this.getContext().clear(t),this},r.prototype.setZIndex=function(t){a.prototype.setZIndex.call(this,t);var e=this.getStage();return e&&(e.content.removeChild(this.getCanvas()._canvas),t<e.children.length-1?e.content.insertBefore(this.getCanvas()._canvas,e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas)),this},r.prototype.moveToTop=function(){jt.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas)),!0},r.prototype.moveUp=function(){var t=jt.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return e?(e.content.removeChild(this.getCanvas()._canvas),this.index<e.children.length-1?e.content.insertBefore(this.getCanvas()._canvas,e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas),!0):!1},r.prototype.moveDown=function(){if(jt.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}return!0}return!1},r.prototype.moveToBottom=function(){if(jt.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}return!0}return!1},r.prototype.getLayer=function(){return this},r.prototype.hitGraphEnabled=function(){return!0},r.prototype.remove=function(){var t=this.getCanvas()._canvas;return jt.Node.prototype.remove.call(this),t&&t.parentNode&&ie.Util._isInDocument(t)&&t.parentNode.removeChild(t),this},r.prototype.getStage=function(){return this.parent},r.prototype.setSize=function(t){var e=t.width,i=t.height;return this.canvas.setSize(e,i),this._setSmoothEnabled(),this},r.prototype._toKonvaCanvas=function(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),jt.Node.prototype._toKonvaCanvas.call(this,t)},r.prototype._checkVisibility=function(){var t=this.visible();t?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"},r.prototype._setSmoothEnabled=function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()},r.prototype.getWidth=function(){if(this.parent)return this.parent.width()},r.prototype.setWidth=function(){ie.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},r.prototype.getHeight=function(){if(this.parent)return this.parent.height()},r.prototype.setHeight=function(){ie.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},r.prototype.getIntersection=function(t,e){return null},r.prototype.batchDraw=function(){var t=this;return this._waitingForDraw||(this._waitingForDraw=!0,ie.Util.requestAnimFrame(function(){t.draw(),t._waitingForDraw=!1})),this},r.prototype._applyTransform=function(t,e,i){var n=t.getAbsoluteTransform(i).getMatrix();e.transform(n[0],n[1],n[2],n[3],n[4],n[5])},r}(_a.Container);Ge.BaseLayer=le;le.prototype.nodeType="BaseLayer";ji.Factory.addGetterSetter(le,"imageSmoothingEnabled",!0);ji.Factory.addGetterSetter(le,"clearBeforeDraw",!0);ie.Collection.mapMethods(le);var ot={};(function(a){var r=V&&V.__extends||function(){var N=function(E,A){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,R){D.__proto__=R}||function(D,R){for(var b in R)R.hasOwnProperty(b)&&(D[b]=R[b])},N(E,A)};return function(E,A){N(E,A);function D(){this.constructor=E}E.prototype=A===null?Object.create(A):(D.prototype=A.prototype,new D)}}();Object.defineProperty(a,"__esModule",{value:!0});var t=J,e=Y,i=rt,n=j,o=X,s=Mt,h="hasShadow",l="shadowRGBA",u="patternImage",C="linearGradient",k="radialGradient",f;function y(){return f||(f=t.Util.createCanvasElement().getContext("2d"),f)}a.shapes={};function g(N){N.fill()}function x(N){N.stroke()}function S(N){N.fill()}function G(N){N.stroke()}function c(){this._clearCache(h)}function v(){this._clearCache(l)}function m(){this._clearCache(u)}function T(){this._clearCache(C)}function F(){this._clearCache(k)}var P=function(N){r(E,N);function E(A){for(var D=N.call(this,A)||this,R;R=t.Util.getRandomColor(),!(R&&!(R in a.shapes)););return D.colorKey=R,a.shapes[R]=D,D.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",c),D.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",v),D.on("fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",m),D.on("fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",T),D.on("fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",F),D}return E.prototype.getContext=function(){return this.getLayer().getContext()},E.prototype.getCanvas=function(){return this.getLayer().getCanvas()},E.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this._sceneFunc},E.prototype.getHitFunc=function(){return this.attrs.hitFunc||this._hitFunc},E.prototype.hasShadow=function(){return this._getCache(h,this._hasShadow)},E.prototype._hasShadow=function(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())},E.prototype._getFillPattern=function(){return this._getCache(u,this.__getFillPattern)},E.prototype.__getFillPattern=function(){if(this.fillPatternImage()){var A=y(),D=A.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");return D}},E.prototype._getLinearGradient=function(){return this._getCache(C,this.__getLinearGradient)},E.prototype.__getLinearGradient=function(){var A=this.fillLinearGradientColorStops();if(A){for(var D=y(),R=this.fillLinearGradientStartPoint(),b=this.fillLinearGradientEndPoint(),d=D.createLinearGradient(R.x,R.y,b.x,b.y),p=0;p<A.length;p+=2)d.addColorStop(A[p],A[p+1]);return d}},E.prototype._getRadialGradient=function(){return this._getCache(k,this.__getRadialGradient)},E.prototype.__getRadialGradient=function(){var A=this.fillRadialGradientColorStops();if(A){for(var D=y(),R=this.fillRadialGradientStartPoint(),b=this.fillRadialGradientEndPoint(),d=D.createRadialGradient(R.x,R.y,this.fillRadialGradientStartRadius(),b.x,b.y,this.fillRadialGradientEndRadius()),p=0;p<A.length;p+=2)d.addColorStop(A[p],A[p+1]);return d}},E.prototype.getShadowRGBA=function(){return this._getCache(l,this._getShadowRGBA)},E.prototype._getShadowRGBA=function(){if(this.hasShadow()){var A=t.Util.colorToRGBA(this.shadowColor());return"rgba("+A.r+","+A.g+","+A.b+","+A.a*(this.shadowOpacity()||1)+")"}},E.prototype.hasFill=function(){return this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())},E.prototype.hasStroke=function(){return this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops())},E.prototype.hasHitStroke=function(){var A=this.hitStrokeWidth();return A==="auto"?this.hasStroke():this.strokeEnabled()&&!!A},E.prototype.intersects=function(A){var D=this.getStage(),R=D.bufferHitCanvas,b;return R.getContext().clear(),this.drawHit(R),b=R.context.getImageData(Math.round(A.x),Math.round(A.y),1,1).data,b[3]>0},E.prototype.destroy=function(){return i.Node.prototype.destroy.call(this),delete a.shapes[this.colorKey],delete this.colorKey,this},E.prototype._useBufferCanvas=function(A){return!!((!A||this.hasShadow())&&this.perfectDrawEnabled()&&this.getAbsoluteOpacity()!==1&&this.hasFill()&&this.hasStroke()&&this.getStage())},E.prototype.setStrokeHitEnabled=function(A){t.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),A?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)},E.prototype.getStrokeHitEnabled=function(){return this.hitStrokeWidth()!==0},E.prototype.getSelfRect=function(){var A=this.size();return{x:this._centroid?-A.width/2:0,y:this._centroid?-A.height/2:0,width:A.width,height:A.height}},E.prototype.getClientRect=function(A){A=A||{};var D=A.skipTransform,R=A.relativeTo,b=this.getSelfRect(),d=!A.skipStroke&&this.hasStroke(),p=d&&this.strokeWidth()||0,_=b.width+p,O=b.height+p,M=!A.skipShadow&&this.hasShadow(),L=M?this.shadowOffsetX():0,U=M?this.shadowOffsetY():0,B=_+Math.abs(L),z=O+Math.abs(U),K=M&&this.shadowBlur()||0,ht=B+K*2,gt=z+K*2,lt=0;Math.round(p/2)!==p/2&&(lt=1);var dt={width:ht+lt,height:gt+lt,x:-Math.round(p/2+K)+Math.min(L,0)+b.x,y:-Math.round(p/2+K)+Math.min(U,0)+b.y};return D?dt:this._transformedRect(dt,R)},E.prototype.drawScene=function(A,D,R,b){var d=this.getLayer(),p=A||d.getCanvas(),_=p.getContext(),O=this._getCanvasCache(),M=this.sceneFunc(),L=this.hasShadow(),U=this.hasStroke(),B,z,K;if(!this.isVisible()&&!R)return this;if(O)return _.save(),d._applyTransform(this,_,D),this._drawCachedSceneCanvas(_),_.restore(),this;if(!M)return this;if(_.save(),this._useBufferCanvas(R)&&!b){if(B=this.getStage(),z=B.bufferCanvas,K=z.getContext(),K.clear(),K.save(),K._applyLineJoin(this),!R)if(d)d._applyTransform(this,K,D);else{var ht=this.getAbsoluteTransform(D).getMatrix();_.transform(ht[0],ht[1],ht[2],ht[3],ht[4],ht[5])}M.call(this,K,this),K.restore();var gt=z.pixelRatio;L&&!p.hitCanvas?(_.save(),_._applyShadow(this),_._applyOpacity(this),_._applyGlobalCompositeOperation(this),_.drawImage(z._canvas,0,0,z.width/gt,z.height/gt),_.restore()):(_._applyOpacity(this),_._applyGlobalCompositeOperation(this),_.drawImage(z._canvas,0,0,z.width/gt,z.height/gt))}else{if(_._applyLineJoin(this),!R)if(d)d._applyTransform(this,_,D);else{var lt=this.getAbsoluteTransform(D).getMatrix();_.transform(lt[0],lt[1],lt[2],lt[3],lt[4],lt[5])}L&&U&&!p.hitCanvas?(_.save(),R||(_._applyOpacity(this),_._applyGlobalCompositeOperation(this)),_._applyShadow(this),M.call(this,_,this),_.restore(),this.hasFill()&&this.shadowForStrokeEnabled()&&M.call(this,_,this)):L&&!p.hitCanvas?(_.save(),R||(_._applyOpacity(this),_._applyGlobalCompositeOperation(this)),_._applyShadow(this),M.call(this,_,this),_.restore()):(R||(_._applyOpacity(this),_._applyGlobalCompositeOperation(this)),M.call(this,_,this))}return _.restore(),this},E.prototype.drawHit=function(A,D,R){var b=this.getLayer(),d=A||b.hitCanvas,p=d&&d.getContext(),_=this.hitFunc()||this.sceneFunc(),O=this._getCanvasCache(),M=O&&O.hit;if(this.colorKey||(console.log(this),t.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()")),!this.shouldDrawHit()&&!R)return this;if(M)return p.save(),b._applyTransform(this,p,D),this._drawCachedHitCanvas(p),p.restore(),this;if(!_)return this;if(p.save(),p._applyLineJoin(this),!R)if(b)b._applyTransform(this,p,D);else{var L=this.getAbsoluteTransform(D).getMatrix();p.transform(L[0],L[1],L[2],L[3],L[4],L[5])}return _.call(this,p,this),p.restore(),this},E.prototype.drawHitFromCache=function(A){A===void 0&&(A=0);var D=this._getCanvasCache(),R=this._getCachedSceneCanvas(),b=D.hit,d=b.getContext(),p=b.getWidth(),_=b.getHeight(),O,M,L,U,B,z;d.clear(),d.drawImage(R._canvas,0,0,p,_);try{for(O=d.getImageData(0,0,p,_),M=O.data,L=M.length,U=t.Util._hexToRgb(this.colorKey),B=0;B<L;B+=4)z=M[B+3],z>A?(M[B]=U.r,M[B+1]=U.g,M[B+2]=U.b,M[B+3]=255):M[B+3]=0;d.putImageData(O,0,0)}catch(K){t.Util.error("Unable to draw hit graph from cached scene canvas. "+K.message)}return this},E.prototype.hasPointerCapture=function(A){return s.hasPointerCapture(A,this)},E.prototype.setPointerCapture=function(A){s.setPointerCapture(A,this)},E.prototype.releaseCapture=function(A){s.releaseCapture(A,this)},E}(i.Node);a.Shape=P,P.prototype._fillFunc=g,P.prototype._strokeFunc=x,P.prototype._fillFuncHit=S,P.prototype._strokeFuncHit=G,P.prototype._centroid=!1,P.prototype.nodeType="Shape",o._registerNode(P),e.Factory.addGetterSetter(P,"stroke",void 0,n.getStringValidator()),e.Factory.addGetterSetter(P,"strokeWidth",2,n.getNumberValidator()),e.Factory.addGetterSetter(P,"hitStrokeWidth","auto",n.getNumberOrAutoValidator()),e.Factory.addGetterSetter(P,"strokeHitEnabled",!0,n.getBooleanValidator()),e.Factory.addGetterSetter(P,"perfectDrawEnabled",!0,n.getBooleanValidator()),e.Factory.addGetterSetter(P,"shadowForStrokeEnabled",!0,n.getBooleanValidator()),e.Factory.addGetterSetter(P,"lineJoin"),e.Factory.addGetterSetter(P,"lineCap"),e.Factory.addGetterSetter(P,"sceneFunc"),e.Factory.addGetterSetter(P,"hitFunc"),e.Factory.addGetterSetter(P,"dash"),e.Factory.addGetterSetter(P,"dashOffset",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"shadowColor",void 0,n.getStringValidator()),e.Factory.addGetterSetter(P,"shadowBlur",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"shadowOpacity",1,n.getNumberValidator()),e.Factory.addComponentsGetterSetter(P,"shadowOffset",["x","y"]),e.Factory.addGetterSetter(P,"shadowOffsetX",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"shadowOffsetY",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"fillPatternImage"),e.Factory.addGetterSetter(P,"fill",void 0,n.getStringValidator()),e.Factory.addGetterSetter(P,"fillPatternX",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"fillPatternY",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"fillLinearGradientColorStops"),e.Factory.addGetterSetter(P,"strokeLinearGradientColorStops"),e.Factory.addGetterSetter(P,"fillRadialGradientStartRadius",0),e.Factory.addGetterSetter(P,"fillRadialGradientEndRadius",0),e.Factory.addGetterSetter(P,"fillRadialGradientColorStops"),e.Factory.addGetterSetter(P,"fillPatternRepeat","repeat"),e.Factory.addGetterSetter(P,"fillEnabled",!0),e.Factory.addGetterSetter(P,"strokeEnabled",!0),e.Factory.addGetterSetter(P,"shadowEnabled",!0),e.Factory.addGetterSetter(P,"dashEnabled",!0),e.Factory.addGetterSetter(P,"strokeScaleEnabled",!0),e.Factory.addGetterSetter(P,"fillPriority","color"),e.Factory.addComponentsGetterSetter(P,"fillPatternOffset",["x","y"]),e.Factory.addGetterSetter(P,"fillPatternOffsetX",0,n.getNumberValidator()),e.Factory.addGetterSetter(P,"fillPatternOffsetY",0,n.getNumberValidator()),e.Factory.addComponentsGetterSetter(P,"fillPatternScale",["x","y"]),e.Factory.addGetterSetter(P,"fillPatternScaleX",1,n.getNumberValidator()),e.Factory.addGetterSetter(P,"fillPatternScaleY",1,n.getNumberValidator()),e.Factory.addComponentsGetterSetter(P,"fillLinearGradientStartPoint",["x","y"]),e.Factory.addComponentsGetterSetter(P,"strokeLinearGradientStartPoint",["x","y"]),e.Factory.addGetterSetter(P,"fillLinearGradientStartPointX",0),e.Factory.addGetterSetter(P,"strokeLinearGradientStartPointX",0),e.Factory.addGetterSetter(P,"fillLinearGradientStartPointY",0),e.Factory.addGetterSetter(P,"strokeLinearGradientStartPointY",0),e.Factory.addComponentsGetterSetter(P,"fillLinearGradientEndPoint",["x","y"]),e.Factory.addComponentsGetterSetter(P,"strokeLinearGradientEndPoint",["x","y"]),e.Factory.addGetterSetter(P,"fillLinearGradientEndPointX",0),e.Factory.addGetterSetter(P,"strokeLinearGradientEndPointX",0),e.Factory.addGetterSetter(P,"fillLinearGradientEndPointY",0),e.Factory.addGetterSetter(P,"strokeLinearGradientEndPointY",0),e.Factory.addComponentsGetterSetter(P,"fillRadialGradientStartPoint",["x","y"]),e.Factory.addGetterSetter(P,"fillRadialGradientStartPointX",0),e.Factory.addGetterSetter(P,"fillRadialGradientStartPointY",0),e.Factory.addComponentsGetterSetter(P,"fillRadialGradientEndPoint",["x","y"]),e.Factory.addGetterSetter(P,"fillRadialGradientEndPointX",0),e.Factory.addGetterSetter(P,"fillRadialGradientEndPointY",0),e.Factory.addGetterSetter(P,"fillPatternRotation",0),e.Factory.backCompat(P,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),t.Collection.mapMethods(P)})(ot);var ba=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(gr,"__esModule",{value:!0});var sr=J,hi=Ft,Sa=Y,li=Ge,wa=Pt,Ca=ot,xa=j,Pa=X,Ta="#",ka="beforeDraw",Aa="draw",Wi=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Oa=Wi.length,ce=function(a){ba(r,a);function r(){var t=a!==null&&a.apply(this,arguments)||this;return t.hitCanvas=new wa.HitCanvas({pixelRatio:1}),t}return r.prototype.setSize=function(t){var e=t.width,i=t.height;return a.prototype.setSize.call(this,{width:e,height:i}),this.hitCanvas.setSize(e,i),this},r.prototype._validateAdd=function(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&sr.Util.throw("You may only add groups and shapes to a layer.")},r.prototype.getIntersection=function(t,e){var i,n,o,s;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var h=1,l=!1;;){for(n=0;n<Oa;n++){if(o=Wi[n],i=this._getIntersection({x:t.x+o.x*h,y:t.y+o.y*h}),s=i.shape,s&&e)return s.findAncestor(e,!0);if(s)return s;if(l=!!i.antialiased,!i.antialiased)break}if(l)h+=1;else return null}},r.prototype._getIntersection=function(t){var e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=i[3],o,s;return n===255?(o=sr.Util._rgbToHex(i[0],i[1],i[2]),s=Ca.shapes[Ta+o],s?{shape:s}:{antialiased:!0}):n>0?{antialiased:!0}:{}},r.prototype.drawScene=function(t,e){var i=this.getLayer(),n=t||i&&i.getCanvas();return this._fire(ka,{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),hi.Container.prototype.drawScene.call(this,n,e),this._fire(Aa,{node:this}),this},r.prototype.drawHit=function(t,e){var i=this.getLayer(),n=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),hi.Container.prototype.drawHit.call(this,n,e),this},r.prototype.clear=function(t){return li.BaseLayer.prototype.clear.call(this,t),this.getHitCanvas().getContext().clear(t),this},r.prototype.enableHitGraph=function(){return this.hitGraphEnabled(!0),this},r.prototype.disableHitGraph=function(){return this.hitGraphEnabled(!1),this},r.prototype.toggleHitCanvas=function(){if(this.parent){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}},r}(li.BaseLayer);gr.Layer=ce;ce.prototype.nodeType="Layer";Pa._registerNode(ce);Sa.Factory.addGetterSetter(ce,"hitGraphEnabled",!0,xa.getBooleanValidator());sr.Collection.mapMethods(ce);var vr={},Fa=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(vr,"__esModule",{value:!0});var Ki=J,Ea=Ft,Ma=Ge,Ga=X,Ne=function(a){Fa(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._validateAdd=function(t){var e=t.getType();e!=="Shape"&&Ki.Util.throw("You may only add shapes to a fast layer.")},r.prototype.hitGraphEnabled=function(){return!1},r.prototype.drawScene=function(t){var e=this.getLayer(),i=t||e&&e.getCanvas();return this.clearBeforeDraw()&&i.getContext().clear(),Ea.Container.prototype.drawScene.call(this,i),this},r.prototype.draw=function(){return this.drawScene(),this},r}(Ma.BaseLayer);vr.FastLayer=Ne;Ne.prototype.nodeType="FastLayer";Ga._registerNode(Ne);Ki.Collection.mapMethods(Ne);var de={},Na=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(de,"__esModule",{value:!0});var Yi=J,Ra=Ft,La=X,Re=function(a){Na(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._validateAdd=function(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Yi.Util.throw("You may only add groups and shapes to groups.")},r}(Ra.Container);de.Group=Re;Re.prototype.nodeType="Group";La._registerNode(Re);Yi.Collection.mapMethods(Re);var ue={};Object.defineProperty(ue,"__esModule",{value:!0});var Qe=X,Ze=function(){return Qe.glob.performance&&Qe.glob.performance.now?function(){return Qe.glob.performance.now()}:function(){return new Date().getTime()}}(),Da=function(){function a(r,t){this.id=a.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Ze(),frameRate:0},this.func=r,this.setLayers(t)}return a.prototype.setLayers=function(r){var t=[];return r?r.length>0?t=r:t=[r]:t=[],this.layers=t,this},a.prototype.getLayers=function(){return this.layers},a.prototype.addLayer=function(r){var t=this.layers,e=t.length,i;for(i=0;i<e;i++)if(t[i]._id===r._id)return!1;return this.layers.push(r),!0},a.prototype.isRunning=function(){var r=a,t=r.animations,e=t.length,i;for(i=0;i<e;i++)if(t[i].id===this.id)return!0;return!1},a.prototype.start=function(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Ze(),a._addAnimation(this),this},a.prototype.stop=function(){return a._removeAnimation(this),this},a.prototype._updateFrameObject=function(r){this.frame.timeDiff=r-this.frame.lastTime,this.frame.lastTime=r,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff},a._addAnimation=function(r){this.animations.push(r),this._handleAnimation()},a._removeAnimation=function(r){var t=r.id,e=this.animations,i=e.length,n;for(n=0;n<i;n++)if(e[n].id===t){this.animations.splice(n,1);break}},a._runFrames=function(){var r={},t=this.animations,e,i,n,o,s,h,l,u,C;for(o=0;o<t.length;o++)if(e=t[o],i=e.layers,n=e.func,e._updateFrameObject(Ze()),h=i.length,n?C=n.call(e,e.frame)!==!1:C=!0,!!C)for(s=0;s<h;s++)l=i[s],l._id!==void 0&&(r[l._id]=l);for(u in r)r.hasOwnProperty(u)&&r[u].draw()},a._animationLoop=function(){var r=a;r.animations.length?(r._runFrames(),requestAnimationFrame(r._animationLoop)):r.animRunning=!1},a._handleAnimation=function(){this.animRunning||(this.animRunning=!0,requestAnimationFrame(this._animationLoop))},a.animations=[],a.animIdCounter=0,a.animRunning=!1,a}();ue.Animation=Da;var Xi={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var r=J,t=ue,e=rt,i=X,n={node:1,duration:1,easing:1,onFinish:1,yoyo:1},o=1,s=2,h=3,l=0,u=["fill","stroke","shadowColor"],C=function(){function f(y,g,x,S,G,c,v){this.prop=y,this.propFunc=g,this.begin=S,this._pos=S,this.duration=c,this._change=0,this.prevPos=0,this.yoyo=v,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=x,this._change=G-this.begin,this.pause()}return f.prototype.fire=function(y){var g=this[y];g&&g()},f.prototype.setTime=function(y){y>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():y<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=y,this.update())},f.prototype.getTime=function(){return this._time},f.prototype.setPosition=function(y){this.prevPos=this._pos,this.propFunc(y),this._pos=y},f.prototype.getPosition=function(y){return y===void 0&&(y=this._time),this.func(y,this.begin,this._change,this.duration)},f.prototype.play=function(){this.state=s,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},f.prototype.reverse=function(){this.state=h,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},f.prototype.seek=function(y){this.pause(),this._time=y,this.update(),this.fire("onSeek")},f.prototype.reset=function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},f.prototype.finish=function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},f.prototype.update=function(){this.setPosition(this.getPosition(this._time))},f.prototype.onEnterFrame=function(){var y=this.getTimer()-this._startTime;this.state===s?this.setTime(y):this.state===h&&this.setTime(this.duration-y)},f.prototype.pause=function(){this.state=o,this.fire("onPause")},f.prototype.getTimer=function(){return new Date().getTime()},f}(),k=function(){function f(y){var g=this,x=y.node,S=x._id,G,c=y.easing||a.Easings.Linear,v=!!y.yoyo,m;typeof y.duration>"u"?G=.3:y.duration===0?G=.001:G=y.duration,this.node=x,this._id=l++;var T=x.getLayer()||(x instanceof i.Konva.Stage?x.getLayers():null);T||r.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new t.Animation(function(){g.tween.onEnterFrame()},T),this.tween=new C(m,function(F){g._tweenFunc(F)},c,0,1,G*1e3,v),this._addListeners(),f.attrs[S]||(f.attrs[S]={}),f.attrs[S][this._id]||(f.attrs[S][this._id]={}),f.tweens[S]||(f.tweens[S]={});for(m in y)n[m]===void 0&&this._addAttr(m,y[m]);this.reset(),this.onFinish=y.onFinish,this.onReset=y.onReset}return f.prototype._addAttr=function(y,g){var x=this.node,S=x._id,G,c,v,m,T,F,P,N;if(v=f.tweens[S][y],v&&delete f.attrs[S][v][y],G=x.getAttr(y),r.Util._isArray(g))if(c=[],T=Math.max(g.length,G.length),y==="points"&&g.length!==G.length&&(g.length>G.length?(P=G,G=r.Util._prepareArrayForTween(G,g,x.closed())):(F=g,g=r.Util._prepareArrayForTween(g,G,x.closed()))),y.indexOf("fill")===0)for(m=0;m<T;m++)if(m%2===0)c.push(g[m]-G[m]);else{var E=r.Util.colorToRGBA(G[m]);N=r.Util.colorToRGBA(g[m]),G[m]=E,c.push({r:N.r-E.r,g:N.g-E.g,b:N.b-E.b,a:N.a-E.a})}else for(m=0;m<T;m++)c.push(g[m]-G[m]);else u.indexOf(y)!==-1?(G=r.Util.colorToRGBA(G),N=r.Util.colorToRGBA(g),c={r:N.r-G.r,g:N.g-G.g,b:N.b-G.b,a:N.a-G.a}):c=g-G;f.attrs[S][this._id][y]={start:G,diff:c,end:g,trueEnd:F,trueStart:P},f.tweens[S][y]=this._id},f.prototype._tweenFunc=function(y){var g=this.node,x=f.attrs[g._id][this._id],S,G,c,v,m,T,F,P;for(S in x){if(G=x[S],c=G.start,v=G.diff,P=G.end,r.Util._isArray(c))if(m=[],F=Math.max(c.length,P.length),S.indexOf("fill")===0)for(T=0;T<F;T++)T%2===0?m.push((c[T]||0)+v[T]*y):m.push("rgba("+Math.round(c[T].r+v[T].r*y)+","+Math.round(c[T].g+v[T].g*y)+","+Math.round(c[T].b+v[T].b*y)+","+(c[T].a+v[T].a*y)+")");else for(T=0;T<F;T++)m.push((c[T]||0)+v[T]*y);else u.indexOf(S)!==-1?m="rgba("+Math.round(c.r+v.r*y)+","+Math.round(c.g+v.g*y)+","+Math.round(c.b+v.b*y)+","+(c.a+v.a*y)+")":m=c+v*y;g.setAttr(S,m)}},f.prototype._addListeners=function(){var y=this;this.tween.onPlay=function(){y.anim.start()},this.tween.onReverse=function(){y.anim.start()},this.tween.onPause=function(){y.anim.stop()},this.tween.onFinish=function(){var g=y.node,x=f.attrs[g._id][y._id];x.points&&x.points.trueEnd&&g.setAttr("points",x.points.trueEnd),y.onFinish&&y.onFinish.call(y)},this.tween.onReset=function(){var g=y.node,x=f.attrs[g._id][y._id];x.points&&x.points.trueStart&&g.points(x.points.trueStart),y.onReset&&y.onReset()}},f.prototype.play=function(){return this.tween.play(),this},f.prototype.reverse=function(){return this.tween.reverse(),this},f.prototype.reset=function(){return this.tween.reset(),this},f.prototype.seek=function(y){return this.tween.seek(y*1e3),this},f.prototype.pause=function(){return this.tween.pause(),this},f.prototype.finish=function(){return this.tween.finish(),this},f.prototype.destroy=function(){var y=this.node._id,g=this._id,x=f.tweens[y],S;this.pause();for(S in x)delete f.tweens[y][S];delete f.attrs[y][g]},f.attrs={},f.tweens={},f}();a.Tween=k,e.Node.prototype.to=function(f){var y=f.onFinish;f.node=this,f.onFinish=function(){this.destroy(),y&&y()};var g=new k(f);g.play()},a.Easings={BackEaseIn:function(f,y,g,x){var S=1.70158;return g*(f/=x)*f*((S+1)*f-S)+y},BackEaseOut:function(f,y,g,x){var S=1.70158;return g*((f=f/x-1)*f*((S+1)*f+S)+1)+y},BackEaseInOut:function(f,y,g,x){var S=1.70158;return(f/=x/2)<1?g/2*(f*f*(((S*=1.525)+1)*f-S))+y:g/2*((f-=2)*f*(((S*=1.525)+1)*f+S)+2)+y},ElasticEaseIn:function(f,y,g,x,S,G){var c=0;return f===0?y:(f/=x)===1?y+g:(G||(G=x*.3),!S||S<Math.abs(g)?(S=g,c=G/4):c=G/(2*Math.PI)*Math.asin(g/S),-(S*Math.pow(2,10*(f-=1))*Math.sin((f*x-c)*(2*Math.PI)/G))+y)},ElasticEaseOut:function(f,y,g,x,S,G){var c=0;return f===0?y:(f/=x)===1?y+g:(G||(G=x*.3),!S||S<Math.abs(g)?(S=g,c=G/4):c=G/(2*Math.PI)*Math.asin(g/S),S*Math.pow(2,-10*f)*Math.sin((f*x-c)*(2*Math.PI)/G)+g+y)},ElasticEaseInOut:function(f,y,g,x,S,G){var c=0;return f===0?y:(f/=x/2)===2?y+g:(G||(G=x*(.3*1.5)),!S||S<Math.abs(g)?(S=g,c=G/4):c=G/(2*Math.PI)*Math.asin(g/S),f<1?-.5*(S*Math.pow(2,10*(f-=1))*Math.sin((f*x-c)*(2*Math.PI)/G))+y:S*Math.pow(2,-10*(f-=1))*Math.sin((f*x-c)*(2*Math.PI)/G)*.5+g+y)},BounceEaseOut:function(f,y,g,x){return(f/=x)<1/2.75?g*(7.5625*f*f)+y:f<2/2.75?g*(7.5625*(f-=1.5/2.75)*f+.75)+y:f<2.5/2.75?g*(7.5625*(f-=2.25/2.75)*f+.9375)+y:g*(7.5625*(f-=2.625/2.75)*f+.984375)+y},BounceEaseIn:function(f,y,g,x){return g-a.Easings.BounceEaseOut(x-f,0,g,x)+y},BounceEaseInOut:function(f,y,g,x){return f<x/2?a.Easings.BounceEaseIn(f*2,0,g,x)*.5+y:a.Easings.BounceEaseOut(f*2-x,0,g,x)*.5+g*.5+y},EaseIn:function(f,y,g,x){return g*(f/=x)*f+y},EaseOut:function(f,y,g,x){return-g*(f/=x)*(f-2)+y},EaseInOut:function(f,y,g,x){return(f/=x/2)<1?g/2*f*f+y:-g/2*(--f*(f-2)-1)+y},StrongEaseIn:function(f,y,g,x){return g*(f/=x)*f*f*f*f+y},StrongEaseOut:function(f,y,g,x){return g*((f=f/x-1)*f*f*f*f+1)+y},StrongEaseInOut:function(f,y,g,x){return(f/=x/2)<1?g/2*f*f*f*f*f+y:g/2*((f-=2)*f*f*f*f+2)+y},Linear:function(f,y,g,x){return g*f/x+y}}})(Xi);Object.defineProperty(fr,"__esModule",{value:!0});var Ia=X,ve=J,tr=rt,Ua=Ft,ci=Vi,$a=gr,Ba=vr,Va=de,Ha=he,di=ot,za=ue,ui=Xi,ja=Xt,Wa=Pt;fr.Konva=ve.Util._assign(Ia.Konva,{Collection:ve.Collection,Util:ve.Util,Transform:ve.Transform,Node:tr.Node,ids:tr.ids,names:tr.names,Container:Ua.Container,Stage:ci.Stage,stages:ci.stages,Layer:$a.Layer,FastLayer:Ba.FastLayer,Group:Va.Group,DD:Ha.DD,Shape:di.Shape,shapes:di.shapes,Animation:za.Animation,Tween:ui.Tween,Easings:ui.Easings,Context:ja.Context,Canvas:Wa.Canvas});var yr={},Ka=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(yr,"__esModule",{value:!0});var Ya=J,Le=Y,Xa=ot,qa=X,De=j,Ja=X,St=function(a){Ka(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=qa.Konva.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(Xa.Shape);yr.Arc=St;St.prototype._centroid=!0;St.prototype.className="Arc";St.prototype._attrsAffectingSize=["innerRadius","outerRadius"];Ja._registerNode(St);Le.Factory.addGetterSetter(St,"innerRadius",0,De.getNumberValidator());Le.Factory.addGetterSetter(St,"outerRadius",0,De.getNumberValidator());Le.Factory.addGetterSetter(St,"angle",0,De.getNumberValidator());Le.Factory.addGetterSetter(St,"clockwise",!1,De.getBooleanValidator());Ya.Collection.mapMethods(St);var _r={},Ie={},Qa=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Za=V&&V.__spreadArrays||function(){for(var a=0,r=0,t=arguments.length;r<t;r++)a+=arguments[r].length;for(var e=Array(a),i=0,r=0;r<t;r++)for(var n=arguments[r],o=0,s=n.length;o<s;o++,i++)e[i]=n[o];return e};Object.defineProperty(Ie,"__esModule",{value:!0});var ne=J,Ue=Y,to=ot,qi=j,eo=X,Tt=function(a){Qa(r,a);function r(t){var e=a.call(this,t)||this;return e.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")}),e}return r.prototype._sceneFunc=function(t){var e=this.points(),i=e.length,n=this.tension(),o=this.closed(),s=this.bezier(),h,l,u;if(i){if(t.beginPath(),t.moveTo(e[0],e[1]),n!==0&&i>4){for(h=this.getTensionPoints(),l=h.length,u=o?0:4,o||t.quadraticCurveTo(h[0],h[1],h[2],h[3]);u<l-2;)t.bezierCurveTo(h[u++],h[u++],h[u++],h[u++],h[u++],h[u++]);o||t.quadraticCurveTo(h[l-2],h[l-1],e[i-2],e[i-1])}else if(s)for(u=2;u<i;)t.bezierCurveTo(e[u++],e[u++],e[u++],e[u++],e[u++],e[u++]);else for(u=2;u<i;u+=2)t.lineTo(e[u],e[u+1]);o?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}},r.prototype.getTensionPoints=function(){return this._getCache("tensionPoints",this._getTensionPoints)},r.prototype._getTensionPoints=function(){return this.closed()?this._getTensionPointsClosed():ne.Util._expandPoints(this.points(),this.tension())},r.prototype._getTensionPointsClosed=function(){var t=this.points(),e=t.length,i=this.tension(),n=ne.Util._getControlPoints(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),o=ne.Util._getControlPoints(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),s=ne.Util._expandPoints(t,i),h=[n[2],n[3]].concat(s).concat([o[0],o[1],t[e-2],t[e-1],o[2],o[3],n[0],n[1],t[0],t[1]]);return h},r.prototype.getWidth=function(){return this.getSelfRect().width},r.prototype.getHeight=function(){return this.getSelfRect().height},r.prototype.getSelfRect=function(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=Za([t[0],t[1]],this._getTensionPoints(),[t[t.length-2],t[t.length-1]]):t=this.points();for(var e=t[0],i=t[0],n=t[1],o=t[1],s,h,l=0;l<t.length/2;l++)s=t[l*2],h=t[l*2+1],e=Math.min(e,s),i=Math.max(i,s),n=Math.min(n,h),o=Math.max(o,h);return{x:e,y:n,width:i-e,height:o-n}},r}(to.Shape);Ie.Line=Tt;Tt.prototype.className="Line";Tt.prototype._attrsAffectingSize=["points","bezier","tension"];eo._registerNode(Tt);Ue.Factory.addGetterSetter(Tt,"closed",!1);Ue.Factory.addGetterSetter(Tt,"bezier",!1);Ue.Factory.addGetterSetter(Tt,"tension",0,qi.getNumberValidator());Ue.Factory.addGetterSetter(Tt,"points",[],qi.getNumberArrayValidator());ne.Collection.mapMethods(Tt);var ro=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(_r,"__esModule",{value:!0});var io=J,mr=Y,no=Ie,Ji=j,ao=X,Ut=function(a){ro(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){a.prototype._sceneFunc.call(this,t);var e=Math.PI*2,i=this.points(),n=i,o=this.tension()!==0&&i.length>4;o&&(n=this.getTensionPoints());var s=i.length,h,l;o?(h=i[s-2]-(n[n.length-2]+n[n.length-4])/2,l=i[s-1]-(n[n.length-1]+n[n.length-3])/2):(h=i[s-2]-i[s-4],l=i[s-1]-i[s-3]);var u=(Math.atan2(l,h)+e)%e,C=this.pointerLength(),k=this.pointerWidth();t.save(),t.beginPath(),t.translate(i[s-2],i[s-1]),t.rotate(u),t.moveTo(0,0),t.lineTo(-C,k/2),t.lineTo(-C,-k/2),t.closePath(),t.restore(),this.pointerAtBeginning()&&(t.save(),t.translate(i[0],i[1]),o?(h=(n[0]+n[2])/2-i[0],l=(n[1]+n[3])/2-i[1]):(h=i[2]-i[0],l=i[3]-i[1]),t.rotate((Math.atan2(-l,-h)+e)%e),t.moveTo(0,0),t.lineTo(-C,k/2),t.lineTo(-C,-k/2),t.closePath(),t.restore());var f=this.dashEnabled();f&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),f&&(this.attrs.dashEnabled=!0)},r.prototype.getSelfRect=function(){var t=a.prototype.getSelfRect.call(this),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+e*2,height:t.height+e*2}},r}(no.Line);_r.Arrow=Ut;Ut.prototype.className="Arrow";ao._registerNode(Ut);mr.Factory.addGetterSetter(Ut,"pointerLength",10,Ji.getNumberValidator());mr.Factory.addGetterSetter(Ut,"pointerWidth",10,Ji.getNumberValidator());mr.Factory.addGetterSetter(Ut,"pointerAtBeginning",!1);io.Collection.mapMethods(Ut);var br={},oo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(br,"__esModule",{value:!0});var so=J,ho=Y,lo=ot,co=j,uo=X,$t=function(a){oo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.radius(),0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius()!==t/2&&this.radius(t/2)},r.prototype.setHeight=function(t){this.radius()!==t/2&&this.radius(t/2)},r}(lo.Shape);br.Circle=$t;$t.prototype._centroid=!0;$t.prototype.className="Circle";$t.prototype._attrsAffectingSize=["radius"];uo._registerNode($t);ho.Factory.addGetterSetter($t,"radius",0,co.getNumberValidator());so.Collection.mapMethods($t);var Sr={},fo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Sr,"__esModule",{value:!0});var po=J,wr=Y,go=ot,Qi=j,vo=X,kt=function(a){fo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.radiusX(),i=this.radiusY();t.beginPath(),t.save(),e!==i&&t.scale(1,i/e),t.arc(0,0,e,0,Math.PI*2,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radiusX()*2},r.prototype.getHeight=function(){return this.radiusY()*2},r.prototype.setWidth=function(t){this.radiusX(t/2)},r.prototype.setHeight=function(t){this.radiusY(t/2)},r}(go.Shape);Sr.Ellipse=kt;kt.prototype.className="Ellipse";kt.prototype._centroid=!0;kt.prototype._attrsAffectingSize=["radiusX","radiusY"];vo._registerNode(kt);wr.Factory.addComponentsGetterSetter(kt,"radius",["x","y"]);wr.Factory.addGetterSetter(kt,"radiusX",0,Qi.getNumberValidator());wr.Factory.addGetterSetter(kt,"radiusY",0,Qi.getNumberValidator());po.Collection.mapMethods(kt);var Cr={},yo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Cr,"__esModule",{value:!0});var Zi=J,Jt=Y,_o=ot,$e=j,mo=X,wt=function(a){yo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._useBufferCanvas=function(){return!!((this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()&&this.getStage())},r.prototype._sceneFunc=function(t){var e=this.width(),i=this.height(),n=this.image(),o,s,h;n&&(o=this.cropWidth(),s=this.cropHeight(),o&&s?h=[n,this.cropX(),this.cropY(),o,s,0,0,e,i]:h=[n,0,0,e,i]),(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),n&&t.drawImage.apply(t,h)},r.prototype._hitFunc=function(t){var e=this.width(),i=this.height();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){var t,e=this.image();return(t=this.attrs.width)!==null&&t!==void 0?t:e?e.width:0},r.prototype.getHeight=function(){var t,e=this.image();return(t=this.attrs.height)!==null&&t!==void 0?t:e?e.height:0},r.fromURL=function(t,e){var i=Zi.Util.createImageElement();i.onload=function(){var n=new r({image:i});e(n)},i.crossOrigin="Anonymous",i.src=t},r}(_o.Shape);Cr.Image=wt;wt.prototype.className="Image";mo._registerNode(wt);Jt.Factory.addGetterSetter(wt,"image");Jt.Factory.addComponentsGetterSetter(wt,"crop",["x","y","width","height"]);Jt.Factory.addGetterSetter(wt,"cropX",0,$e.getNumberValidator());Jt.Factory.addGetterSetter(wt,"cropY",0,$e.getNumberValidator());Jt.Factory.addGetterSetter(wt,"cropWidth",0,$e.getNumberValidator());Jt.Factory.addGetterSetter(wt,"cropHeight",0,$e.getNumberValidator());Zi.Collection.mapMethods(wt);var Be={},tn=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Be,"__esModule",{value:!0});var en=J,Ve=Y,bo=ot,So=de,xr=j,rn=X,nn=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width"],wo="Change.konva",Co="none",hr="up",lr="right",cr="down",dr="left",xo=nn.length,He=function(a){tn(r,a);function r(t){var e=a.call(this,t)||this;return e.on("add.konva",function(i){this._addListeners(i.child),this._sync()}),e}return r.prototype.getText=function(){return this.find("Text")[0]},r.prototype.getTag=function(){return this.find("Tag")[0]},r.prototype._addListeners=function(t){var e=this,i,n=function(){e._sync()};for(i=0;i<xo;i++)t.on(nn[i]+wo,n)},r.prototype.getWidth=function(){return this.getText().width()},r.prototype.getHeight=function(){return this.getText().height()},r.prototype._sync=function(){var t=this.getText(),e=this.getTag(),i,n,o,s,h,l,u;if(t&&e){switch(i=t.width(),n=t.height(),o=e.pointerDirection(),s=e.pointerWidth(),u=e.pointerHeight(),h=0,l=0,o){case hr:h=i/2,l=-1*u;break;case lr:h=i+s,l=n/2;break;case cr:h=i/2,l=n+u;break;case dr:h=-1*s,l=n/2;break}e.setAttrs({x:-1*h,y:-1*l,width:i,height:n}),t.setAttrs({x:-1*h,y:-1*l})}},r}(So.Group);Be.Label=He;He.prototype.className="Label";rn._registerNode(He);en.Collection.mapMethods(He);var Gt=function(a){tn(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.width(),i=this.height(),n=this.pointerDirection(),o=this.pointerWidth(),s=this.pointerHeight(),h=Math.min(this.cornerRadius(),e/2,i/2);t.beginPath(),h?t.moveTo(h,0):t.moveTo(0,0),n===hr&&(t.lineTo((e-o)/2,0),t.lineTo(e/2,-1*s),t.lineTo((e+o)/2,0)),h?(t.lineTo(e-h,0),t.arc(e-h,h,h,Math.PI*3/2,0,!1)):t.lineTo(e,0),n===lr&&(t.lineTo(e,(i-s)/2),t.lineTo(e+o,i/2),t.lineTo(e,(i+s)/2)),h?(t.lineTo(e,i-h),t.arc(e-h,i-h,h,0,Math.PI/2,!1)):t.lineTo(e,i),n===cr&&(t.lineTo((e+o)/2,i),t.lineTo(e/2,i+s),t.lineTo((e-o)/2,i)),h?(t.lineTo(h,i),t.arc(h,i-h,h,Math.PI/2,Math.PI,!1)):t.lineTo(0,i),n===dr&&(t.lineTo(0,(i+s)/2),t.lineTo(-1*o,i/2),t.lineTo(0,(i-s)/2)),h&&(t.lineTo(0,h),t.arc(h,h,h,Math.PI,Math.PI*3/2,!1)),t.closePath(),t.fillStrokeShape(this)},r.prototype.getSelfRect=function(){var t=0,e=0,i=this.pointerWidth(),n=this.pointerHeight(),o=this.pointerDirection(),s=this.width(),h=this.height();return o===hr?(e-=n,h+=n):o===cr?h+=n:o===dr?(t-=i*1.5,s+=i):o===lr&&(s+=i*1.5),{x:t,y:e,width:s,height:h}},r}(bo.Shape);Be.Tag=Gt;Gt.prototype.className="Tag";rn._registerNode(Gt);Ve.Factory.addGetterSetter(Gt,"pointerDirection",Co);Ve.Factory.addGetterSetter(Gt,"pointerWidth",0,xr.getNumberValidator());Ve.Factory.addGetterSetter(Gt,"pointerHeight",0,xr.getNumberValidator());Ve.Factory.addGetterSetter(Gt,"cornerRadius",0,xr.getNumberValidator());en.Collection.mapMethods(Gt);var ze={},Po=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(ze,"__esModule",{value:!0});var To=J,ko=Y,Ao=ot,Oo=X,Qt=function(a){Po(r,a);function r(t){var e=a.call(this,t)||this;e.dataArray=[],e.pathLength=0,e.dataArray=r.parsePathData(e.data()),e.pathLength=0;for(var i=0;i<e.dataArray.length;++i)e.pathLength+=e.dataArray[i].pathLength;return e.on("dataChange.konva",function(){this.dataArray=r.parsePathData(this.data()),this.pathLength=0;for(var n=0;n<this.dataArray.length;++n)this.pathLength+=this.dataArray[n].pathLength}),e}return r.prototype._sceneFunc=function(t){var e=this.dataArray;t.beginPath();for(var i=!1,n=0;n<e.length;n++){var o=e[n].command,s=e[n].points;switch(o){case"L":t.lineTo(s[0],s[1]);break;case"M":t.moveTo(s[0],s[1]);break;case"C":t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var h=s[0],l=s[1],u=s[2],C=s[3],k=s[4],f=s[5],y=s[6],g=s[7],x=u>C?u:C,S=u>C?1:u/C,G=u>C?C/u:1;t.translate(h,l),t.rotate(y),t.scale(S,G),t.arc(0,0,x,k,k+f,1-g),t.scale(1/S,1/G),t.rotate(-y),t.translate(-h,-l);break;case"z":i=!0,t.closePath();break}}!i&&!this.hasFill()?t.strokeShape(this):t.fillStrokeShape(this)},r.prototype.getSelfRect=function(){var t=[];this.dataArray.forEach(function(u){if(u.command==="A"){var C=u.points[4],k=u.points[5],f=u.points[4]+k,y=Math.PI/180;if(Math.abs(C-f)<y&&(y=Math.abs(C-f)),k<0)for(var g=C-y;g>f;g-=y){var x=r.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],g,0);t.push(x.x,x.y)}else for(var g=C+y;g<f;g+=y){var x=r.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],g,0);t.push(x.x,x.y)}}else if(u.command==="C")for(var g=0;g<=1;g+=.01){var x=r.getPointOnCubicBezier(g,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3],u.points[4],u.points[5]);t.push(x.x,x.y)}else t=t.concat(u.points)});for(var e=t[0],i=t[0],n=t[1],o=t[1],s,h,l=0;l<t.length/2;l++)s=t[l*2],h=t[l*2+1],isNaN(s)||(e=Math.min(e,s),i=Math.max(i,s)),isNaN(h)||(n=Math.min(n,h),o=Math.max(o,h));return{x:Math.round(e),y:Math.round(n),width:Math.round(i-e),height:Math.round(o-n)}},r.prototype.getLength=function(){return this.pathLength},r.prototype.getPointAtLength=function(t){var e,i=0,n=this.dataArray.length;if(!n)return null;for(;i<n&&t>this.dataArray[i].pathLength;)t-=this.dataArray[i].pathLength,++i;if(i===n)return e=this.dataArray[i-1].points.slice(-2),{x:e[0],y:e[1]};if(t<.01)return e=this.dataArray[i].points.slice(0,2),{x:e[0],y:e[1]};var o=this.dataArray[i],s=o.points;switch(o.command){case"L":return r.getPointOnLine(t,o.start.x,o.start.y,s[0],s[1]);case"C":return r.getPointOnCubicBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return r.getPointOnQuadraticBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3]);case"A":var h=s[0],l=s[1],u=s[2],C=s[3],k=s[4],f=s[5],y=s[6];return k+=f*t/o.pathLength,r.getPointOnEllipticalArc(h,l,u,C,k,y)}return null},r.getLineLength=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},r.getPointOnLine=function(t,e,i,n,o,s,h){s===void 0&&(s=e),h===void 0&&(h=i);var l=(o-i)/(n-e+1e-8),u=Math.sqrt(t*t/(1+l*l));n<e&&(u*=-1);var C=l*u,k;if(n===e)k={x:s,y:h+C};else if((h-i)/(s-e+1e-8)===l)k={x:s+u,y:h+C};else{var f,y,g=this.getLineLength(e,i,n,o);if(g<1e-8)return;var x=(s-e)*(n-e)+(h-i)*(o-i);x=x/(g*g),f=e+x*(n-e),y=i+x*(o-i);var S=this.getLineLength(s,h,f,y),G=Math.sqrt(t*t-S*S);u=Math.sqrt(G*G/(1+l*l)),n<e&&(u*=-1),C=l*u,k={x:f+u,y:y+C}}return k},r.getPointOnCubicBezier=function(t,e,i,n,o,s,h,l,u){function C(S){return S*S*S}function k(S){return 3*S*S*(1-S)}function f(S){return 3*S*(1-S)*(1-S)}function y(S){return(1-S)*(1-S)*(1-S)}var g=l*C(t)+s*k(t)+n*f(t)+e*y(t),x=u*C(t)+h*k(t)+o*f(t)+i*y(t);return{x:g,y:x}},r.getPointOnQuadraticBezier=function(t,e,i,n,o,s,h){function l(y){return y*y}function u(y){return 2*y*(1-y)}function C(y){return(1-y)*(1-y)}var k=s*l(t)+n*u(t)+e*C(t),f=h*l(t)+o*u(t)+i*C(t);return{x:k,y:f}},r.getPointOnEllipticalArc=function(t,e,i,n,o,s){var h=Math.cos(s),l=Math.sin(s),u={x:i*Math.cos(o),y:n*Math.sin(o)};return{x:t+(u.x*h-u.y*l),y:e+(u.x*l+u.y*h)}},r.parsePathData=function(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)e=e.replace(new RegExp(i[n],"g"),"|"+i[n]);var o=e.split("|"),s=[],h=[],l=0,u=0,C=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,k;for(n=1;n<o.length;n++){var f=o[n],y=f.charAt(0);for(f=f.slice(1),h.length=0;k=C.exec(f);)h.push(k[0]);for(var g=[],x=0,S=h.length;x<S;x++){var G=parseFloat(h[x]);isNaN(G)?g.push(0):g.push(G)}for(;g.length>0&&!isNaN(g[0]);){var c=null,v=[],m=l,T=u,F,P,N,E,A,D,R,b,d,p;switch(y){case"l":l+=g.shift(),u+=g.shift(),c="L",v.push(l,u);break;case"L":l=g.shift(),u=g.shift(),v.push(l,u);break;case"m":var _=g.shift(),O=g.shift();if(l+=_,u+=O,c="M",s.length>2&&s[s.length-1].command==="z"){for(var M=s.length-2;M>=0;M--)if(s[M].command==="M"){l=s[M].points[0]+_,u=s[M].points[1]+O;break}}v.push(l,u),y="l";break;case"M":l=g.shift(),u=g.shift(),c="M",v.push(l,u),y="L";break;case"h":l+=g.shift(),c="L",v.push(l,u);break;case"H":l=g.shift(),c="L",v.push(l,u);break;case"v":u+=g.shift(),c="L",v.push(l,u);break;case"V":u=g.shift(),c="L",v.push(l,u);break;case"C":v.push(g.shift(),g.shift(),g.shift(),g.shift()),l=g.shift(),u=g.shift(),v.push(l,u);break;case"c":v.push(l+g.shift(),u+g.shift(),l+g.shift(),u+g.shift()),l+=g.shift(),u+=g.shift(),c="C",v.push(l,u);break;case"S":P=l,N=u,F=s[s.length-1],F.command==="C"&&(P=l+(l-F.points[2]),N=u+(u-F.points[3])),v.push(P,N,g.shift(),g.shift()),l=g.shift(),u=g.shift(),c="C",v.push(l,u);break;case"s":P=l,N=u,F=s[s.length-1],F.command==="C"&&(P=l+(l-F.points[2]),N=u+(u-F.points[3])),v.push(P,N,l+g.shift(),u+g.shift()),l+=g.shift(),u+=g.shift(),c="C",v.push(l,u);break;case"Q":v.push(g.shift(),g.shift()),l=g.shift(),u=g.shift(),v.push(l,u);break;case"q":v.push(l+g.shift(),u+g.shift()),l+=g.shift(),u+=g.shift(),c="Q",v.push(l,u);break;case"T":P=l,N=u,F=s[s.length-1],F.command==="Q"&&(P=l+(l-F.points[0]),N=u+(u-F.points[1])),l=g.shift(),u=g.shift(),c="Q",v.push(P,N,l,u);break;case"t":P=l,N=u,F=s[s.length-1],F.command==="Q"&&(P=l+(l-F.points[0]),N=u+(u-F.points[1])),l+=g.shift(),u+=g.shift(),c="Q",v.push(P,N,l,u);break;case"A":E=g.shift(),A=g.shift(),D=g.shift(),R=g.shift(),b=g.shift(),d=l,p=u,l=g.shift(),u=g.shift(),c="A",v=this.convertEndpointToCenterParameterization(d,p,l,u,R,b,E,A,D);break;case"a":E=g.shift(),A=g.shift(),D=g.shift(),R=g.shift(),b=g.shift(),d=l,p=u,l+=g.shift(),u+=g.shift(),c="A",v=this.convertEndpointToCenterParameterization(d,p,l,u,R,b,E,A,D);break}s.push({command:c||y,points:v,start:{x:m,y:T},pathLength:this.calcLength(m,T,c||y,v)})}(y==="z"||y==="Z")&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},r.calcLength=function(t,e,i,n){var o,s,h,l,u=r;switch(i){case"L":return u.getLineLength(t,e,n[0],n[1]);case"C":for(o=0,s=u.getPointOnCubicBezier(0,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),l=.01;l<=1;l+=.01)h=u.getPointOnCubicBezier(l,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),o+=u.getLineLength(s.x,s.y,h.x,h.y),s=h;return o;case"Q":for(o=0,s=u.getPointOnQuadraticBezier(0,t,e,n[0],n[1],n[2],n[3]),l=.01;l<=1;l+=.01)h=u.getPointOnQuadraticBezier(l,t,e,n[0],n[1],n[2],n[3]),o+=u.getLineLength(s.x,s.y,h.x,h.y),s=h;return o;case"A":o=0;var C=n[4],k=n[5],f=n[4]+k,y=Math.PI/180;if(Math.abs(C-f)<y&&(y=Math.abs(C-f)),s=u.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],C,0),k<0)for(l=C-y;l>f;l-=y)h=u.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),o+=u.getLineLength(s.x,s.y,h.x,h.y),s=h;else for(l=C+y;l<f;l+=y)h=u.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),o+=u.getLineLength(s.x,s.y,h.x,h.y),s=h;return h=u.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],f,0),o+=u.getLineLength(s.x,s.y,h.x,h.y),o}return 0},r.convertEndpointToCenterParameterization=function(t,e,i,n,o,s,h,l,u){var C=u*(Math.PI/180),k=Math.cos(C)*(t-i)/2+Math.sin(C)*(e-n)/2,f=-1*Math.sin(C)*(t-i)/2+Math.cos(C)*(e-n)/2,y=k*k/(h*h)+f*f/(l*l);y>1&&(h*=Math.sqrt(y),l*=Math.sqrt(y));var g=Math.sqrt((h*h*(l*l)-h*h*(f*f)-l*l*(k*k))/(h*h*(f*f)+l*l*(k*k)));o===s&&(g*=-1),isNaN(g)&&(g=0);var x=g*h*f/l,S=g*-l*k/h,G=(t+i)/2+Math.cos(C)*x-Math.sin(C)*S,c=(e+n)/2+Math.sin(C)*x+Math.cos(C)*S,v=function(A){return Math.sqrt(A[0]*A[0]+A[1]*A[1])},m=function(A,D){return(A[0]*D[0]+A[1]*D[1])/(v(A)*v(D))},T=function(A,D){return(A[0]*D[1]<A[1]*D[0]?-1:1)*Math.acos(m(A,D))},F=T([1,0],[(k-x)/h,(f-S)/l]),P=[(k-x)/h,(f-S)/l],N=[(-1*k-x)/h,(-1*f-S)/l],E=T(P,N);return m(P,N)<=-1&&(E=Math.PI),m(P,N)>=1&&(E=0),s===0&&E>0&&(E=E-2*Math.PI),s===1&&E<0&&(E=E+2*Math.PI),[G,c,h,l,F,E,C,s]},r}(Ao.Shape);ze.Path=Qt;Qt.prototype.className="Path";Qt.prototype._attrsAffectingSize=["data"];Oo._registerNode(Qt);ko.Factory.addGetterSetter(Qt,"data");To.Collection.mapMethods(Qt);var je={},Fo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(je,"__esModule",{value:!0});var Eo=J,Mo=Y,Go=ot,No=X,fe=function(a){Fo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.cornerRadius(),i=this.width(),n=this.height();if(t.beginPath(),!e)t.rect(0,0,i,n);else{var o=0,s=0,h=0,l=0;typeof e=="number"?o=s=h=l=Math.min(e,i/2,n/2):(o=Math.min(e[0],i/2,n/2),s=Math.min(e[1],i/2,n/2),l=Math.min(e[2],i/2,n/2),h=Math.min(e[3],i/2,n/2)),t.moveTo(o,0),t.lineTo(i-s,0),t.arc(i-s,s,s,Math.PI*3/2,0,!1),t.lineTo(i,n-l),t.arc(i-l,n-l,l,0,Math.PI/2,!1),t.lineTo(h,n),t.arc(h,n-h,h,Math.PI/2,Math.PI,!1),t.lineTo(0,o),t.arc(o,o,o,Math.PI,Math.PI*3/2,!1)}t.closePath(),t.fillStrokeShape(this)},r}(Go.Shape);je.Rect=fe;fe.prototype.className="Rect";No._registerNode(fe);Mo.Factory.addGetterSetter(fe,"cornerRadius",0);Eo.Collection.mapMethods(fe);var Pr={},Ro=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Pr,"__esModule",{value:!0});var Lo=J,an=Y,Do=ot,on=j,Io=X,Nt=function(a){Ro(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.sides(),i=this.radius(),n,o,s;for(t.beginPath(),t.moveTo(0,0-i),n=1;n<e;n++)o=i*Math.sin(n*2*Math.PI/e),s=-1*i*Math.cos(n*2*Math.PI/e),t.lineTo(o,s);t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius(t/2)},r.prototype.setHeight=function(t){this.radius(t/2)},r}(Do.Shape);Pr.RegularPolygon=Nt;Nt.prototype.className="RegularPolygon";Nt.prototype._centroid=!0;Nt.prototype._attrsAffectingSize=["radius"];Io._registerNode(Nt);an.Factory.addGetterSetter(Nt,"radius",0,on.getNumberValidator());an.Factory.addGetterSetter(Nt,"sides",0,on.getNumberValidator());Lo.Collection.mapMethods(Nt);var Tr={},Uo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Tr,"__esModule",{value:!0});var $o=J,sn=Y,Bo=ot,hn=j,Vo=X,fi=Math.PI*2,Rt=function(a){Uo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,fi,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),fi,0,!0),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(Bo.Shape);Tr.Ring=Rt;Rt.prototype.className="Ring";Rt.prototype._centroid=!0;Rt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];Vo._registerNode(Rt);sn.Factory.addGetterSetter(Rt,"innerRadius",0,hn.getNumberValidator());sn.Factory.addGetterSetter(Rt,"outerRadius",0,hn.getNumberValidator());$o.Collection.mapMethods(Rt);var kr={},Ho=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(kr,"__esModule",{value:!0});var zo=J,Bt=Y,jo=ot,Wo=ue,ln=j,Ko=X,yt=function(a){Ho(r,a);function r(t){var e=a.call(this,t)||this;return e._updated=!0,e.anim=new Wo.Animation(function(){var i=e._updated;return e._updated=!1,i}),e.on("animationChange.konva",function(){this.frameIndex(0)}),e.on("frameIndexChange.konva",function(){this._updated=!0}),e.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),e}return r.prototype._sceneFunc=function(t){var e=this.animation(),i=this.frameIndex(),n=i*4,o=this.animations()[e],s=this.frameOffsets(),h=o[n+0],l=o[n+1],u=o[n+2],C=o[n+3],k=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,u,C),t.closePath(),t.fillStrokeShape(this)),k)if(s){var f=s[e],y=i*2;t.drawImage(k,h,l,u,C,f[y+0],f[y+1],u,C)}else t.drawImage(k,h,l,u,C,0,0,u,C)},r.prototype._hitFunc=function(t){var e=this.animation(),i=this.frameIndex(),n=i*4,o=this.animations()[e],s=this.frameOffsets(),h=o[n+2],l=o[n+3];if(t.beginPath(),s){var u=s[e],C=i*2;t.rect(u[C+0],u[C+1],h,l)}else t.rect(0,0,h,l);t.closePath(),t.fillShape(this)},r.prototype._useBufferCanvas=function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},r.prototype._setInterval=function(){var t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())},r.prototype.start=function(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}},r.prototype.stop=function(){this.anim.stop(),clearInterval(this.interval)},r.prototype.isRunning=function(){return this.anim.isRunning()},r.prototype._updateIndex=function(){var t=this.frameIndex(),e=this.animation(),i=this.animations(),n=i[e],o=n.length/4;t<o-1?this.frameIndex(t+1):this.frameIndex(0)},r}(jo.Shape);kr.Sprite=yt;yt.prototype.className="Sprite";Ko._registerNode(yt);Bt.Factory.addGetterSetter(yt,"animation");Bt.Factory.addGetterSetter(yt,"animations");Bt.Factory.addGetterSetter(yt,"frameOffsets");Bt.Factory.addGetterSetter(yt,"image");Bt.Factory.addGetterSetter(yt,"frameIndex",0,ln.getNumberValidator());Bt.Factory.addGetterSetter(yt,"frameRate",17,ln.getNumberValidator());Bt.Factory.backCompat(yt,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});zo.Collection.mapMethods(yt);var Ar={},Yo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ar,"__esModule",{value:!0});var Xo=J,Or=Y,qo=ot,Fr=j,Jo=X,At=function(a){Yo(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.innerRadius(),i=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(var o=1;o<n*2;o++){var s=o%2===0?i:e,h=s*Math.sin(o*Math.PI/n),l=-1*s*Math.cos(o*Math.PI/n);t.lineTo(h,l)}t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(qo.Shape);Ar.Star=At;At.prototype.className="Star";At.prototype._centroid=!0;At.prototype._attrsAffectingSize=["innerRadius","outerRadius"];Jo._registerNode(At);Or.Factory.addGetterSetter(At,"numPoints",5,Fr.getNumberValidator());Or.Factory.addGetterSetter(At,"innerRadius",0,Fr.getNumberValidator());Or.Factory.addGetterSetter(At,"outerRadius",0,Fr.getNumberValidator());Xo.Collection.mapMethods(At);var We={},Qo=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(We,"__esModule",{value:!0});var xe=J,ft=Y,Zo=ot,ts=X,Vt=j,es=X,ye="auto",rs="center",te="justify",is="Change.konva",ns="2d",pi="-",cn="left",as="text",os="Text",ss="top",hs="bottom",gi="middle",dn="normal",vi="px ",ee=" ",ls="right",cs="word",ds="char",us="none",yi="",un=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],fs=un.length,_e;function er(){return _e||(_e=xe.Util.createCanvasElement().getContext(ns),_e)}function ps(a){a.fillText(this._partialText,this._partialTextX,this._partialTextY)}function gs(a){a.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function vs(a){return a=a||{},!a.fillLinearGradientColorStops&&!a.fillRadialGradientColorStops&&!a.fillPatternImage&&(a.fill=a.fill||"black"),a}var it=function(a){Qo(r,a);function r(t){var e=a.call(this,vs(t))||this;e._partialTextX=0,e._partialTextY=0;for(var i=0;i<fs;i++)e.on(un[i]+is,e._setTextData);return e._setTextData(),e}return r.prototype._sceneFunc=function(t){var e=this.padding(),i=this.fontSize(),n=this.lineHeight()*i,o=this.textArr,s=o.length,h=this.verticalAlign(),l=0,u=this.align(),C=this.getWidth(),k=this.letterSpacing(),f=this.fill(),y=this.textDecoration(),g=y.indexOf("underline")!==-1,x=y.indexOf("line-through")!==-1,S,G=0,G=n/2,c=0,v=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",gi),t.setAttr("textAlign",cn),h===gi?l=(this.getHeight()-s*n-e*2)/2:h===hs&&(l=this.getHeight()-s*n-e*2),t.translate(e,l+e),S=0;S<s;S++){var c=0,v=0,m=o[S],T=m.text,F=m.width,P=S!==s-1,N,E,A;if(t.save(),u===ls?c+=C-F-e*2:u===rs&&(c+=(C-F-e*2)/2),g&&(t.save(),t.beginPath(),t.moveTo(c,G+v+Math.round(i/2)),N=T.split(" ").length-1,E=N===0,A=u===te&&P&&!E?C-e*2:F,t.lineTo(c+Math.round(A),G+v+Math.round(i/2)),t.lineWidth=i/15,t.strokeStyle=f,t.stroke(),t.restore()),x&&(t.save(),t.beginPath(),t.moveTo(c,G+v),N=T.split(" ").length-1,E=N===0,A=u===te&&P&&!E?C-e*2:F,t.lineTo(c+Math.round(A),G+v),t.lineWidth=i/15,t.strokeStyle=f,t.stroke(),t.restore()),k!==0||u===te){N=T.split(" ").length-1;for(var D=0;D<T.length;D++){var R=T[D];R===" "&&S!==s-1&&u===te&&(c+=Math.floor((C-e*2-F)/N)),this._partialTextX=c,this._partialTextY=G+v,this._partialText=R,t.fillStrokeShape(this),c+=Math.round(this.measureSize(R).width)+k}}else this._partialTextX=c,this._partialTextY=G+v,this._partialText=T,t.fillStrokeShape(this);t.restore(),s>1&&(G+=n)}},r.prototype._hitFunc=function(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},r.prototype.setText=function(t){var e=xe.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(as,e),this},r.prototype.getWidth=function(){var t=this.attrs.width===ye||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width},r.prototype.getHeight=function(){var t=this.attrs.height===ye||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height},r.prototype.getTextWidth=function(){return this.textWidth},r.prototype.getTextHeight=function(){return xe.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},r.prototype.measureSize=function(t){var e=er(),i=this.fontSize(),n;return e.save(),e.font=this._getContextFont(),n=e.measureText(t),e.restore(),{width:n.width,height:i}},r.prototype._getContextFont=function(){return ts.Konva.UA.isIE?this.fontStyle()+ee+this.fontSize()+vi+this.fontFamily():this.fontStyle()+ee+this.fontVariant()+ee+this.fontSize()+vi+this.fontFamily()},r.prototype._addTextLine=function(t){this.align()===te&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e})},r.prototype._getTextWidth=function(t){var e=this.letterSpacing(),i=t.length;return er().measureText(t).width+(i?e*(i-1):0)},r.prototype._setTextData=function(){var t=this.text().split(`
`),e=+this.fontSize(),i=0,n=this.lineHeight()*e,o=this.attrs.width,s=this.attrs.height,h=o!==ye&&o!==void 0,l=s!==ye&&s!==void 0,u=this.padding(),C=o-u*2,k=s-u*2,f=0,y=this.wrap(),g=y!==us,x=y!==ds&&g,S=this.ellipsis()&&!g;this.textArr=[],er().font=this._getContextFont();for(var G=S?this._getTextWidth(yi):0,c=0,v=t.length;c<v;++c){var m=t[c],T=this._getTextWidth(m);if(h&&T>C)for(;m.length>0;){for(var F=0,P=m.length,N="",E=0;F<P;){var A=F+P>>>1,D=m.slice(0,A+1),R=this._getTextWidth(D)+G;R<=C?(F=A+1,N=D+(S?yi:""),E=R):P=A}if(N){if(x){var b,d=m[N.length],p=d===ee||d===pi;p&&E<=C?b=N.length:b=Math.max(N.lastIndexOf(ee),N.lastIndexOf(pi))+1,b>0&&(F=b,N=N.slice(0,F),E=this._getTextWidth(N))}if(N=N.trimRight(),this._addTextLine(N),i=Math.max(i,E),f+=n,!g||l&&f+n>k)break;if(m=m.slice(F),m=m.trimLeft(),m.length>0&&(T=this._getTextWidth(m),T<=C)){this._addTextLine(m),f+=n,i=Math.max(i,T);break}}else break}else this._addTextLine(m),f+=n,i=Math.max(i,T);if(l&&f+n>k)break}this.textHeight=e,this.textWidth=i},r.prototype.getStrokeScaleEnabled=function(){return!0},r}(Zo.Shape);We.Text=it;it.prototype._fillFunc=ps;it.prototype._strokeFunc=gs;it.prototype.className=os;it.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight"];es._registerNode(it);ft.Factory.overWriteSetter(it,"width",Vt.getNumberOrAutoValidator());ft.Factory.overWriteSetter(it,"height",Vt.getNumberOrAutoValidator());ft.Factory.addGetterSetter(it,"fontFamily","Arial");ft.Factory.addGetterSetter(it,"fontSize",12,Vt.getNumberValidator());ft.Factory.addGetterSetter(it,"fontStyle",dn);ft.Factory.addGetterSetter(it,"fontVariant",dn);ft.Factory.addGetterSetter(it,"padding",0,Vt.getNumberValidator());ft.Factory.addGetterSetter(it,"align",cn);ft.Factory.addGetterSetter(it,"verticalAlign",ss);ft.Factory.addGetterSetter(it,"lineHeight",1,Vt.getNumberValidator());ft.Factory.addGetterSetter(it,"wrap",cs);ft.Factory.addGetterSetter(it,"ellipsis",!1);ft.Factory.addGetterSetter(it,"letterSpacing",0,Vt.getNumberValidator());ft.Factory.addGetterSetter(it,"text","",Vt.getStringValidator());ft.Factory.addGetterSetter(it,"textDecoration","");xe.Collection.mapMethods(it);var Er={},ys=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Er,"__esModule",{value:!0});var Se=J,_t=Y,_s=ot,bt=ze,_i=We,fn=j,ms=X,bs="",pn="normal";function gn(a){a.fillText(this.partialText,0,0)}function vn(a){a.strokeText(this.partialText,0,0)}var nt=function(a){ys(r,a);function r(t){var e=a.call(this,t)||this;return e.dummyCanvas=Se.Util.createCanvasElement(),e.dataArray=[],e.dataArray=bt.Path.parsePathData(e.attrs.data),e.on("dataChange.konva",function(){this.dataArray=bt.Path.parsePathData(this.attrs.data),this._setTextData()}),e.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva",e._setTextData),t&&t.getKerning&&(Se.Util.warn('getKerning TextPath API is deprecated. Please use "kerningFunc" instead.'),e.kerningFunc(t.getKerning)),e._setTextData(),e}return r.prototype._sceneFunc=function(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),i=this.fill(),n=this.fontSize(),o=this.glyphInfo;e==="underline"&&t.beginPath();for(var s=0;s<o.length;s++){t.save();var h=o[s].p0;t.translate(h.x,h.y),t.rotate(o[s].rotation),this.partialText=o[s].text,t.fillStrokeShape(this),e==="underline"&&(s===0&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}e==="underline"&&(t.strokeStyle=i,t.lineWidth=n/20,t.stroke()),t.restore()},r.prototype._hitFunc=function(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var i=e[0].p0;t.moveTo(i.x,i.y)}for(var n=0;n<e.length;n++){var o=e[n].p1;t.lineTo(o.x,o.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()},r.prototype.getTextWidth=function(){return this.textWidth},r.prototype.getTextHeight=function(){return Se.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},r.prototype.setText=function(t){return _i.Text.prototype.setText.call(this,t)},r.prototype._getContextFont=function(){return _i.Text.prototype._getContextFont.call(this)},r.prototype._getTextSize=function(t){var e=this.dummyCanvas,i=e.getContext("2d");i.save(),i.font=this._getContextFont();var n=i.measureText(t);return i.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}},r.prototype._setTextData=function(){var t=this,e=this._getTextSize(this.attrs.text),i=this.letterSpacing(),n=this.align(),o=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var s=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0);this.glyphInfo=[];for(var h=0,l=0;l<t.dataArray.length;l++)t.dataArray[l].pathLength>0&&(h+=t.dataArray[l].pathLength);var u=0;n==="center"&&(u=Math.max(0,h/2-s/2)),n==="right"&&(u=Math.max(0,h-s));for(var C=this.text().split(""),k=this.text().split(" ").length-1,f,y,g,x=-1,S=0,G=function(){S=0;for(var R=t.dataArray,b=x+1;b<R.length;b++){if(R[b].pathLength>0)return x=b,R[b];R[b].command==="M"&&(f={x:R[b].points[0],y:R[b].points[1]})}return{}},c=function(R){var b=t._getTextSize(R).width+i;R===" "&&n==="justify"&&(b+=(h-s)/k);var d=0,p=0;for(y=void 0;Math.abs(b-d)/b>.01&&p<25;){p++;for(var _=d;g===void 0;)g=G(),g&&_+g.pathLength<b&&(_+=g.pathLength,g=void 0);if(g==={}||f===void 0)return;var O=!1;switch(g.command){case"L":bt.Path.getLineLength(f.x,f.y,g.points[0],g.points[1])>b?y=bt.Path.getPointOnLine(b,f.x,f.y,g.points[0],g.points[1],f.x,f.y):g=void 0;break;case"A":var M=g.points[4],L=g.points[5],U=g.points[4]+L;S===0?S=M+1e-8:b>d?S+=Math.PI/180*L/Math.abs(L):S-=Math.PI/360*L/Math.abs(L),(L<0&&S<U||L>=0&&S>U)&&(S=U,O=!0),y=bt.Path.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],S,g.points[6]);break;case"C":S===0?b>g.pathLength?S=1e-8:S=b/g.pathLength:b>d?S+=(b-d)/g.pathLength:S-=(d-b)/g.pathLength,S>1&&(S=1,O=!0),y=bt.Path.getPointOnCubicBezier(S,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3],g.points[4],g.points[5]);break;case"Q":S===0?S=b/g.pathLength:b>d?S+=(b-d)/g.pathLength:S-=(d-b)/g.pathLength,S>1&&(S=1,O=!0),y=bt.Path.getPointOnQuadraticBezier(S,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3]);break}y!==void 0&&(d=bt.Path.getLineLength(f.x,f.y,y.x,y.y)),O&&(O=!1,g=void 0)}},v="C",m=t._getTextSize(v).width+i,T=u/m-1,F=0;F<T&&(c(v),!(f===void 0||y===void 0));F++)f=y;for(var P=0;P<C.length&&(c(C[P]),!(f===void 0||y===void 0));P++){var N=bt.Path.getLineLength(f.x,f.y,y.x,y.y),E=0;if(o)try{E=o(C[P-1],C[P])*this.fontSize()}catch{E=0}f.x+=E,y.x+=E,this.textWidth+=E;var A=bt.Path.getPointOnLine(E+N/2,f.x,f.y,y.x,y.y),D=Math.atan2(y.y-f.y,y.x-f.x);this.glyphInfo.push({transposeX:A.x,transposeY:A.y,text:C[P],rotation:D,p0:f,p1:y}),f=y}},r.prototype.getSelfRect=function(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach(function(C){t.push(C.p0.x),t.push(C.p0.y),t.push(C.p1.x),t.push(C.p1.y)});for(var e=t[0]||0,i=t[0]||0,n=t[1]||0,o=t[1]||0,s,h,l=0;l<t.length/2;l++)s=t[l*2],h=t[l*2+1],e=Math.min(e,s),i=Math.max(i,s),n=Math.min(n,h),o=Math.max(o,h);var u=this.fontSize();return{x:e-u/2,y:n-u/2,width:i-e+u,height:o-n+u}},r}(_s.Shape);Er.TextPath=nt;nt.prototype._fillFunc=gn;nt.prototype._strokeFunc=vn;nt.prototype._fillFuncHit=gn;nt.prototype._strokeFuncHit=vn;nt.prototype.className="TextPath";nt.prototype._attrsAffectingSize=["text","fontSize","data"];ms._registerNode(nt);_t.Factory.addGetterSetter(nt,"data");_t.Factory.addGetterSetter(nt,"fontFamily","Arial");_t.Factory.addGetterSetter(nt,"fontSize",12,fn.getNumberValidator());_t.Factory.addGetterSetter(nt,"fontStyle",pn);_t.Factory.addGetterSetter(nt,"align","left");_t.Factory.addGetterSetter(nt,"letterSpacing",0,fn.getNumberValidator());_t.Factory.addGetterSetter(nt,"textBaseline","middle");_t.Factory.addGetterSetter(nt,"fontVariant",pn);_t.Factory.addGetterSetter(nt,"text",bs);_t.Factory.addGetterSetter(nt,"textDecoration",null);_t.Factory.addGetterSetter(nt,"kerningFunc",null);Se.Collection.mapMethods(nt);var Mr={},Ss=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Pe=V&&V.__assign||function(){return Pe=Object.assign||function(a){for(var r,t=1,e=arguments.length;t<e;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a},Pe.apply(this,arguments)};Object.defineProperty(Mr,"__esModule",{value:!0});var Z=J,et=Y,ws=rt,Cs=ot,xs=je,mi=de,vt=X,Ht=j,Ps=X,xt="tr-konva",Ts=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map(function(a){return a+("."+xt)}).join(" "),bi="nodesRect",ks=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"].map(function(a){return a+("."+xt)}).join(" "),As={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Os="ontouchstart"in vt.Konva._global;function Fs(a,r){if(a==="rotater")return"crosshair";r+=Z.Util._degToRad(As[a]||0);var t=(Z.Util._radToDeg(r)%360+360)%360;return Z.Util._inRange(t,315+22.5,360)||Z.Util._inRange(t,0,22.5)?"ns-resize":Z.Util._inRange(t,45-22.5,45+22.5)?"nesw-resize":Z.Util._inRange(t,90-22.5,90+22.5)?"ew-resize":Z.Util._inRange(t,135-22.5,135+22.5)?"nwse-resize":Z.Util._inRange(t,180-22.5,180+22.5)?"ns-resize":Z.Util._inRange(t,225-22.5,225+22.5)?"nesw-resize":Z.Util._inRange(t,270-22.5,270+22.5)?"ew-resize":Z.Util._inRange(t,315-22.5,315+22.5)?"nwse-resize":(Z.Util.error("Transformer has unknown angle for cursor detection: "+t),"pointer")}var Te=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Es(a){return{x:a.x+a.width/2*Math.cos(a.rotation)+a.height/2*Math.sin(-a.rotation),y:a.y+a.height/2*Math.cos(a.rotation)+a.width/2*Math.sin(a.rotation)}}function yn(a,r,t){var e=t.x+(a.x-t.x)*Math.cos(r)-(a.y-t.y)*Math.sin(r),i=t.y+(a.x-t.x)*Math.sin(r)+(a.y-t.y)*Math.cos(r);return Pe(Pe({},a),{rotation:a.rotation+r,x:e,y:i})}function Ms(a,r){var t=Es(a);return yn(a,r,t)}function Gs(a,r,t){for(var e=r,i=0;i<a.length;i++){var n=vt.Konva.getAngle(a[i]),o=Math.abs(n-r)%(Math.PI*2),s=Math.min(o,Math.PI*2-o);s<t&&(e=n)}return e}var tt=function(a){Ss(r,a);function r(t){var e=a.call(this,t)||this;return e._transforming=!1,e._createElements(),e._handleMouseMove=e._handleMouseMove.bind(e),e._handleMouseUp=e._handleMouseUp.bind(e),e.update=e.update.bind(e),e.on(Ts,e.update),e.getNode()&&e.update(),e}return r.prototype.attachTo=function(t){return this.setNode(t),this},r.prototype.setNode=function(t){return Z.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])},r.prototype.getNode=function(){return this._nodes&&this._nodes[0]},r.prototype.setNodes=function(t){var e=this;t===void 0&&(t=[]),this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,t.length===1?this.rotation(t[0].rotation()):this.rotation(0),this._nodes.forEach(function(n){var o=n._attrsAffectingSize.map(function(h){return h+"Change."+xt}).join(" "),s=function(){e._resetTransformCache(),e._transforming||e.update()};n.on(o,s),n.on(ks,s),n.on("_clearTransformCache."+xt,s),n.on("xChange."+xt+" yChange."+xt,s),e._proxyDrag(n)}),this._resetTransformCache();var i=!!this.findOne(".top-left");return i&&this.update(),this},r.prototype._proxyDrag=function(t){var e=this,i;t.on("dragstart."+xt,function(){i=t.getAbsolutePosition()}),t.on("dragmove."+xt,function(){if(i){var n=t.getAbsolutePosition(),o=n.x-i.x,s=n.y-i.y;e.nodes().forEach(function(h){if(h!==t&&!h.isDragging()){var l=h.getAbsolutePosition();h.setAbsolutePosition({x:l.x+o,y:l.y+s}),h.startDrag()}}),i=null}})},r.prototype.getNodes=function(){return this._nodes},r.prototype.getActiveAnchor=function(){return this._movingAnchorName},r.prototype.detach=function(){this._nodes&&this._nodes.forEach(function(t){t.off("."+xt)}),this._nodes=[],this._resetTransformCache()},r.prototype._resetTransformCache=function(){this._clearCache(bi),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")},r.prototype._getNodeRect=function(){return this._getCache(bi,this.__getNodeRect)},r.prototype.__getNodeShape=function(t,e,i){e===void 0&&(e=this.rotation());var n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),o=t.getAbsoluteScale(i),s=t.getAbsolutePosition(i),h=n.x*o.x-t.offsetX()*o.x,l=n.y*o.y-t.offsetY()*o.y,u=(vt.Konva.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),C={x:s.x+h*Math.cos(u)+l*Math.sin(-u),y:s.y+l*Math.cos(u)+h*Math.sin(u),width:n.width*o.x,height:n.height*o.y,rotation:u};return yn(C,-vt.Konva.getAngle(e),{x:0,y:0})},r.prototype.__getNodeRect=function(){var t=this,e=this.getNode();if(!e)return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};var i=[];this.nodes().map(function(C){var k=C.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:t.ignoreStroke()}),f=[{x:k.x,y:k.y},{x:k.x+k.width,y:k.y},{x:k.x+k.width,y:k.y+k.height},{x:k.x,y:k.y+k.height}],y=C.getAbsoluteTransform();f.forEach(function(g){var x=y.point(g);i.push(x)})});var n=new Z.Transform;n.rotate(-vt.Konva.getAngle(this.rotation()));var o,s,h,l;i.forEach(function(C){var k=n.point(C);o===void 0&&(o=h=k.x,s=l=k.y),o=Math.min(o,k.x),s=Math.min(s,k.y),h=Math.max(h,k.x),l=Math.max(l,k.y)}),n.invert();var u=n.point({x:o,y:s});return{x:u.x,y:u.y,width:h-o,height:l-s,rotation:vt.Konva.getAngle(this.rotation())}},r.prototype.getX=function(){return this._getNodeRect().x},r.prototype.getY=function(){return this._getNodeRect().y},r.prototype.getWidth=function(){return this._getNodeRect().width},r.prototype.getHeight=function(){return this._getNodeRect().height},r.prototype._createElements=function(){this._createBack(),Te.forEach((function(t){this._createAnchor(t)}).bind(this)),this._createAnchor("rotater")},r.prototype._createAnchor=function(t){var e=this,i=new xs.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Os?10:"auto"}),n=this;i.on("mousedown touchstart",function(o){n._handleMouseDown(o)}),i.on("dragstart",function(o){i.stopDrag(),o.cancelBubble=!0}),i.on("dragend",function(o){o.cancelBubble=!0}),i.on("mouseenter",function(){var o=vt.Konva.getAngle(e.rotation()),s=Fs(t,o);i.getStage().content.style.cursor=s,e._cursorChange=!0}),i.on("mouseout",function(){i.getStage().content.style.cursor="",e._cursorChange=!1}),this.add(i)},r.prototype._createBack=function(){var t=this,e=new Cs.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc:function(i){var n=this.getParent(),o=n.padding();i.beginPath(),i.rect(-o,-o,this.width()+o*2,this.height()+o*2),i.moveTo(this.width()/2,-o),n.rotateEnabled()&&i.lineTo(this.width()/2,-n.rotateAnchorOffset()*Z.Util._sign(this.height())-o),i.fillStrokeShape(this)},hitFunc:function(i,n){if(t.shouldOverdrawWholeArea()){var o=t.padding();i.beginPath(),i.rect(-o,-o,n.width()+o*2,n.height()+o*2),i.fillStrokeShape(n)}}});this.add(e),this._proxyDrag(e)},r.prototype._handleMouseDown=function(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),i=e.width,n=e.height,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/o),this.cos=Math.abs(i/o),window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0),this._transforming=!0;var s=t.target.getAbsolutePosition(),h=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:h.x-s.x,y:h.y-s.y},this._fire("transformstart",{evt:t,target:this.getNode()}),this.getNode()._fire("transformstart",{evt:t,target:this.getNode()})},r.prototype._handleMouseMove=function(t){var e,i,n,o=this.findOne("."+this._movingAnchorName),s=o.getStage();s.setPointersPositions(t);var h=s.getPointerPosition(),l={x:h.x-this._anchorDragOffset.x,y:h.y-this._anchorDragOffset.y},u=o.getAbsolutePosition();o.setAbsolutePosition(l);var C=o.getAbsolutePosition();if(!(u.x===C.x&&u.y===C.y)){if(this._movingAnchorName==="rotater"){var k=this._getNodeRect();e=o.x()-k.width/2,i=-o.y()+k.height/2;var f=Math.atan2(-i,e)+Math.PI/2;k.height<0&&(f-=Math.PI);var y=vt.Konva.getAngle(this.rotation()),g=y+f,x=vt.Konva.getAngle(this.rotationSnapTolerance()),S=Gs(this.rotationSnaps(),g,x),G=S-k.rotation,c=Ms(k,G);this._fitNodesInto(c,t);return}var v=this.keepRatio()||t.shiftKey,N=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(v){var m=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(m.x-o.x(),2)+Math.pow(m.y-o.y(),2));var T=this.findOne(".top-left").x()>m.x?-1:1,F=this.findOne(".top-left").y()>m.y?-1:1;e=n*this.cos*T,i=n*this.sin*F,this.findOne(".top-left").x(m.x-e),this.findOne(".top-left").y(m.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(o.y());else if(this._movingAnchorName==="top-right"){if(v){var m=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(o.x()-m.x,2)+Math.pow(m.y-o.y(),2));var T=this.findOne(".top-right").x()<m.x?-1:1,F=this.findOne(".top-right").y()>m.y?-1:1;e=n*this.cos*T,i=n*this.sin*F,this.findOne(".top-right").x(m.x+e),this.findOne(".top-right").y(m.y-i)}var P=o.position();this.findOne(".top-left").y(P.y),this.findOne(".bottom-right").x(P.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(o.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(o.x());else if(this._movingAnchorName==="bottom-left"){if(v){var m=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(m.x-o.x(),2)+Math.pow(o.y()-m.y,2));var T=m.x<o.x()?-1:1,F=o.y()<m.y?-1:1;e=n*this.cos*T,i=n*this.sin*F,o.x(m.x-e),o.y(m.y+i)}P=o.position(),this.findOne(".top-left").x(P.x),this.findOne(".bottom-right").y(P.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(o.y());else if(this._movingAnchorName==="bottom-right"){if(v){var m=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(o.x()-m.x,2)+Math.pow(o.y()-m.y,2));var T=this.findOne(".bottom-right").x()<m.x?-1:1,F=this.findOne(".bottom-right").y()<m.y?-1:1;e=n*this.cos*T,i=n*this.sin*F,this.findOne(".bottom-right").x(m.x+e),this.findOne(".bottom-right").y(m.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var N=this.centeredScaling()||t.altKey;if(N){var E=this.findOne(".top-left"),A=this.findOne(".bottom-right"),D=E.x(),R=E.y(),b=this.getWidth()-A.x(),d=this.getHeight()-A.y();A.move({x:-D,y:-R}),E.move({x:b,y:d})}var p=this.findOne(".top-left").getAbsolutePosition();e=p.x,i=p.y;var _=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),O=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:_,height:O,rotation:vt.Konva.getAngle(this.rotation())},t)}},r.prototype._handleMouseUp=function(t){this._removeEvents(t)},r.prototype.getAbsoluteTransform=function(){return this.getTransform()},r.prototype._removeEvents=function(t){if(this._transforming){this._transforming=!1,window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0);var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&e.fire("transformend",{evt:t,target:e}),this._movingAnchorName=null}},r.prototype._fitNodesInto=function(t,e){var i=this,n=this._getNodeRect(),o=1;if(Z.Util._inRange(t.width,-this.padding()*2-o,o)){this.update();return}if(Z.Util._inRange(t.height,-this.padding()*2-o,o)){this.update();return}var s=new Z.Transform;if(s.rotate(vt.Konva.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){var h=s.point({x:-this.padding()*2,y:0});t.x+=h.x,t.y+=h.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){var h=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.width+=this.padding()*2}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){var h=s.point({x:0,y:-this.padding()*2});t.x+=h.x,t.y+=h.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.height+=this.padding()*2}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){var h=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=h.x,this._anchorDragOffset.y-=h.y,t.height+=this.padding()*2}if(this.boundBoxFunc()){var l=this.boundBoxFunc()(n,t);l?t=l:Z.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}var u=1e7,C=new Z.Transform;C.translate(n.x,n.y),C.rotate(n.rotation),C.scale(n.width/u,n.height/u);var k=new Z.Transform;k.translate(t.x,t.y),k.rotate(t.rotation),k.scale(t.width/u,t.height/u);var f=k.multiply(C.invert());this._nodes.forEach(function(y){var g=y.getParent().getAbsoluteTransform(),x=y.getTransform().copy();x.translate(y.offsetX(),y.offsetY());var S=new Z.Transform;S.multiply(g.copy().invert()).multiply(f).multiply(g).multiply(x);var G=S.decompose();y._batchTransformChanges(function(){y.setAttrs(G)}),i._fire("transform",{evt:e,target:y}),y._fire("transform",{evt:e,target:y})}),this.rotation(Z.Util._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()},r.prototype.forceUpdate=function(){this._resetTransformCache(),this.update()},r.prototype._batchChangeChild=function(t,e){var i=this.findOne(t);i._batchTransformChanges(function(){i.setAttrs(e)})},r.prototype.update=function(){var t=this,e=this._getNodeRect();this.rotation(Z.Util._getRotation(e.rotation));var i=e.width,n=e.height,o=this.enabledAnchors(),s=this.resizeEnabled(),h=this.padding(),l=this.anchorSize();this.find("._anchor").each(function(u){u._batchTransformChanges(function(){u.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:t.anchorStroke(),strokeWidth:t.anchorStrokeWidth(),fill:t.anchorFill(),cornerRadius:t.anchorCornerRadius()})})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+h,offsetY:l/2+h,visible:s&&o.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:l/2+h,visible:s&&o.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:l/2-h,offsetY:l/2+h,visible:s&&o.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:l/2+h,visible:s&&o.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:n/2,offsetX:l/2-h,visible:s&&o.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:l/2+h,offsetY:l/2-h,visible:s&&o.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:n,offsetY:l/2-h,visible:s&&o.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:n,offsetX:l/2-h,offsetY:l/2-h,visible:s&&o.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*Z.Util._sign(n)-h,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0})},r.prototype.isTransforming=function(){return this._transforming},r.prototype.stopTransform=function(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}},r.prototype.destroy=function(){return this.getStage()&&this._cursorChange&&(this.getStage().content.style.cursor=""),mi.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this},r.prototype.toObject=function(){return ws.Node.prototype.toObject.call(this)},r}(mi.Group);Mr.Transformer=tt;function Ns(a){return a instanceof Array||Z.Util.warn("enabledAnchors value should be an array"),a instanceof Array&&a.forEach(function(r){Te.indexOf(r)===-1&&Z.Util.warn("Unknown anchor name: "+r+". Available names are: "+Te.join(", "))}),a||[]}tt.prototype.className="Transformer";Ps._registerNode(tt);et.Factory.addGetterSetter(tt,"enabledAnchors",Te,Ns);et.Factory.addGetterSetter(tt,"resizeEnabled",!0);et.Factory.addGetterSetter(tt,"anchorSize",10,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"rotateEnabled",!0);et.Factory.addGetterSetter(tt,"rotationSnaps",[]);et.Factory.addGetterSetter(tt,"rotateAnchorOffset",50,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"rotationSnapTolerance",5,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"borderEnabled",!0);et.Factory.addGetterSetter(tt,"anchorStroke","rgb(0, 161, 255)");et.Factory.addGetterSetter(tt,"anchorStrokeWidth",1,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"anchorFill","white");et.Factory.addGetterSetter(tt,"anchorCornerRadius",0,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"borderStroke","rgb(0, 161, 255)");et.Factory.addGetterSetter(tt,"borderStrokeWidth",1,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"borderDash");et.Factory.addGetterSetter(tt,"keepRatio",!0);et.Factory.addGetterSetter(tt,"centeredScaling",!1);et.Factory.addGetterSetter(tt,"ignoreStroke",!1);et.Factory.addGetterSetter(tt,"padding",0,Ht.getNumberValidator());et.Factory.addGetterSetter(tt,"node");et.Factory.addGetterSetter(tt,"nodes");et.Factory.addGetterSetter(tt,"boundBoxFunc");et.Factory.addGetterSetter(tt,"shouldOverdrawWholeArea",!1);et.Factory.backCompat(tt,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});Z.Collection.mapMethods(tt);var Gr={},Rs=V&&V.__extends||function(){var a=function(r,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},a(r,t)};return function(r,t){a(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Gr,"__esModule",{value:!0});var Ls=J,Ke=Y,Ds=ot,Is=X,_n=j,Us=X,Ct=function(a){Rs(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.radius(),0,Is.Konva.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius(t/2)},r.prototype.setHeight=function(t){this.radius(t/2)},r}(Ds.Shape);Gr.Wedge=Ct;Ct.prototype.className="Wedge";Ct.prototype._centroid=!0;Ct.prototype._attrsAffectingSize=["radius"];Us._registerNode(Ct);Ke.Factory.addGetterSetter(Ct,"radius",0,_n.getNumberValidator());Ke.Factory.addGetterSetter(Ct,"angle",0,_n.getNumberValidator());Ke.Factory.addGetterSetter(Ct,"clockwise",!1);Ke.Factory.backCompat(Ct,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Ls.Collection.mapMethods(Ct);var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});var Si=Y,$s=rt,Bs=j;function wi(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var Vs=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Hs=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function zs(a,r){var t=a.data,e=a.width,i=a.height,n,o,s,h,l,u,C,k,f,y,g,x,S,G,c,v,m,T,F,P,N,E,A,D,R=r+r+1,b=e-1,d=i-1,p=r+1,_=p*(p+1)/2,O=new wi,M=null,L=O,U=null,B=null,z=Vs[r],K=Hs[r];for(s=1;s<R;s++)L=L.next=new wi,s===p&&(M=L);for(L.next=O,C=u=0,o=0;o<i;o++){for(v=m=T=F=k=f=y=g=0,x=p*(P=t[u]),S=p*(N=t[u+1]),G=p*(E=t[u+2]),c=p*(A=t[u+3]),k+=_*P,f+=_*N,y+=_*E,g+=_*A,L=O,s=0;s<p;s++)L.r=P,L.g=N,L.b=E,L.a=A,L=L.next;for(s=1;s<p;s++)h=u+((b<s?b:s)<<2),k+=(L.r=P=t[h])*(D=p-s),f+=(L.g=N=t[h+1])*D,y+=(L.b=E=t[h+2])*D,g+=(L.a=A=t[h+3])*D,v+=P,m+=N,T+=E,F+=A,L=L.next;for(U=O,B=M,n=0;n<e;n++)t[u+3]=A=g*z>>K,A!==0?(A=255/A,t[u]=(k*z>>K)*A,t[u+1]=(f*z>>K)*A,t[u+2]=(y*z>>K)*A):t[u]=t[u+1]=t[u+2]=0,k-=x,f-=S,y-=G,g-=c,x-=U.r,S-=U.g,G-=U.b,c-=U.a,h=C+((h=n+r+1)<b?h:b)<<2,v+=U.r=t[h],m+=U.g=t[h+1],T+=U.b=t[h+2],F+=U.a=t[h+3],k+=v,f+=m,y+=T,g+=F,U=U.next,x+=P=B.r,S+=N=B.g,G+=E=B.b,c+=A=B.a,v-=P,m-=N,T-=E,F-=A,B=B.next,u+=4;C+=e}for(n=0;n<e;n++){for(m=T=F=v=f=y=g=k=0,u=n<<2,x=p*(P=t[u]),S=p*(N=t[u+1]),G=p*(E=t[u+2]),c=p*(A=t[u+3]),k+=_*P,f+=_*N,y+=_*E,g+=_*A,L=O,s=0;s<p;s++)L.r=P,L.g=N,L.b=E,L.a=A,L=L.next;for(l=e,s=1;s<=r;s++)u=l+n<<2,k+=(L.r=P=t[u])*(D=p-s),f+=(L.g=N=t[u+1])*D,y+=(L.b=E=t[u+2])*D,g+=(L.a=A=t[u+3])*D,v+=P,m+=N,T+=E,F+=A,L=L.next,s<d&&(l+=e);for(u=n,U=O,B=M,o=0;o<i;o++)h=u<<2,t[h+3]=A=g*z>>K,A>0?(A=255/A,t[h]=(k*z>>K)*A,t[h+1]=(f*z>>K)*A,t[h+2]=(y*z>>K)*A):t[h]=t[h+1]=t[h+2]=0,k-=x,f-=S,y-=G,g-=c,x-=U.r,S-=U.g,G-=U.b,c-=U.a,h=n+((h=o+p)<d?h:d)*e<<2,k+=v+=U.r=t[h],f+=m+=U.g=t[h+1],y+=T+=U.b=t[h+2],g+=F+=U.a=t[h+3],U=U.next,x+=P=B.r,S+=N=B.g,G+=E=B.b,c+=A=B.a,v-=P,m-=N,T-=E,F-=A,B=B.next,u+=e}}Nr.Blur=function(r){var t=Math.round(this.blurRadius());t>0&&zs(r,t)};Si.Factory.addGetterSetter($s.Node,"blurRadius",0,Bs.getNumberValidator(),Si.Factory.afterSetFilter);var Rr={};Object.defineProperty(Rr,"__esModule",{value:!0});var Ci=Y,js=rt,Ws=j;Rr.Brighten=function(a){var r=this.brightness()*255,t=a.data,e=t.length,i;for(i=0;i<e;i+=4)t[i]+=r,t[i+1]+=r,t[i+2]+=r};Ci.Factory.addGetterSetter(js.Node,"brightness",0,Ws.getNumberValidator(),Ci.Factory.afterSetFilter);var Lr={};Object.defineProperty(Lr,"__esModule",{value:!0});var xi=Y,Ks=rt,Ys=j;Lr.Contrast=function(a){var r=Math.pow((this.contrast()+100)/100,2),t=a.data,e=t.length,i=150,n=150,o=150,s;for(s=0;s<e;s+=4)i=t[s],n=t[s+1],o=t[s+2],i/=255,i-=.5,i*=r,i+=.5,i*=255,n/=255,n-=.5,n*=r,n+=.5,n*=255,o/=255,o-=.5,o*=r,o+=.5,o*=255,i=i<0?0:i>255?255:i,n=n<0?0:n>255?255:n,o=o<0?0:o>255?255:o,t[s]=i,t[s+1]=n,t[s+2]=o};xi.Factory.addGetterSetter(Ks.Node,"contrast",0,Ys.getNumberValidator(),xi.Factory.afterSetFilter);var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});var Ot=Y,Ye=rt,Xs=J,mn=j;Dr.Emboss=function(a){var r=this.embossStrength()*10,t=this.embossWhiteLevel()*255,e=this.embossDirection(),i=this.embossBlend(),n=0,o=0,s=a.data,h=a.width,l=a.height,u=h*4,C=l;switch(e){case"top-left":n=-1,o=-1;break;case"top":n=-1,o=0;break;case"top-right":n=-1,o=1;break;case"right":n=0,o=1;break;case"bottom-right":n=1,o=1;break;case"bottom":n=1,o=0;break;case"bottom-left":n=1,o=-1;break;case"left":n=0,o=-1;break;default:Xs.Util.error("Unknown emboss direction: "+e)}do{var k=(C-1)*u,f=n;C+f<1&&(f=0),C+f>l&&(f=0);var y=(C-1+f)*h*4,g=h;do{var x=k+(g-1)*4,S=o;g+S<1&&(S=0),g+S>h&&(S=0);var G=y+(g-1+S)*4,c=s[x]-s[G],v=s[x+1]-s[G+1],m=s[x+2]-s[G+2],T=c,F=T>0?T:-T,P=v>0?v:-v,N=m>0?m:-m;if(P>F&&(T=v),N>F&&(T=m),T*=r,i){var E=s[x]+T,A=s[x+1]+T,D=s[x+2]+T;s[x]=E>255?255:E<0?0:E,s[x+1]=A>255?255:A<0?0:A,s[x+2]=D>255?255:D<0?0:D}else{var R=t-T;R<0?R=0:R>255&&(R=255),s[x]=s[x+1]=s[x+2]=R}}while(--g)}while(--C)};Ot.Factory.addGetterSetter(Ye.Node,"embossStrength",.5,mn.getNumberValidator(),Ot.Factory.afterSetFilter);Ot.Factory.addGetterSetter(Ye.Node,"embossWhiteLevel",.5,mn.getNumberValidator(),Ot.Factory.afterSetFilter);Ot.Factory.addGetterSetter(Ye.Node,"embossDirection","top-left",null,Ot.Factory.afterSetFilter);Ot.Factory.addGetterSetter(Ye.Node,"embossBlend",!1,null,Ot.Factory.afterSetFilter);var Ir={};Object.defineProperty(Ir,"__esModule",{value:!0});var Pi=Y,qs=rt,Js=j;function rr(a,r,t,e,i){var n=t-r,o=i-e,s;return n===0?e+o/2:o===0?e:(s=(a-r)/n,s=o*s+e,s)}Ir.Enhance=function(a){var r=a.data,t=r.length,e=r[0],i=e,n,o=r[1],s=o,h,l=r[2],u=l,C,k,f=this.enhance();if(f!==0){for(k=0;k<t;k+=4)n=r[k+0],n<e?e=n:n>i&&(i=n),h=r[k+1],h<o?o=h:h>s&&(s=h),C=r[k+2],C<l?l=C:C>u&&(u=C);i===e&&(i=255,e=0),s===o&&(s=255,o=0),u===l&&(u=255,l=0);var y,g,x,S,G,c,v,m,T;for(f>0?(g=i+f*(255-i),x=e-f*(e-0),G=s+f*(255-s),c=o-f*(o-0),m=u+f*(255-u),T=l-f*(l-0)):(y=(i+e)*.5,g=i+f*(i-y),x=e+f*(e-y),S=(s+o)*.5,G=s+f*(s-S),c=o+f*(o-S),v=(u+l)*.5,m=u+f*(u-v),T=l+f*(l-v)),k=0;k<t;k+=4)r[k+0]=rr(r[k+0],e,i,x,g),r[k+1]=rr(r[k+1],o,s,c,G),r[k+2]=rr(r[k+2],l,u,T,m)}};Pi.Factory.addGetterSetter(qs.Node,"enhance",0,Js.getNumberValidator(),Pi.Factory.afterSetFilter);var Ur={};Object.defineProperty(Ur,"__esModule",{value:!0});Ur.Grayscale=function(a){var r=a.data,t=r.length,e,i;for(e=0;e<t;e+=4)i=.34*r[e]+.5*r[e+1]+.16*r[e+2],r[e]=i,r[e+1]=i,r[e+2]=i};var $r={};Object.defineProperty($r,"__esModule",{value:!0});var Kt=Y,Br=rt,Vr=j;Kt.Factory.addGetterSetter(Br.Node,"hue",0,Vr.getNumberValidator(),Kt.Factory.afterSetFilter);Kt.Factory.addGetterSetter(Br.Node,"saturation",0,Vr.getNumberValidator(),Kt.Factory.afterSetFilter);Kt.Factory.addGetterSetter(Br.Node,"luminance",0,Vr.getNumberValidator(),Kt.Factory.afterSetFilter);$r.HSL=function(a){var r=a.data,t=r.length,e=1,i=Math.pow(2,this.saturation()),n=Math.abs(this.hue()+360)%360,o=this.luminance()*127,s,h=e*i*Math.cos(n*Math.PI/180),l=e*i*Math.sin(n*Math.PI/180),u=.299*e+.701*h+.167*l,C=.587*e-.587*h+.33*l,k=.114*e-.114*h-.497*l,f=.299*e-.299*h-.328*l,y=.587*e+.413*h+.035*l,g=.114*e-.114*h+.293*l,x=.299*e-.3*h+1.25*l,S=.587*e-.586*h-1.05*l,G=.114*e+.886*h-.2*l,c,v,m,T;for(s=0;s<t;s+=4)c=r[s+0],v=r[s+1],m=r[s+2],T=r[s+3],r[s+0]=u*c+C*v+k*m+o,r[s+1]=f*c+y*v+g*m+o,r[s+2]=x*c+S*v+G*m+o,r[s+3]=T};var Hr={};Object.defineProperty(Hr,"__esModule",{value:!0});var Yt=Y,zr=rt,jr=j;Hr.HSV=function(a){var r=a.data,t=r.length,e=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),n=Math.abs(this.hue()+360)%360,o,s=e*i*Math.cos(n*Math.PI/180),h=e*i*Math.sin(n*Math.PI/180),l=.299*e+.701*s+.167*h,u=.587*e-.587*s+.33*h,C=.114*e-.114*s-.497*h,k=.299*e-.299*s-.328*h,f=.587*e+.413*s+.035*h,y=.114*e-.114*s+.293*h,g=.299*e-.3*s+1.25*h,x=.587*e-.586*s-1.05*h,S=.114*e+.886*s-.2*h,G,c,v,m;for(o=0;o<t;o+=4)G=r[o+0],c=r[o+1],v=r[o+2],m=r[o+3],r[o+0]=l*G+u*c+C*v,r[o+1]=k*G+f*c+y*v,r[o+2]=g*G+x*c+S*v,r[o+3]=m};Yt.Factory.addGetterSetter(zr.Node,"hue",0,jr.getNumberValidator(),Yt.Factory.afterSetFilter);Yt.Factory.addGetterSetter(zr.Node,"saturation",0,jr.getNumberValidator(),Yt.Factory.afterSetFilter);Yt.Factory.addGetterSetter(zr.Node,"value",0,jr.getNumberValidator(),Yt.Factory.afterSetFilter);var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.Invert=function(a){var r=a.data,t=r.length,e;for(e=0;e<t;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2]};var Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});var ke=Y,bn=rt,Qs=J,Sn=j,Zs=function(a,r,t){var e=a.data,i=r.data,n=a.width,o=a.height,s=t.polarCenterX||n/2,h=t.polarCenterY||o/2,l,u,C,k=0,f=0,y=0,g=0,x,S=Math.sqrt(s*s+h*h);u=n-s,C=o-h,x=Math.sqrt(u*u+C*C),S=x>S?x:S;var G=o,c=n,v,m,T=360/c*Math.PI/180,F,P;for(m=0;m<c;m+=1)for(F=Math.sin(m*T),P=Math.cos(m*T),v=0;v<G;v+=1)u=Math.floor(s+S*v/G*P),C=Math.floor(h+S*v/G*F),l=(C*n+u)*4,k=e[l+0],f=e[l+1],y=e[l+2],g=e[l+3],l=(m+v*n)*4,i[l+0]=k,i[l+1]=f,i[l+2]=y,i[l+3]=g},th=function(a,r,t){var e=a.data,i=r.data,n=a.width,o=a.height,s=t.polarCenterX||n/2,h=t.polarCenterY||o/2,l,u,C,k,f,y=0,g=0,x=0,S=0,G,c=Math.sqrt(s*s+h*h);u=n-s,C=o-h,G=Math.sqrt(u*u+C*C),c=G>c?G:c;var v=o,m=n,T,F,P=0,N,E;for(u=0;u<n;u+=1)for(C=0;C<o;C+=1)k=u-s,f=C-h,T=Math.sqrt(k*k+f*f)*v/c,F=(Math.atan2(f,k)*180/Math.PI+360+P)%360,F=F*m/360,N=Math.floor(F),E=Math.floor(T),l=(E*n+N)*4,y=e[l+0],g=e[l+1],x=e[l+2],S=e[l+3],l=(C*n+u)*4,i[l+0]=y,i[l+1]=g,i[l+2]=x,i[l+3]=S};Kr.Kaleidoscope=function(a){var r=a.width,t=a.height,e,i,n,o,s,h,l,u,C,k,f=Math.round(this.kaleidoscopePower()),y=Math.round(this.kaleidoscopeAngle()),g=Math.floor(r*(y%360)/360);if(!(f<1)){var x=Qs.Util.createCanvasElement();x.width=r,x.height=t;var S=x.getContext("2d").getImageData(0,0,r,t);Zs(a,S,{polarCenterX:r/2,polarCenterY:t/2});for(var G=r/Math.pow(2,f);G<=8;)G=G*2,f-=1;G=Math.ceil(G);var c=G,v=0,m=c,T=1;for(g+G>r&&(v=c,m=0,T=-1),i=0;i<t;i+=1)for(e=v;e!==m;e+=T)n=Math.round(e+g)%r,C=(r*i+n)*4,s=S.data[C+0],h=S.data[C+1],l=S.data[C+2],u=S.data[C+3],k=(r*i+e)*4,S.data[k+0]=s,S.data[k+1]=h,S.data[k+2]=l,S.data[k+3]=u;for(i=0;i<t;i+=1)for(c=Math.floor(G),o=0;o<f;o+=1){for(e=0;e<c+1;e+=1)C=(r*i+e)*4,s=S.data[C+0],h=S.data[C+1],l=S.data[C+2],u=S.data[C+3],k=(r*i+c*2-e-1)*4,S.data[k+0]=s,S.data[k+1]=h,S.data[k+2]=l,S.data[k+3]=u;c*=2}th(S,a,{})}};ke.Factory.addGetterSetter(bn.Node,"kaleidoscopePower",2,Sn.getNumberValidator(),ke.Factory.afterSetFilter);ke.Factory.addGetterSetter(bn.Node,"kaleidoscopeAngle",0,Sn.getNumberValidator(),ke.Factory.afterSetFilter);var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});var Ti=Y,eh=rt,rh=j;function me(a,r,t){var e=(t*a.width+r)*4,i=[];return i.push(a.data[e++],a.data[e++],a.data[e++],a.data[e++]),i}function re(a,r){return Math.sqrt(Math.pow(a[0]-r[0],2)+Math.pow(a[1]-r[1],2)+Math.pow(a[2]-r[2],2))}function ih(a){for(var r=[0,0,0],t=0;t<a.length;t++)r[0]+=a[t][0],r[1]+=a[t][1],r[2]+=a[t][2];return r[0]/=a.length,r[1]/=a.length,r[2]/=a.length,r}function nh(a,r){var t=me(a,0,0),e=me(a,a.width-1,0),i=me(a,0,a.height-1),n=me(a,a.width-1,a.height-1),o=r||10;if(re(t,e)<o&&re(e,n)<o&&re(n,i)<o&&re(i,t)<o){for(var s=ih([e,t,n,i]),h=[],l=0;l<a.width*a.height;l++){var u=re(s,[a.data[l*4],a.data[l*4+1],a.data[l*4+2]]);h[l]=u<o?0:255}return h}}function ah(a,r){for(var t=0;t<a.width*a.height;t++)a.data[4*t+3]=r[t]}function oh(a,r,t){for(var e=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(e.length)),n=Math.floor(i/2),o=[],s=0;s<t;s++)for(var h=0;h<r;h++){for(var l=s*r+h,u=0,C=0;C<i;C++)for(var k=0;k<i;k++){var f=s+C-n,y=h+k-n;if(f>=0&&f<t&&y>=0&&y<r){var g=f*r+y,x=e[C*i+k];u+=a[g]*x}}o[l]=u===255*8?255:0}return o}function sh(a,r,t){for(var e=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(e.length)),n=Math.floor(i/2),o=[],s=0;s<t;s++)for(var h=0;h<r;h++){for(var l=s*r+h,u=0,C=0;C<i;C++)for(var k=0;k<i;k++){var f=s+C-n,y=h+k-n;if(f>=0&&f<t&&y>=0&&y<r){var g=f*r+y,x=e[C*i+k];u+=a[g]*x}}o[l]=u>=255*4?255:0}return o}function hh(a,r,t){for(var e=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(e.length)),n=Math.floor(i/2),o=[],s=0;s<t;s++)for(var h=0;h<r;h++){for(var l=s*r+h,u=0,C=0;C<i;C++)for(var k=0;k<i;k++){var f=s+C-n,y=h+k-n;if(f>=0&&f<t&&y>=0&&y<r){var g=f*r+y,x=e[C*i+k];u+=a[g]*x}}o[l]=u}return o}Yr.Mask=function(a){var r=this.threshold(),t=nh(a,r);return t&&(t=oh(t,a.width,a.height),t=sh(t,a.width,a.height),t=hh(t,a.width,a.height),ah(a,t)),a};Ti.Factory.addGetterSetter(eh.Node,"threshold",0,rh.getNumberValidator(),Ti.Factory.afterSetFilter);var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});var ki=Y,lh=rt,ch=j;Xr.Noise=function(a){var r=this.noise()*255,t=a.data,e=t.length,i=r/2,n;for(n=0;n<e;n+=4)t[n+0]+=i-2*i*Math.random(),t[n+1]+=i-2*i*Math.random(),t[n+2]+=i-2*i*Math.random()};ki.Factory.addGetterSetter(lh.Node,"noise",.2,ch.getNumberValidator(),ki.Factory.afterSetFilter);var qr={};Object.defineProperty(qr,"__esModule",{value:!0});var Ai=Y,dh=J,uh=rt,fh=j;qr.Pixelate=function(a){var r=Math.ceil(this.pixelSize()),t=a.width,e=a.height,i,n,o,s,h,l,u,C=Math.ceil(t/r),k=Math.ceil(e/r),f,y,g,x,S,G,c,v=a.data;if(r<=0){dh.Util.error("pixelSize value can not be <= 0");return}for(S=0;S<C;S+=1)for(G=0;G<k;G+=1){for(s=0,h=0,l=0,u=0,f=S*r,y=f+r,g=G*r,x=g+r,c=0,i=f;i<y;i+=1)if(!(i>=t))for(n=g;n<x;n+=1)n>=e||(o=(t*n+i)*4,s+=v[o+0],h+=v[o+1],l+=v[o+2],u+=v[o+3],c+=1);for(s=s/c,h=h/c,l=l/c,u=u/c,i=f;i<y;i+=1)if(!(i>=t))for(n=g;n<x;n+=1)n>=e||(o=(t*n+i)*4,v[o+0]=s,v[o+1]=h,v[o+2]=l,v[o+3]=u)}};Ai.Factory.addGetterSetter(uh.Node,"pixelSize",8,fh.getNumberValidator(),Ai.Factory.afterSetFilter);var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});var Oi=Y,ph=rt,gh=j;Jr.Posterize=function(a){var r=Math.round(this.levels()*254)+1,t=a.data,e=t.length,i=255/r,n;for(n=0;n<e;n+=1)t[n]=Math.floor(t[n]/i)*i};Oi.Factory.addGetterSetter(ph.Node,"levels",.5,gh.getNumberValidator(),Oi.Factory.afterSetFilter);var Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});var Ae=Y,Zr=rt,vh=j;Qr.RGB=function(a){var r=a.data,t=r.length,e=this.red(),i=this.green(),n=this.blue(),o,s;for(o=0;o<t;o+=4)s=(.34*r[o]+.5*r[o+1]+.16*r[o+2])/255,r[o]=s*e,r[o+1]=s*i,r[o+2]=s*n,r[o+3]=r[o+3]};Ae.Factory.addGetterSetter(Zr.Node,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});Ae.Factory.addGetterSetter(Zr.Node,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});Ae.Factory.addGetterSetter(Zr.Node,"blue",0,vh.RGBComponent,Ae.Factory.afterSetFilter);var ti={};Object.defineProperty(ti,"__esModule",{value:!0});var se=Y,Xe=rt,yh=j;ti.RGBA=function(a){var r=a.data,t=r.length,e=this.red(),i=this.green(),n=this.blue(),o=this.alpha(),s,h;for(s=0;s<t;s+=4)h=1-o,r[s]=e*o+r[s]*h,r[s+1]=i*o+r[s+1]*h,r[s+2]=n*o+r[s+2]*h};se.Factory.addGetterSetter(Xe.Node,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});se.Factory.addGetterSetter(Xe.Node,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});se.Factory.addGetterSetter(Xe.Node,"blue",0,yh.RGBComponent,se.Factory.afterSetFilter);se.Factory.addGetterSetter(Xe.Node,"alpha",1,function(a){return this._filterUpToDate=!1,a>1?1:a<0?0:a});var ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.Sepia=function(a){var r=a.data,t=r.length,e,i,n,o;for(e=0;e<t;e+=4)i=r[e+0],n=r[e+1],o=r[e+2],r[e+0]=Math.min(255,i*.393+n*.769+o*.189),r[e+1]=Math.min(255,i*.349+n*.686+o*.168),r[e+2]=Math.min(255,i*.272+n*.534+o*.131)};var ri={};Object.defineProperty(ri,"__esModule",{value:!0});ri.Solarize=function(a){var r=a.data,t=a.width,e=a.height,i=t*4,n=e;do{var o=(n-1)*i,s=t;do{var h=o+(s-1)*4,l=r[h],u=r[h+1],C=r[h+2];l>127&&(l=255-l),u>127&&(u=255-u),C>127&&(C=255-C),r[h]=l,r[h+1]=u,r[h+2]=C}while(--s)}while(--n)};var ii={};Object.defineProperty(ii,"__esModule",{value:!0});var Fi=Y,_h=rt,mh=j;ii.Threshold=function(a){var r=this.threshold()*255,t=a.data,e=t.length,i;for(i=0;i<e;i+=1)t[i]=t[i]<r?0:255};Fi.Factory.addGetterSetter(_h.Node,"threshold",.5,mh.getNumberValidator(),Fi.Factory.afterSetFilter);Object.defineProperty(ur,"__esModule",{value:!0});var Ei=fr,bh=yr,Sh=_r,wh=br,Ch=Sr,xh=Cr,Mi=Be,Ph=Ie,Th=ze,kh=je,Ah=Pr,Oh=Tr,Fh=kr,Eh=Ar,Mh=We,Gh=Er,Nh=Mr,Rh=Gr,Lh=Nr,Dh=Rr,Ih=Lr,Uh=Dr,$h=Ir,Bh=Ur,Vh=$r,Hh=Hr,zh=Wr,jh=Kr,Wh=Yr,Kh=Xr,Yh=qr,Xh=Jr,qh=Qr,Jh=ti,Qh=ei,Zh=ri,tl=ii;ur.Konva=Ei.Konva.Util._assign(Ei.Konva,{Arc:bh.Arc,Arrow:Sh.Arrow,Circle:wh.Circle,Ellipse:Ch.Ellipse,Image:xh.Image,Label:Mi.Label,Tag:Mi.Tag,Line:Ph.Line,Path:Th.Path,Rect:kh.Rect,RegularPolygon:Ah.RegularPolygon,Ring:Oh.Ring,Sprite:Fh.Sprite,Star:Eh.Star,Text:Mh.Text,TextPath:Gh.TextPath,Transformer:Nh.Transformer,Wedge:Rh.Wedge,Filters:{Blur:Lh.Blur,Brighten:Dh.Brighten,Contrast:Ih.Contrast,Emboss:Uh.Emboss,Enhance:$h.Enhance,Grayscale:Bh.Grayscale,HSL:Vh.HSL,HSV:Hh.HSV,Invert:zh.Invert,Kaleidoscope:jh.Kaleidoscope,Mask:Wh.Mask,Noise:Kh.Noise,Pixelate:Yh.Pixelate,Posterize:Xh.Posterize,RGB:qh.RGB,RGBA:Jh.RGBA,Sepia:Qh.Sepia,Solarize:Zh.Solarize,Threshold:tl.Threshold}});(function(a,r){var t=ur.Konva;t._injectGlobal(t),r.default=t,a.exports=r.default})(nr,nr.exports);var el=nr.exports;const ut=In(el),wn="#D9E4EA",rl="#333333",we=3,ir=414,Gi=788,Oe=84,Wt=126,ae=24,qe={stroke:wn,strokeWidth:2,cornerRadius:9},be={fontSize:ae,fontFamily:"Helvetica",fill:wn,align:"center"},Ce={...qe,width:85,height:Wt},Ni={...qe,width:173,height:Oe},Ri={...qe,width:230,height:Oe},Li={...qe,width:228,height:Wt,x:Ce.width+8,y:we};class il extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.firstPerson={name:"",salary:""},this.secondPerson={name:"person 1",salary:""},this.expenses="0",this.currency="$",this.stage=null,this.layer=null}static get observedAttributes(){return["first-person","second-person","expenses","currency"]}attributeChangedCallback(r,t,e){r==="first-person"?this.firstPerson=JSON.parse(e):r==="second-person"?this.secondPerson=JSON.parse(e):r==="expenses"?this.expenses=e:r==="currency"&&(this.currency=e),this.stage&&this.draw()}connectedCallback(){this.render(),this.initCanvas()}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
        }

        .ShareCanvas {
          position: fixed;
          left: 50%;
          top: 50%;
          transform: translate3d(-150%, -50%, 0);
        }
      </style>
      <div class="ShareCanvas"></div>
    `}initCanvas(){const r=this.shadowRoot.querySelector(".ShareCanvas");this.stage=new ut.Stage({container:r,width:ir,height:Gi}),this.layer=new ut.Layer,this.stage.add(this.layer);const t=new ut.Rect({x:0,y:0,width:ir,height:Gi,fill:rl});this.layer.add(t),this.drawHeader(),this.drawRow1(),this.drawRow2(),this.layer.draw()}drawHeader(){const r=new ut.Rect({...Ce,x:we,y:we}),t=new ut.Rect(Li),e=new ut.Rect({...Ce,x:Ce.width+Li.width+13,y:we});ut.Image.fromURL("/img/logo.ea9ec231.svg",i=>{i.setAttrs({x:ir/2-20,y:35,scaleX:1}),this.layer.add(i),this.layer.draw()}),this.layer.add(r),this.layer.add(t),this.layer.add(e)}drawRow1(){const r={...Ni,x:3,y:Wt+8},t={...Ri,x:r.width+8,y:Wt+8},e={...be,width:r.width,height:r.height,x:r.x,y:r.y+r.height/2-ae/2,text:this.firstPerson.name},i={...be,width:t.width,height:t.height,x:t.x,y:t.y+t.height/2-ae/2,text:`${this.currency}${this.firstPerson.salary}`};this.layer.add(new ut.Rect(r)),this.layer.add(new ut.Rect(t)),this.layer.add(new ut.Text(e)),this.layer.add(new ut.Text(i))}drawRow2(){const r={...Ni,x:3,y:Wt+8+Oe+5},t={...Ri,x:r.width+8,y:Wt+8+Oe+5},e={...be,width:r.width,height:r.height,x:r.x,y:r.y+r.height/2-ae/2,text:this.secondPerson.name},i={...be,width:t.width,height:t.height,x:t.x,y:t.y+t.height/2-ae/2,text:`${this.currency}${this.secondPerson.salary}`};this.layer.add(new ut.Rect(r)),this.layer.add(new ut.Rect(t)),this.layer.add(new ut.Text(e)),this.layer.add(new ut.Text(i))}draw(){this.layer.draw()}}customElements.define("share-canvas",il);const nl={state:{firstPerson:{name:"person 1",salary:0,percent:0,total:0},secondPerson:{name:"person 2",salary:0,percent:0,total:0},currency:"",sumOfDebts:0,basePercentage:0},mutations:{updateFirstPerson(a){this.state.firstPerson={...this.state.firstPerson,...a}},updateSecondPerson(a){this.state.secondPerson={...this.state.secondPerson,...a}},setDebts(a){this.state.sumOfDebts=a===""?0:a},setBasePercentage(a){this.state.basePercentage=a===""?0:a},reset(){this.state.firstPerson.salary=0,this.state.firstPerson.percent=0,this.state.firstPerson.total=0,this.state.secondPerson.salary=0,this.state.secondPerson.percent=0,this.state.secondPerson.total=0,this.state.sumOfDebts=0,this.state.basePercentage=0}}};class al extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.firstSalary="0",this.secondSalary="0",this.expenses="0",this.selectedField="firstSalary",this.showCanvas=!1,this.store=nl}connectedCallback(){this.render()}onInputFirstName(r){this.store.mutations.updateFirstPerson({name:r.target.value}),this.render()}onInputSecondName(r){this.store.mutations.updateSecondPerson({name:r.target.value}),this.render()}onFocusFirstSalary(){this.setSelectedField("firstSalary")}onFocusSecondSalary(){this.setSelectedField("secondSalary")}onFocusExpenses(){this.setSelectedField("expenses")}onTapButtonNumberpad(r){const t=r.detail;if(t==="<"){this.selectedField==="firstSalary"?this.firstSalary="0":this.selectedField==="secondSalary"?this.secondSalary="0":this.selectedField==="expenses"&&(this.expenses="0"),this.render();return}if(t!=="Enter"){if(this.selectedField==="firstSalary"){if(this.firstSalary.length>7)return;this.firstSalary=this.firstSalary==="0"?t:this.firstSalary+t}else if(this.selectedField==="secondSalary"){if(this.secondSalary.length>7)return;this.secondSalary=this.secondSalary==="0"?t:this.secondSalary+t}else if(this.selectedField==="expenses"){if(this.expenses.length>7)return;this.expenses=this.expenses==="0"?t:this.expenses+t}this.render()}}calculate(){if(this.firstSalary==="0"||this.secondSalary==="0"||this.expenses==="0")return;let r=0,t=0;const e=(o,s=1)=>parseFloat(o.toFixed(s)),i={salary:this.firstSalary,total:0},n={salary:this.secondSalary,total:0};for(;r<=parseFloat(this.expenses);)i.total=e(Number(this.firstSalary)/100*t,0),n.total=e(Number(this.secondSalary)/100*t,0),r=i.total+n.total,t+=.01;this.store.mutations.setDebts(parseFloat(this.expenses)),this.store.mutations.setBasePercentage(e(t)),this.store.mutations.updateFirstPerson(i),this.store.mutations.updateSecondPerson(n),this.render()}onClickClear(){this.firstSalary="0",this.secondSalary="0",this.expenses="0",this.store.mutations.reset(),this.render()}onClickShare(){this.showCanvas=!0,this.render()}setSelectedField(r){this.selectedField=r,this.render()}render(){const r=this.store.state.firstPerson,t=this.store.state.secondPerson,e=this.store.state.currency,i=this.store.state.basePercentage,n=i!==0,o=r.name?r.name:"First person",s=t.name?t.name:"Second person";this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
        }

        @keyframes blink-animation {
          to {
            visibility: hidden;
          }
        }

        .App {
          width: 400px;
        }

        :host(.menuOpened) .App {
          transform: translate3d(-25vw, -50%, 0);
        }

        .bg {
          display: none;
          background-color: var(--black);
          width: 100%;
          max-width: 414px;
          margin: 0 auto;
          padding: 3px;
          box-sizing: border-box;
          font-family: Helvetica;
          font-size: 24px;
          border-radius: 9px;
          padding-bottom: 38px;
          position: relative;
          border: 10px solid var(--light-bg);
          box-shadow: 0px 0px 40px var(--white);
          transform: translate3d(-50%, -50%, 0);
          transition: transform 500ms ease;
          left: 50%;
          top: 50%;
          position: absolute;
        }

        .App .bg {
          background-color: var(--black);
          width: 100%;
          height: 100%;
          position: absolute;
          z-index: -1;
          border-radius: 9px;
          left: 0;
          top: 0;
        }

        .App header {
          margin-bottom: 3px;
          border-radius: 10px 10px 0 0;
          overflow: hidden;
        }

        .App header .wrap-logo {
          display: grid;
          width: 100%;
          grid-gap: 3px;
          grid-template-columns: 1fr 1fr 1fr;
        }

        .App header .wrap-logo .logo {
          height: 70%;
        }

        .App .block {
          background-color: white;
          box-sizing: border-box;
          border-radius: 9px;
          padding: 0 29px;
          display: flex;
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          justify-content: center;
          align-items: center;
        }

        .App .input {
          background-color: transparent;
          border: 0;
          width: 100%;
          height: 100%;
          text-align: center;
          font-size: 24px;
          outline: none;
          position: relative;
        }

        .App .input::-webkit-outer-spin-button,
        .App .input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        .App .input[type='number'] {
          -moz-appearance: textfield;
          appearance: textfield;
        }

        .App .input::placeholder {
          color: var(--gray);
        }

        .App .input.firstSalaryField,
        .App .input.secondSalaryField {
          color: var(--green);
        }

        .App .input.expensesField {
          color: var(--red);
        }

        .App .split-btn {
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          width: 100%;
          font-style: normal;
          font-weight: normal;
          font-size: 24px;
          line-height: 24px;
          text-align: center;
          background-color: var(--blue);
          color: var(--light-bg);
          border: 0;
          outline: 0;
          margin-bottom: 3px;
           cursor: url(/splitfair-pwa/cursor-red.png), auto;
        }

        .App .split-btn:hover,
        .App .split-btn:focus {
          background-color: #0a8ac5;
        }

        .incomings {
          display: flex;
          flex-direction: column;
          width: 100%;
        }

        .wrap-income {
          display: grid;
          grid-gap: 3px;
          grid-template-columns: minmax(43%, 1fr) minmax(calc(57% - 3px), 1fr);
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          margin-bottom: 3px;
        }

        .label,
        .income {
          display: flex;
          align-items: center;
          font-style: normal;
          font-weight: normal;
          font-size: 24px;
          line-height: 24px;
          text-align: center;
        }

        .label {
          justify-content: center;
        }

        .income {
          color: var(--green);
          justify-content: flex-end;
        }

        .expenses {
          display: grid;
          grid-gap: 3px;
          grid-template-columns: minmax(43%, 1fr) minmax(calc(57% - 3px), 1fr);
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          margin-bottom: 3px;
        }

        .expenses.active .value::before {
          opacity: 1;
          animation: blink-animation 1s steps(5, start) infinite;
        }

        .expenses .label {
          background-color: var(--red);
          color: var(--black);
        }

        .expenses .value {
          background-color: var(--black);
          color: var(--red);
          justify-content: flex-end;
          position: relative;
        }

        .expenses .value::before {
          content: '';
          width: 4px;
          height: 40px;
          background-color: var(--red);
          margin-right: 5px;
          opacity: 0;
          display: inline-block;
          position: absolute;
          left: 0;
          top: 50%;
          transform: translateY(-50%);
        }

        .results {
          display: flex;
          flex-direction: column;
          width: 100%;
        }

        .results .title {
          margin-bottom: 3px;
        }

        .results .wrap-results {
          display: grid;
          grid-gap: 3px;
          grid-template-columns: minmax(43%, 1fr) minmax(calc(57% - 3px), 1fr);
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          margin-bottom: 3px;
        }

        .results .wrap-results .value {
          justify-content: flex-end;
          color: var(--blue);
        }

        .results .percent-each {
          margin-bottom: 3px;
        }

        .results .wrap-buttons {
          display: grid;
          grid-gap: 3px;
          grid-template-columns: minmax(calc(67% - 3px), 1fr) minmax(33%, 1fr);
          height: var(--block-height);
          min-height: var(--block-min-height);
          max-height: var(--block-max-height);
          margin-bottom: 3px;
        }

        .results .wrap-buttons .share {
          background-color: var(--blue);
          color: var(--white);
        }

        .results .wrap-buttons .clear {
          background-color: var(--red);
          color: var(--black);
        }
      </style>
      <div class="App">
        <div class="bg"></div>
        <header>
          <div class="wrap-logo">
            <div class="block block-02"></div>
             <div class="block block-03">
               <img src="/splitfair-pwa/logo.svg" alt="logo" class="logo" />
             </div>
            <div class="block block-04"></div>
          </div>
        </header>
        <section class="incomings">
          <div class="wrap-income">
            <h2 class="block label">
              <input
                value="${r.name}"
                type="text"
                placeholder="Name"
                tabindex="1"
                class="input"
                autofocus
              />
            </h2>
            <div class="block income ${this.selectedField==="firstSalary"?"active":""}">
              ${this.firstSalary!=="0"?`<span>${e}</span>`:""}
              <input
                value="${this.firstSalary}"
                type="text"
                placeholder="salary"
                tabindex="3"
                class="input firstSalaryField"
                readonly
              />
            </div>
          </div>
          <div class="wrap-income">
            <h2 class="block label">
              <input
                value="${t.name}"
                type="text"
                placeholder="Name"
                tabindex="2"
                class="input"
              />
            </h2>
            <div class="block income ${this.selectedField==="secondSalary"?"active":""}">
              ${this.secondSalary!=="0"?`<span>${e}</span>`:""}
              <input
                value="${this.secondSalary}"
                type="number"
                placeholder="salary"
                tabindex="4"
                class="input secondSalaryField"
                readonly
              />
            </div>
          </div>
        </section>
        <section class="expenses ${this.selectedField==="expenses"?"active":""}">
          <div class="block label">Expenses</div>
          <div class="block value">
            ${this.expenses!=="0"?`<span>${e}</span>`:""}
            <input
              value="${this.expenses}"
              type="text"
              placeholder="expenses"
              tabindex="5"
              class="input expensesField"
              readonly
            />
          </div>
        </section>
        <a class="block split-btn" tabindex="6"> Split </a>
        <number-pad></number-pad>
        ${n?`
        <section class="results">
          <div class="block title">Results</div>
          <div class="wrap-results">
            <div class="block label">${o}</div>
            <div class="block value">${e}${r.total}</div>
          </div>
          <div class="wrap-results">
            <div class="block label">${s}</div>
            <div class="block value">${e}${t.total}</div>
          </div>
          <div class="block percent-each">%${i} each</div>
          <div class="wrap-buttons">
            <div class="block share">Share</div>
            <div class="block clear">Clear</div>
          </div>
        </section>
        `:""}
        ${this.showCanvas?`<share-canvas first-person='${JSON.stringify(r)}' second-person='${JSON.stringify(t)}' currency='${e}'></share-canvas>`:""}
      </div>
    `;const h=this.shadowRoot.querySelectorAll('input[placeholder="Name"]');h[0].addEventListener("input",this.onInputFirstName),h[1].addEventListener("input",this.onInputSecondName),this.shadowRoot.querySelector(".firstSalaryField").addEventListener("focus",this.onFocusFirstSalary),this.shadowRoot.querySelector(".secondSalaryField").addEventListener("focus",this.onFocusSecondSalary),this.shadowRoot.querySelector(".expensesField").addEventListener("focus",this.onFocusExpenses),this.shadowRoot.querySelector(".split-btn").addEventListener("click",this.calculate),this.shadowRoot.querySelector("number-pad").addEventListener("tapped-button",this.onTapButtonNumberpad),n&&(this.shadowRoot.querySelector(".clear").addEventListener("click",this.onClickClear),this.shadowRoot.querySelector(".share").addEventListener("click",this.onClickShare))}}customElements.define("app-component",al);class ol extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.menuOpened=!1,this.desktopOnly=!0}connectedCallback(){const r=window.matchMedia("(max-width: 600px)");this.desktopOnly=!r.matches,r.addEventListener("change",this.screenTest),this.render()}moveAppSideways(r){this.menuOpened=r.detail,this.render()}screenTest(r){this.desktopOnly=!r.matches,this.render()}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          --light-bg: #d9e4ea;
          --dark-bg: #333333;
          --gray: #bdbdbd;
          --black: #0d0b0d;
          --green: #0ecb66;
          --red: #fa4f23;
          --blue: #0b98dd;
          --white: #ffffff;
          --light-bg-02: #cbc9c9;
          --block-height: calc((100vh / 9) - 11px);
          --block-min-height: 55px;
          --block-max-height: 84px;
          --block-height-header: calc(100vh / 9);
          font-family: 'Avenir', Helvetica, Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-align: center;
          overflow-y: auto;
          overflow-x: hidden;
          width: 100vw;
          height: 100vh;
          position: relative;
           cursor: url(/splitfair-pwa/cursor-red.png), auto;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .Application__link {
          position: absolute;
          text-decoration: none;
          color: var(--black);
          font-size: 28px;
          z-index: 1;
          transition: opacity 250ms ease;
        }

        .Application__link.menuOpened {
          opacity: 0;
          pointer-events: none;
        }

        .Application__link.logo {
          top: 4vw;
          left: 5vw;
        }

        .Application__version {
          position: absolute;
          bottom: 4vw;
          left: 5vw;
          color: var(--black);
          font-size: 28px;
          opacity: 0.4;
          transition: opacity 250ms ease;
        }

        .Application__version.menuOpened {
          opacity: 0;
          pointer-events: none;
        }
      </style>
      ${this.desktopOnly?`<a href="#" class="Application__link logo ${this.menuOpened?"menuOpened":""}"> splitfair </a>`:""}
      ${this.desktopOnly?`<span class="Application__version ${this.menuOpened?"menuOpened":""}"> v0.1 </span>`:""}
      <app-component class="${this.menuOpened?"menuOpened":""}"></app-component>
      ${this.desktopOnly?"<download-app-section></download-app-section>":""}
      ${this.desktopOnly?"<about-section></about-section>":""}
    `,this.desktopOnly&&(this.shadowRoot.querySelector("download-app-section").addEventListener("is-menu-open",this.moveAppSideways),this.shadowRoot.querySelector("about-section").addEventListener("is-menu-open",this.moveAppSideways))}}customElements.define("splitfair-application",ol);const sl=document.createElement("splitfair-application");document.getElementById("app").appendChild(sl);
